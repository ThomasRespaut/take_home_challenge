[0m13:43:07.105561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002197F2EC890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002197D670590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002197B8CE8D0>]}


============================== 13:43:07.112594 | fe804142-6028-410c-9b05-fdbc5443d603 ==============================
[0m13:43:07.112594 [info ] [MainThread]: Running with dbt=1.8.7
[0m13:43:07.113844 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': 'logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt init take_home_challenge', 'send_anonymous_usage_stats': 'True'}
[0m13:43:07.156765 [warn ] [MainThread]: [ConfigFolderDirectory]: Unable to parse logging event dictionary. Failed to parse dir field: expected string or bytes-like object, got 'WindowsPath'.. Dictionary: {'dir': WindowsPath('C:/Users/thoma/.dbt')}
[0m13:43:07.157870 [info ] [MainThread]: Creating dbt configuration folder at 
[0m13:43:07.160771 [debug] [MainThread]: Starter project path: C:\Users\thoma\PLM\.venv\Take-Home challenge\Lib\site-packages\dbt\include\starter_project
[0m13:43:07.177207 [info ] [MainThread]: 
Your new dbt project "take_home_challenge" was created!

For more information on how to configure the profiles.yml file,
please consult the dbt documentation here:

  https://docs.getdbt.com/docs/configure-your-profile

One more thing:

Need help? Don't hesitate to reach out to us via GitHub issues or on Slack:

  https://community.getdbt.com/

Happy modeling!

[0m13:43:07.178279 [info ] [MainThread]: Setting up your profile.
[0m13:56:06.450527 [info ] [MainThread]: Profile take_home_challenge written to C:\Users\thoma\.dbt\profiles.yml using target's profile_template.yml and your supplied values. Run 'dbt debug' to validate the connection.
[0m13:56:06.454055 [debug] [MainThread]: Command `dbt init` succeeded at 13:56:06.454055 after 779.56 seconds
[0m13:56:06.454559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002197D670590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021910EA4B30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002197C1C8B00>]}
[0m13:56:06.455564 [debug] [MainThread]: Flushing usage events
[0m14:05:47.054046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026A95AE8E00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026A961C4DD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026A95FFB3E0>]}


============================== 14:05:47.060366 | acfba154-8514-4cf0-a4f0-6b0fc2de6aa1 ==============================
[0m14:05:47.060366 [info ] [MainThread]: Running with dbt=1.8.7
[0m14:05:47.061625 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': 'C:\\Users\\thoma\\PycharmProjects\\Take-Home challenge\\logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:05:48.974992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'acfba154-8514-4cf0-a4f0-6b0fc2de6aa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AA7DB5D30>]}
[0m14:05:49.023959 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'acfba154-8514-4cf0-a4f0-6b0fc2de6aa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AA7449E50>]}
[0m14:05:49.023959 [info ] [MainThread]: Registered adapter: bigquery=1.8.3
[0m14:05:49.358432 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m14:05:49.359442 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m14:05:49.359442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'acfba154-8514-4cf0-a4f0-6b0fc2de6aa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AA94EE360>]}
[0m14:05:50.497686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'acfba154-8514-4cf0-a4f0-6b0fc2de6aa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026A966CADE0>]}
[0m14:05:50.608947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'acfba154-8514-4cf0-a4f0-6b0fc2de6aa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AA942F2F0>]}
[0m14:05:50.608947 [info ] [MainThread]: Found 4 models, 2 sources, 484 macros
[0m14:05:50.609953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'acfba154-8514-4cf0-a4f0-6b0fc2de6aa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AA98C6660>]}
[0m14:05:50.612501 [info ] [MainThread]: 
[0m14:05:50.613666 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:05:50.617801 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge'
[0m14:05:50.618803 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:05:51.193156 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_takehomechallenge, now create_takehomechallenge_orders_recrutement)
[0m14:05:51.194284 [debug] [ThreadPool]: Creating schema "database: "takehomechallenge"
schema: "orders_recrutement"
"
[0m14:05:51.203322 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:05:51.205390 [debug] [ThreadPool]: On create_takehomechallenge_orders_recrutement: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "connection_name": "create_takehomechallenge_orders_recrutement"} */
create schema if not exists `takehomechallenge`.`orders_recrutement`
  
[0m14:05:51.787827 [error] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:e9a5fb45-3d9f-40b5-8855-f9836976bd19&page=queryresults
[0m14:05:51.788831 [debug] [ThreadPool]: BigQuery adapter: Unhandled error while running:
macro create_schema
[0m14:05:51.788831 [debug] [ThreadPool]: BigQuery adapter: Database Error
  Access Denied: Project takehomechallenge: User does not have bigquery.jobs.create permission in project takehomechallenge.
[0m14:05:51.789929 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:05:51.791109 [debug] [MainThread]: Connection 'create_takehomechallenge_orders_recrutement' was properly closed.
[0m14:05:51.791109 [info ] [MainThread]: 
[0m14:05:51.792601 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 1.18 seconds (1.18s).
[0m14:05:51.793608 [error] [MainThread]: Encountered an error:
Database Error
  Access Denied: Project takehomechallenge: User does not have bigquery.jobs.create permission in project takehomechallenge.
[0m14:05:51.794758 [debug] [MainThread]: Command `dbt run` failed at 14:05:51.794758 after 4.96 seconds
[0m14:05:51.796030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026A961C4DD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AA9491700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026A96A92150>]}
[0m14:05:51.796030 [debug] [MainThread]: Flushing usage events
[0m14:24:27.566589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002305412C800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002305412CA10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002305412C5C0>]}


============================== 14:24:27.571821 | b937b117-d7b0-482d-bed1-d33c459a3b68 ==============================
[0m14:24:27.571821 [info ] [MainThread]: Running with dbt=1.8.7
[0m14:24:27.572775 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\thoma\\PycharmProjects\\Take-Home challenge\\logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:24:29.055469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b937b117-d7b0-482d-bed1-d33c459a3b68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000230671C0E60>]}
[0m14:24:29.112622 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b937b117-d7b0-482d-bed1-d33c459a3b68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023065C92A20>]}
[0m14:24:29.113604 [info ] [MainThread]: Registered adapter: bigquery=1.8.3
[0m14:24:29.434556 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m14:24:29.589543 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:24:29.589543 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:24:29.627551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b937b117-d7b0-482d-bed1-d33c459a3b68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000230676E6000>]}
[0m14:24:29.736565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b937b117-d7b0-482d-bed1-d33c459a3b68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000230676999A0>]}
[0m14:24:29.737829 [info ] [MainThread]: Found 4 models, 2 sources, 484 macros
[0m14:24:29.739235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b937b117-d7b0-482d-bed1-d33c459a3b68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002306744F9E0>]}
[0m14:24:29.740355 [info ] [MainThread]: 
[0m14:24:29.741827 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:24:29.745377 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge'
[0m14:24:29.746407 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:24:30.328758 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_takehomechallenge, now create_takehomechallenge_orders_recrutement)
[0m14:24:30.329913 [debug] [ThreadPool]: Creating schema "database: "takehomechallenge"
schema: "orders_recrutement"
"
[0m14:24:30.342793 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:24:30.343792 [debug] [ThreadPool]: On create_takehomechallenge_orders_recrutement: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "connection_name": "create_takehomechallenge_orders_recrutement"} */
create schema if not exists `takehomechallenge`.`orders_recrutement`
  
[0m14:24:30.892465 [error] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:65b6c416-5522-42a2-a061-87244d1123cd&page=queryresults
[0m14:24:30.892968 [debug] [ThreadPool]: BigQuery adapter: Unhandled error while running:
macro create_schema
[0m14:24:30.894073 [debug] [ThreadPool]: BigQuery adapter: Database Error
  Access Denied: Project takehomechallenge: User does not have bigquery.jobs.create permission in project takehomechallenge.
[0m14:24:30.895422 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:24:30.895422 [debug] [MainThread]: Connection 'create_takehomechallenge_orders_recrutement' was properly closed.
[0m14:24:30.896679 [info ] [MainThread]: 
[0m14:24:30.896679 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 1.15 seconds (1.15s).
[0m14:24:30.897798 [error] [MainThread]: Encountered an error:
Database Error
  Access Denied: Project takehomechallenge: User does not have bigquery.jobs.create permission in project takehomechallenge.
[0m14:24:30.899882 [debug] [MainThread]: Command `dbt run` failed at 14:24:30.898857 after 3.51 seconds
[0m14:24:30.899882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023053AB0A70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000230677BFBC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000230678258E0>]}
[0m14:24:30.900887 [debug] [MainThread]: Flushing usage events
[0m14:26:27.364270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EDF7500860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EDF7500800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EDF7500980>]}


============================== 14:26:27.369535 | 499a6dae-ef42-435a-a19b-29ec1b8b295c ==============================
[0m14:26:27.369535 [info ] [MainThread]: Running with dbt=1.8.7
[0m14:26:27.370899 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': 'C:\\Users\\thoma\\PycharmProjects\\Take-Home challenge\\logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:26:27.375084 [error] [MainThread]: Encountered an error:
Runtime Error
  
  dbt encountered an error while trying to read your profiles.yml file.
  
  Runtime Error
    Syntax error near line 21
    ------------------------------
    18 | 
    19 | L’erreur indique que l’utilisateur configuré pour exécuter les tâches dbt n’a pas les permissions suffisantes pour exécuter des jobs BigQuery dans le projet takehomechallenge. Voici comment résoudre ce problème.
    20 | 
    21 | Étape 1 : Vérifier les permissions dans Google Cloud
    22 | L’utilisateur (ou le compte de service) configuré dans ton fichier profiles.yml doit avoir des permissions suffisantes pour BigQuery.
    23 | 
    24 | Connecte-toi à Google Cloud Console.
    
    Raw Error:
    ------------------------------
    while scanning a simple key
      in "<unicode string>", line 19, column 1
    could not find expected ':'
      in "<unicode string>", line 21, column 1
  
[0m14:26:27.376603 [debug] [MainThread]: Command `dbt run` failed at 14:26:27.376603 after 0.14 seconds
[0m14:26:27.377602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EDF663F080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EDF74344A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EDF6850EC0>]}
[0m14:26:27.377602 [debug] [MainThread]: Flushing usage events
[0m14:27:42.694329 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000205B5A97470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000205B3A66720>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000205B54C5F10>]}


============================== 14:27:42.698366 | ffd5214b-20b8-44bf-85b0-7570b2c55dd8 ==============================
[0m14:27:42.698366 [info ] [MainThread]: Running with dbt=1.8.7
[0m14:27:42.699431 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'log_path': 'C:\\Users\\thoma\\PycharmProjects\\Take-Home challenge\\logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:27:44.043924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ffd5214b-20b8-44bf-85b0-7570b2c55dd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000205C8C1A6F0>]}
[0m14:27:44.104097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ffd5214b-20b8-44bf-85b0-7570b2c55dd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000205B5556E40>]}
[0m14:27:44.105113 [info ] [MainThread]: Registered adapter: bigquery=1.8.3
[0m14:27:44.426118 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m14:27:44.556018 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:27:44.557009 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:27:44.582881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ffd5214b-20b8-44bf-85b0-7570b2c55dd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000205C6CD87D0>]}
[0m14:27:44.677936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ffd5214b-20b8-44bf-85b0-7570b2c55dd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000205C9161610>]}
[0m14:27:44.679289 [info ] [MainThread]: Found 4 models, 2 sources, 484 macros
[0m14:27:44.680456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ffd5214b-20b8-44bf-85b0-7570b2c55dd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000205C92E62D0>]}
[0m14:27:44.682185 [info ] [MainThread]: 
[0m14:27:44.683192 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:27:44.686192 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge'
[0m14:27:44.687230 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:27:45.239547 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_takehomechallenge, now create_takehomechallenge_orders_recrutement)
[0m14:27:45.240686 [debug] [ThreadPool]: Creating schema "database: "takehomechallenge"
schema: "orders_recrutement"
"
[0m14:27:45.257824 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:27:45.261134 [debug] [ThreadPool]: On create_takehomechallenge_orders_recrutement: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "connection_name": "create_takehomechallenge_orders_recrutement"} */
create schema if not exists `takehomechallenge`.`orders_recrutement`
  
[0m14:27:45.806046 [error] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:1e6d315b-067d-499f-a0c8-db9383071fd6&page=queryresults
[0m14:27:45.808060 [debug] [ThreadPool]: BigQuery adapter: Unhandled error while running:
macro create_schema
[0m14:27:45.808060 [debug] [ThreadPool]: BigQuery adapter: Database Error
  Access Denied: Project takehomechallenge: User does not have bigquery.jobs.create permission in project takehomechallenge.
[0m14:27:45.809483 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:27:45.810599 [debug] [MainThread]: Connection 'create_takehomechallenge_orders_recrutement' was properly closed.
[0m14:27:45.810599 [info ] [MainThread]: 
[0m14:27:45.811646 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 1.13 seconds (1.13s).
[0m14:27:45.812671 [error] [MainThread]: Encountered an error:
Database Error
  Access Denied: Project takehomechallenge: User does not have bigquery.jobs.create permission in project takehomechallenge.
[0m14:27:45.814020 [debug] [MainThread]: Command `dbt run` failed at 14:27:45.814020 after 3.24 seconds
[0m14:27:45.815347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000205B5A97470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000205C9161D90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000205C92EBDA0>]}
[0m14:27:45.815347 [debug] [MainThread]: Flushing usage events
[0m14:29:24.734050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002210F3BCB00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002210E0421E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022110D98620>]}


============================== 14:29:24.738115 | a6d755bb-a956-40ee-ac26-efbfba39a09c ==============================
[0m14:29:24.738115 [info ] [MainThread]: Running with dbt=1.8.7
[0m14:29:24.739620 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': 'C:\\Users\\thoma\\PycharmProjects\\Take-Home challenge\\logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:29:25.971507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a6d755bb-a956-40ee-ac26-efbfba39a09c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022110C4EE70>]}
[0m14:29:26.021954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a6d755bb-a956-40ee-ac26-efbfba39a09c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002212450FCB0>]}
[0m14:29:26.024047 [info ] [MainThread]: Registered adapter: bigquery=1.8.3
[0m14:29:26.316679 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m14:29:26.455539 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:29:26.455539 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:29:26.483197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a6d755bb-a956-40ee-ac26-efbfba39a09c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022124634800>]}
[0m14:29:26.577224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a6d755bb-a956-40ee-ac26-efbfba39a09c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022124811CA0>]}
[0m14:29:26.577224 [info ] [MainThread]: Found 4 models, 2 sources, 484 macros
[0m14:29:26.578340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a6d755bb-a956-40ee-ac26-efbfba39a09c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221248DA660>]}
[0m14:29:26.579644 [info ] [MainThread]: 
[0m14:29:26.581063 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:29:26.586748 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge'
[0m14:29:26.587718 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:29:27.122787 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_takehomechallenge, now create_takehomechallenge_orders_recrutement)
[0m14:29:27.123836 [debug] [ThreadPool]: Creating schema "database: "takehomechallenge"
schema: "orders_recrutement"
"
[0m14:29:27.151592 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:29:27.153767 [debug] [ThreadPool]: On create_takehomechallenge_orders_recrutement: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "connection_name": "create_takehomechallenge_orders_recrutement"} */
create schema if not exists `takehomechallenge`.`orders_recrutement`
  
[0m14:29:27.798935 [error] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:16203a7f-512f-4892-abee-2162b16560d9&page=queryresults
[0m14:29:27.801121 [debug] [ThreadPool]: BigQuery adapter: Unhandled error while running:
macro create_schema
[0m14:29:27.802119 [debug] [ThreadPool]: BigQuery adapter: Database Error
  Access Denied: Project takehomechallenge: User does not have bigquery.jobs.create permission in project takehomechallenge.
[0m14:29:27.805532 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:29:27.806829 [debug] [MainThread]: Connection 'create_takehomechallenge_orders_recrutement' was properly closed.
[0m14:29:27.808942 [info ] [MainThread]: 
[0m14:29:27.811044 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 1.23 seconds (1.23s).
[0m14:29:27.814093 [error] [MainThread]: Encountered an error:
Database Error
  Access Denied: Project takehomechallenge: User does not have bigquery.jobs.create permission in project takehomechallenge.
[0m14:29:27.818128 [debug] [MainThread]: Command `dbt run` failed at 14:29:27.817123 after 3.25 seconds
[0m14:29:27.819722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002210F3BCB00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002212499BD40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022124A06150>]}
[0m14:29:27.820829 [debug] [MainThread]: Flushing usage events
[0m14:30:56.968476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A62B3B4110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A6278D8E00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A62B10A6C0>]}


============================== 14:30:56.974051 | 2d4e4154-3f54-4556-a779-5ccf3166cf57 ==============================
[0m14:30:56.974051 [info ] [MainThread]: Running with dbt=1.8.7
[0m14:30:56.974557 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': 'C:\\Users\\thoma\\PycharmProjects\\Take-Home challenge\\logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:30:58.286464 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2d4e4154-3f54-4556-a779-5ccf3166cf57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A63C5C3710>]}
[0m14:30:58.336318 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2d4e4154-3f54-4556-a779-5ccf3166cf57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A62A6A5070>]}
[0m14:30:58.337315 [info ] [MainThread]: Registered adapter: bigquery=1.8.3
[0m14:30:58.641757 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m14:30:58.771712 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:30:58.772840 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:30:58.799607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2d4e4154-3f54-4556-a779-5ccf3166cf57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A62B5304D0>]}
[0m14:30:58.902171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2d4e4154-3f54-4556-a779-5ccf3166cf57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A63E2F7800>]}
[0m14:30:58.904170 [info ] [MainThread]: Found 4 models, 2 sources, 484 macros
[0m14:30:58.905172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2d4e4154-3f54-4556-a779-5ccf3166cf57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A62B58D220>]}
[0m14:30:58.907170 [info ] [MainThread]: 
[0m14:30:58.908174 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:30:58.912428 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge'
[0m14:30:58.912428 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:30:59.435173 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_takehomechallenge, now create_takehomechallenge_orders_recrutement)
[0m14:30:59.437390 [debug] [ThreadPool]: Creating schema "database: "takehomechallenge"
schema: "orders_recrutement"
"
[0m14:30:59.464627 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:30:59.468699 [debug] [ThreadPool]: On create_takehomechallenge_orders_recrutement: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "connection_name": "create_takehomechallenge_orders_recrutement"} */
create schema if not exists `takehomechallenge`.`orders_recrutement`
  
[0m14:31:00.103246 [error] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:01106b6d-fce8-4500-bce4-54b317885b76&page=queryresults
[0m14:31:00.104251 [debug] [ThreadPool]: BigQuery adapter: Unhandled error while running:
macro create_schema
[0m14:31:00.105250 [debug] [ThreadPool]: BigQuery adapter: Database Error
  Access Denied: Project takehomechallenge: User does not have bigquery.jobs.create permission in project takehomechallenge.
[0m14:31:00.105250 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:31:00.106261 [debug] [MainThread]: Connection 'create_takehomechallenge_orders_recrutement' was properly closed.
[0m14:31:00.106261 [info ] [MainThread]: 
[0m14:31:00.106261 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 1.20 seconds (1.20s).
[0m14:31:00.107621 [error] [MainThread]: Encountered an error:
Database Error
  Access Denied: Project takehomechallenge: User does not have bigquery.jobs.create permission in project takehomechallenge.
[0m14:31:00.110087 [debug] [MainThread]: Command `dbt run` failed at 14:31:00.110087 after 3.32 seconds
[0m14:31:00.111097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A62B014BF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A63E216930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A63E2CBE30>]}
[0m14:31:00.111097 [debug] [MainThread]: Flushing usage events
[0m14:34:04.669525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F88BC1AF00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F88B82C500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F88B82C920>]}


============================== 14:34:04.674891 | e128514b-f427-441f-8459-3e7ef5a98eaf ==============================
[0m14:34:04.674891 [info ] [MainThread]: Running with dbt=1.8.7
[0m14:34:04.675894 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\thoma\\PycharmProjects\\Take-Home challenge\\logs', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:34:05.997354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e128514b-f427-441f-8459-3e7ef5a98eaf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F889B80E00>]}
[0m14:34:06.051086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e128514b-f427-441f-8459-3e7ef5a98eaf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F89D248770>]}
[0m14:34:06.051592 [info ] [MainThread]: Registered adapter: bigquery=1.8.3
[0m14:34:06.394956 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m14:34:06.537793 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:34:06.538793 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:34:06.571319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e128514b-f427-441f-8459-3e7ef5a98eaf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F89EB9BA40>]}
[0m14:34:06.682868 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e128514b-f427-441f-8459-3e7ef5a98eaf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F89EF07200>]}
[0m14:34:06.682868 [info ] [MainThread]: Found 4 models, 2 sources, 484 macros
[0m14:34:06.683868 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e128514b-f427-441f-8459-3e7ef5a98eaf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F89EB98800>]}
[0m14:34:06.685293 [info ] [MainThread]: 
[0m14:34:06.686312 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:34:06.690956 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge'
[0m14:34:06.690956 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:34:07.304846 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_takehomechallenge, now create_takehomechallenge_orders_recrutement)
[0m14:34:07.306050 [debug] [ThreadPool]: Creating schema "database: "takehomechallenge"
schema: "orders_recrutement"
"
[0m14:34:07.318107 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:34:07.319297 [debug] [ThreadPool]: On create_takehomechallenge_orders_recrutement: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "connection_name": "create_takehomechallenge_orders_recrutement"} */
create schema if not exists `takehomechallenge`.`orders_recrutement`
  
[0m14:34:07.903395 [error] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:768d6fd2-19c5-4d23-9f3b-b7a8b657e57a&page=queryresults
[0m14:34:07.906396 [debug] [ThreadPool]: BigQuery adapter: Unhandled error while running:
macro create_schema
[0m14:34:07.908394 [debug] [ThreadPool]: BigQuery adapter: Database Error
  Access Denied: Project takehomechallenge: User does not have bigquery.jobs.create permission in project takehomechallenge.
[0m14:34:07.912396 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:34:07.913391 [debug] [MainThread]: Connection 'create_takehomechallenge_orders_recrutement' was properly closed.
[0m14:34:07.915394 [info ] [MainThread]: 
[0m14:34:07.917451 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 1.23 seconds (1.23s).
[0m14:34:07.919549 [error] [MainThread]: Encountered an error:
Database Error
  Access Denied: Project takehomechallenge: User does not have bigquery.jobs.create permission in project takehomechallenge.
[0m14:34:07.923561 [debug] [MainThread]: Command `dbt run` failed at 14:34:07.923561 after 3.42 seconds
[0m14:34:07.925721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F88BC1AF00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F89EBC0650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F89EE3AB10>]}
[0m14:34:07.928740 [debug] [MainThread]: Flushing usage events
[0m14:37:22.625624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2349F2150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2383EF650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A235D8FD70>]}


============================== 14:37:22.629993 | d4d6659a-69ef-4166-8f4b-bcee37630dd0 ==============================
[0m14:37:22.629993 [info ] [MainThread]: Running with dbt=1.8.7
[0m14:37:22.631210 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\thoma\\PycharmProjects\\Take-Home challenge\\logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:37:22.657570 [info ] [MainThread]: dbt version: 1.8.7
[0m14:37:22.658587 [info ] [MainThread]: python version: 3.12.0
[0m14:37:22.658587 [info ] [MainThread]: python path: C:\Users\thoma\PLM\.venv\Take-Home challenge\Scripts\python.exe
[0m14:37:22.659913 [info ] [MainThread]: os info: Windows-11-10.0.22631-SP0
[0m14:37:23.836600 [info ] [MainThread]: Using profiles dir at C:\Users\thoma\.dbt
[0m14:37:23.837600 [info ] [MainThread]: Using profiles.yml file at C:\Users\thoma\.dbt\profiles.yml
[0m14:37:23.838601 [info ] [MainThread]: Using dbt_project.yml file at C:\Users\thoma\PycharmProjects\Take-Home challenge\dbt_project.yml
[0m14:37:23.838601 [info ] [MainThread]: adapter type: bigquery
[0m14:37:23.839600 [info ] [MainThread]: adapter version: 1.8.3
[0m14:37:23.909813 [info ] [MainThread]: Configuration:
[0m14:37:23.910824 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m14:37:23.911904 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m14:37:23.912908 [info ] [MainThread]: Required dependencies:
[0m14:37:23.912908 [debug] [MainThread]: Executing "git --help"
[0m14:37:23.958134 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--config-env=<name>=<envvar>] <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m14:37:23.959555 [debug] [MainThread]: STDERR: "b''"
[0m14:37:23.960571 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m14:37:23.960571 [info ] [MainThread]: Connection:
[0m14:37:23.961747 [info ] [MainThread]:   method: service-account
[0m14:37:23.963101 [info ] [MainThread]:   database: takehomechallenge
[0m14:37:23.963101 [info ] [MainThread]:   execution_project: takehomechallenge
[0m14:37:23.964108 [info ] [MainThread]:   schema: orders_recrutement
[0m14:37:23.965113 [info ] [MainThread]:   location: EU
[0m14:37:23.965113 [info ] [MainThread]:   priority: interactive
[0m14:37:23.966123 [info ] [MainThread]:   maximum_bytes_billed: None
[0m14:37:23.966123 [info ] [MainThread]:   impersonate_service_account: None
[0m14:37:23.967495 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m14:37:23.967495 [info ] [MainThread]:   job_retries: 1
[0m14:37:23.968504 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m14:37:23.969512 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m14:37:23.969512 [info ] [MainThread]:   timeout_seconds: 300
[0m14:37:23.970546 [info ] [MainThread]:   client_id: None
[0m14:37:23.970546 [info ] [MainThread]:   token_uri: None
[0m14:37:23.971550 [info ] [MainThread]:   dataproc_region: None
[0m14:37:23.971550 [info ] [MainThread]:   dataproc_cluster_name: None
[0m14:37:23.972554 [info ] [MainThread]:   gcs_bucket: None
[0m14:37:23.972554 [info ] [MainThread]:   dataproc_batch: None
[0m14:37:23.974046 [info ] [MainThread]: Registered adapter: bigquery=1.8.3
[0m14:37:24.284299 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m14:37:24.284299 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:37:24.286299 [debug] [MainThread]: On debug: select 1 as id
[0m14:37:27.591019 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:8f992e52-c0a9-4551-8175-366a0cf77a03&page=queryresults
[0m14:37:28.325536 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m14:37:28.327638 [info ] [MainThread]: [32mAll checks passed![0m
[0m14:37:28.329962 [debug] [MainThread]: Command `dbt debug` succeeded at 14:37:28.328854 after 5.87 seconds
[0m14:37:28.330054 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m14:37:28.331217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A237BB8B00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2487A5670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A237D682C0>]}
[0m14:37:28.333624 [debug] [MainThread]: Flushing usage events
[0m14:37:31.534051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022992FF9E20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022995F5BC80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022996933500>]}


============================== 14:37:31.537591 | d1c5f840-106f-4450-9e62-d3ec8a4da2c6 ==============================
[0m14:37:31.537591 [info ] [MainThread]: Running with dbt=1.8.7
[0m14:37:31.538644 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\thoma\\PycharmProjects\\Take-Home challenge\\logs', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:37:32.828427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd1c5f840-106f-4450-9e62-d3ec8a4da2c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000229A7E31DF0>]}
[0m14:37:32.874238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd1c5f840-106f-4450-9e62-d3ec8a4da2c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022994834E30>]}
[0m14:37:32.875244 [info ] [MainThread]: Registered adapter: bigquery=1.8.3
[0m14:37:33.184227 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m14:37:33.324032 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:37:33.324032 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:37:33.353660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd1c5f840-106f-4450-9e62-d3ec8a4da2c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000229A7F8C140>]}
[0m14:37:33.451187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd1c5f840-106f-4450-9e62-d3ec8a4da2c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000229A9B67770>]}
[0m14:37:33.452622 [info ] [MainThread]: Found 4 models, 2 sources, 484 macros
[0m14:37:33.452622 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd1c5f840-106f-4450-9e62-d3ec8a4da2c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000229A9B3BE00>]}
[0m14:37:33.455102 [info ] [MainThread]: 
[0m14:37:33.456158 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:37:33.460364 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge'
[0m14:37:33.461688 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:37:33.858616 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_takehomechallenge, now create_takehomechallenge_orders_recrutement)
[0m14:37:33.859580 [debug] [ThreadPool]: Creating schema "database: "takehomechallenge"
schema: "orders_recrutement"
"
[0m14:37:33.875113 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:37:33.877261 [debug] [ThreadPool]: On create_takehomechallenge_orders_recrutement: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "connection_name": "create_takehomechallenge_orders_recrutement"} */
create schema if not exists `takehomechallenge`.`orders_recrutement`
  
[0m14:37:34.539132 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:742e0873-05f4-4382-9302-fa79b85e111b&page=queryresults
[0m14:37:34.542051 [error] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:742e0873-05f4-4382-9302-fa79b85e111b&page=queryresults
[0m14:37:34.544660 [debug] [ThreadPool]: BigQuery adapter: Unhandled error while running:
macro create_schema
[0m14:37:34.545274 [debug] [ThreadPool]: BigQuery adapter: Database Error
  Access Denied: Project takehomechallenge: User does not have bigquery.datasets.create permission in project takehomechallenge.
[0m14:37:34.548734 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:37:34.549735 [debug] [MainThread]: Connection 'create_takehomechallenge_orders_recrutement' was properly closed.
[0m14:37:34.550768 [info ] [MainThread]: 
[0m14:37:34.553432 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 1.10 seconds (1.10s).
[0m14:37:34.555664 [error] [MainThread]: Encountered an error:
Database Error
  Access Denied: Project takehomechallenge: User does not have bigquery.datasets.create permission in project takehomechallenge.
[0m14:37:34.558823 [debug] [MainThread]: Command `dbt run` failed at 14:37:34.558823 after 3.13 seconds
[0m14:37:34.559345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022992FF9E20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000229A9A9B590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000229A9B67710>]}
[0m14:37:34.560368 [debug] [MainThread]: Flushing usage events
[0m14:39:01.750742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D01DA8B60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D01DAAAB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D01DAB9E0>]}


============================== 14:39:01.755769 | 6702f1e5-c79c-4272-a0a7-efbbab068e55 ==============================
[0m14:39:01.755769 [info ] [MainThread]: Running with dbt=1.8.7
[0m14:39:01.756785 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\thoma\\PycharmProjects\\Take-Home challenge\\logs', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:39:03.045623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6702f1e5-c79c-4272-a0a7-efbbab068e55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D14A9C860>]}
[0m14:39:03.094815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6702f1e5-c79c-4272-a0a7-efbbab068e55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D14B67FB0>]}
[0m14:39:03.095830 [info ] [MainThread]: Registered adapter: bigquery=1.8.3
[0m14:39:03.426946 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m14:39:03.570131 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:39:03.571128 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:39:03.600232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6702f1e5-c79c-4272-a0a7-efbbab068e55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D14D383B0>]}
[0m14:39:03.698362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6702f1e5-c79c-4272-a0a7-efbbab068e55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D14B2C980>]}
[0m14:39:03.699406 [info ] [MainThread]: Found 4 models, 2 sources, 484 macros
[0m14:39:03.699406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6702f1e5-c79c-4272-a0a7-efbbab068e55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D14FC6300>]}
[0m14:39:03.702480 [info ] [MainThread]: 
[0m14:39:03.703479 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:39:03.707949 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge'
[0m14:39:03.707949 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:39:04.074313 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_takehomechallenge, now create_takehomechallenge_orders_recrutement)
[0m14:39:04.075313 [debug] [ThreadPool]: Creating schema "database: "takehomechallenge"
schema: "orders_recrutement"
"
[0m14:39:04.098256 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:39:04.102194 [debug] [ThreadPool]: On create_takehomechallenge_orders_recrutement: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "connection_name": "create_takehomechallenge_orders_recrutement"} */
create schema if not exists `takehomechallenge`.`orders_recrutement`
  
[0m14:39:05.036792 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:c13bc897-204e-4556-8883-f18e9215b48d&page=queryresults
[0m14:39:07.102086 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge_orders_recrutement'
[0m14:39:07.104060 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:39:07.837118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6702f1e5-c79c-4272-a0a7-efbbab068e55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D13240200>]}
[0m14:39:07.839044 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:39:07.840177 [info ] [MainThread]: 
[0m14:39:07.850525 [debug] [Thread-1 (]: Began running node model.take_home_challenge.avg_products_per_order
[0m14:39:07.851557 [debug] [Thread-2 (]: Began running node model.take_home_challenge.orders_2023
[0m14:39:07.852881 [debug] [Thread-3 (]: Began running node model.take_home_challenge.orders_by_month
[0m14:39:07.853410 [info ] [Thread-1 (]: 1 of 3 START sql view model orders_recrutement.avg_products_per_order .......... [RUN]
[0m14:39:07.854533 [info ] [Thread-2 (]: 2 of 3 START sql view model orders_recrutement.orders_2023 ..................... [RUN]
[0m14:39:07.858274 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.take_home_challenge.avg_products_per_order'
[0m14:39:07.855967 [info ] [Thread-3 (]: 3 of 3 START sql view model orders_recrutement.orders_by_month ................. [RUN]
[0m14:39:07.859546 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_2023'
[0m14:39:07.861570 [debug] [Thread-1 (]: Began compiling node model.take_home_challenge.avg_products_per_order
[0m14:39:07.863086 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_by_month'
[0m14:39:07.864114 [debug] [Thread-2 (]: Began compiling node model.take_home_challenge.orders_2023
[0m14:39:07.880826 [debug] [Thread-1 (]: Writing injected SQL for node "model.take_home_challenge.avg_products_per_order"
[0m14:39:07.882462 [debug] [Thread-3 (]: Began compiling node model.take_home_challenge.orders_by_month
[0m14:39:07.886182 [debug] [Thread-2 (]: Writing injected SQL for node "model.take_home_challenge.orders_2023"
[0m14:39:07.889742 [debug] [Thread-3 (]: Writing injected SQL for node "model.take_home_challenge.orders_by_month"
[0m14:39:07.891289 [debug] [Thread-3 (]: Began executing node model.take_home_challenge.orders_by_month
[0m14:39:07.892716 [debug] [Thread-2 (]: Began executing node model.take_home_challenge.orders_2023
[0m14:39:07.910815 [debug] [Thread-1 (]: Began executing node model.take_home_challenge.avg_products_per_order
[0m14:39:07.917893 [debug] [Thread-3 (]: Writing runtime sql for node "model.take_home_challenge.orders_by_month"
[0m14:39:07.920632 [debug] [Thread-2 (]: Writing runtime sql for node "model.take_home_challenge.orders_2023"
[0m14:39:07.923589 [debug] [Thread-1 (]: Writing runtime sql for node "model.take_home_challenge.avg_products_per_order"
[0m14:39:07.926695 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:39:07.927700 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m14:39:07.927700 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:39:07.929699 [debug] [Thread-2 (]: On model.take_home_challenge.orders_2023: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2023"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2023`
  OPTIONS()
  as SELECT
  COUNT(*) AS total_orders_2023
FROM
  `takehomechallenge`.`orders_recrutement`.`orders`
WHERE
  EXTRACT(YEAR FROM order_date) = 2023;


[0m14:39:07.930802 [debug] [Thread-1 (]: On model.take_home_challenge.avg_products_per_order: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.avg_products_per_order"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`avg_products_per_order`
  OPTIONS()
  as SELECT
  EXTRACT(MONTH FROM order_date) AS month,
  AVG(quantity) AS avg_products_per_order
FROM
  `takehomechallenge`.`sales_recrutement`.`sales`
WHERE
  EXTRACT(YEAR FROM order_date) = 2023
GROUP BY
  month
ORDER BY
  month;


[0m14:39:07.931994 [debug] [Thread-3 (]: On model.take_home_challenge.orders_by_month: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_by_month"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_by_month`
  OPTIONS()
  as SELECT
  EXTRACT(MONTH FROM order_date) AS month,
  COUNT(*) AS total_orders
FROM
  `takehomechallenge`.`orders_recrutement`.`orders`
WHERE
  EXTRACT(YEAR FROM order_date) = 2023
GROUP BY
  month
ORDER BY
  month;


[0m14:39:08.884859 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:61bbf294-5d03-443b-b2de-2ecf5678b635&page=queryresults
[0m14:39:08.886416 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:c9e2b36a-4f7c-4887-a340-9b96a71b76e5&page=queryresults
[0m14:39:08.887432 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:30bec4f8-a860-4e45-a0f3-9c3efa1ff231&page=queryresults
[0m14:39:08.887432 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:61bbf294-5d03-443b-b2de-2ecf5678b635&page=queryresults
[0m14:39:08.888431 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:c9e2b36a-4f7c-4887-a340-9b96a71b76e5&page=queryresults
[0m14:39:08.889423 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:30bec4f8-a860-4e45-a0f3-9c3efa1ff231&page=queryresults
[0m14:39:08.951228 [debug] [Thread-3 (]: Database Error in model orders_by_month (models\orders_by_month.sql)
  Not found: Table takehomechallenge:orders_recrutement.orders was not found in location EU
  compiled code at target\run\take_home_challenge\models\orders_by_month.sql
[0m14:39:08.951228 [debug] [Thread-1 (]: Database Error in model avg_products_per_order (models\avg_products_per_order.sql)
  Not found: Dataset takehomechallenge:sales_recrutement was not found in location EU
  compiled code at target\run\take_home_challenge\models\avg_products_per_order.sql
[0m14:39:08.954259 [debug] [Thread-2 (]: Database Error in model orders_2023 (models\orders_2023.sql)
  Not found: Table takehomechallenge:orders_recrutement.orders was not found in location EU
  compiled code at target\run\take_home_challenge\models\orders_2023.sql
[0m14:39:08.956265 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6702f1e5-c79c-4272-a0a7-efbbab068e55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D1517BC80>]}
[0m14:39:08.956265 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6702f1e5-c79c-4272-a0a7-efbbab068e55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D14CCB860>]}
[0m14:39:08.957338 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6702f1e5-c79c-4272-a0a7-efbbab068e55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D151439E0>]}
[0m14:39:08.958270 [error] [Thread-3 (]: 3 of 3 ERROR creating sql view model orders_recrutement.orders_by_month ........ [[31mERROR[0m in 1.09s]
[0m14:39:08.958270 [error] [Thread-1 (]: 1 of 3 ERROR creating sql view model orders_recrutement.avg_products_per_order . [[31mERROR[0m in 1.10s]
[0m14:39:08.959749 [error] [Thread-2 (]: 2 of 3 ERROR creating sql view model orders_recrutement.orders_2023 ............ [[31mERROR[0m in 1.10s]
[0m14:39:08.960795 [debug] [Thread-3 (]: Finished running node model.take_home_challenge.orders_by_month
[0m14:39:08.960795 [debug] [Thread-1 (]: Finished running node model.take_home_challenge.avg_products_per_order
[0m14:39:08.961832 [debug] [Thread-2 (]: Finished running node model.take_home_challenge.orders_2023
[0m14:39:08.964050 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:39:08.964050 [debug] [MainThread]: Connection 'create_takehomechallenge_orders_recrutement' was properly closed.
[0m14:39:08.965061 [debug] [MainThread]: Connection 'list_takehomechallenge_orders_recrutement' was properly closed.
[0m14:39:08.965061 [debug] [MainThread]: Connection 'model.take_home_challenge.avg_products_per_order' was properly closed.
[0m14:39:08.965061 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_2023' was properly closed.
[0m14:39:08.966436 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_by_month' was properly closed.
[0m14:39:08.966436 [info ] [MainThread]: 
[0m14:39:08.966436 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 5.26 seconds (5.26s).
[0m14:39:08.967917 [debug] [MainThread]: Command end result
[0m14:39:08.997210 [info ] [MainThread]: 
[0m14:39:08.998698 [info ] [MainThread]: [31mCompleted with 3 errors and 0 warnings:[0m
[0m14:39:08.998698 [info ] [MainThread]: 
[0m14:39:09.000082 [error] [MainThread]:   Database Error in model orders_by_month (models\orders_by_month.sql)
  Not found: Table takehomechallenge:orders_recrutement.orders was not found in location EU
  compiled code at target\run\take_home_challenge\models\orders_by_month.sql
[0m14:39:09.000082 [info ] [MainThread]: 
[0m14:39:09.001118 [error] [MainThread]:   Database Error in model avg_products_per_order (models\avg_products_per_order.sql)
  Not found: Dataset takehomechallenge:sales_recrutement was not found in location EU
  compiled code at target\run\take_home_challenge\models\avg_products_per_order.sql
[0m14:39:09.001630 [info ] [MainThread]: 
[0m14:39:09.001630 [error] [MainThread]:   Database Error in model orders_2023 (models\orders_2023.sql)
  Not found: Table takehomechallenge:orders_recrutement.orders was not found in location EU
  compiled code at target\run\take_home_challenge\models\orders_2023.sql
[0m14:39:09.002788 [info ] [MainThread]: 
[0m14:39:09.002788 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=3 SKIP=0 TOTAL=3
[0m14:39:09.004337 [debug] [MainThread]: Command `dbt run` failed at 14:39:09.004337 after 7.43 seconds
[0m14:39:09.005473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D01F35340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D01F35010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023D13240200>]}
[0m14:39:09.005473 [debug] [MainThread]: Flushing usage events
[0m14:52:50.701766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD29887410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD278A9520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD26E4AF90>]}


============================== 14:52:50.707429 | 5d921b41-de1e-4513-a70e-73144d156534 ==============================
[0m14:52:50.707429 [info ] [MainThread]: Running with dbt=1.8.7
[0m14:52:50.708599 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\thoma\\PycharmProjects\\Take-Home challenge\\logs', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m14:52:52.815266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5d921b41-de1e-4513-a70e-73144d156534', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD3D0791F0>]}
[0m14:52:52.861707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5d921b41-de1e-4513-a70e-73144d156534', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD3BA7F5F0>]}
[0m14:52:52.862856 [info ] [MainThread]: Registered adapter: bigquery=1.8.3
[0m14:52:53.177769 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m14:52:53.323897 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:52:53.324895 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:52:53.350565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5d921b41-de1e-4513-a70e-73144d156534', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD3D2AECF0>]}
[0m14:52:53.460532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5d921b41-de1e-4513-a70e-73144d156534', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD3D627A10>]}
[0m14:52:53.461532 [info ] [MainThread]: Found 4 models, 2 sources, 484 macros
[0m14:52:53.461532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d921b41-de1e-4513-a70e-73144d156534', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD3D2DC0B0>]}
[0m14:52:53.464107 [info ] [MainThread]: 
[0m14:52:53.464615 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:52:53.468542 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge'
[0m14:52:53.468542 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:52:53.979854 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge_orders_recrutement'
[0m14:52:53.980870 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:52:54.360837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d921b41-de1e-4513-a70e-73144d156534', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD3D184C50>]}
[0m14:52:54.360837 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:52:54.362324 [info ] [MainThread]: 
[0m14:52:54.366941 [debug] [Thread-1 (]: Began running node model.take_home_challenge.avg_products_per_order
[0m14:52:54.367935 [debug] [Thread-2 (]: Began running node model.take_home_challenge.orders_2023
[0m14:52:54.367935 [debug] [Thread-3 (]: Began running node model.take_home_challenge.orders_by_month
[0m14:52:54.367935 [info ] [Thread-1 (]: 1 of 3 START sql view model orders_recrutement.avg_products_per_order .......... [RUN]
[0m14:52:54.369232 [info ] [Thread-2 (]: 2 of 3 START sql view model orders_recrutement.orders_2023 ..................... [RUN]
[0m14:52:54.369232 [info ] [Thread-3 (]: 3 of 3 START sql view model orders_recrutement.orders_by_month ................. [RUN]
[0m14:52:54.371614 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.take_home_challenge.avg_products_per_order'
[0m14:52:54.371614 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_2023'
[0m14:52:54.373048 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_by_month'
[0m14:52:54.374077 [debug] [Thread-1 (]: Began compiling node model.take_home_challenge.avg_products_per_order
[0m14:52:54.374077 [debug] [Thread-2 (]: Began compiling node model.take_home_challenge.orders_2023
[0m14:52:54.375083 [debug] [Thread-3 (]: Began compiling node model.take_home_challenge.orders_by_month
[0m14:52:54.382892 [debug] [Thread-1 (]: Writing injected SQL for node "model.take_home_challenge.avg_products_per_order"
[0m14:52:54.387864 [debug] [Thread-2 (]: Writing injected SQL for node "model.take_home_challenge.orders_2023"
[0m14:52:54.391853 [debug] [Thread-3 (]: Writing injected SQL for node "model.take_home_challenge.orders_by_month"
[0m14:52:54.393854 [debug] [Thread-1 (]: Began executing node model.take_home_challenge.avg_products_per_order
[0m14:52:54.394854 [debug] [Thread-2 (]: Began executing node model.take_home_challenge.orders_2023
[0m14:52:54.417547 [debug] [Thread-3 (]: Began executing node model.take_home_challenge.orders_by_month
[0m14:52:54.427389 [debug] [Thread-1 (]: Writing runtime sql for node "model.take_home_challenge.avg_products_per_order"
[0m14:52:54.429562 [debug] [Thread-2 (]: Writing runtime sql for node "model.take_home_challenge.orders_2023"
[0m14:52:54.433670 [debug] [Thread-3 (]: Writing runtime sql for node "model.take_home_challenge.orders_by_month"
[0m14:52:54.435710 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m14:52:54.436751 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:52:54.436751 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:52:54.438904 [debug] [Thread-1 (]: On model.take_home_challenge.avg_products_per_order: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.avg_products_per_order"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`avg_products_per_order`
  OPTIONS()
  as SELECT
  EXTRACT(MONTH FROM order_date) AS month,
  AVG(quantity) AS avg_products_per_order
FROM
  `takehomechallenge`.`sales_recrutement`.`sales`
WHERE
  EXTRACT(YEAR FROM order_date) = 2023
GROUP BY
  month
ORDER BY
  month;


[0m14:52:54.440060 [debug] [Thread-3 (]: On model.take_home_challenge.orders_by_month: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_by_month"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_by_month`
  OPTIONS()
  as SELECT
  EXTRACT(MONTH FROM order_date) AS month,
  COUNT(*) AS total_orders
FROM
  `takehomechallenge`.`orders_recrutement`.`orders`
WHERE
  EXTRACT(YEAR FROM order_date) = 2023
GROUP BY
  month
ORDER BY
  month;


[0m14:52:54.441084 [debug] [Thread-2 (]: On model.take_home_challenge.orders_2023: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2023"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2023`
  OPTIONS()
  as SELECT
  COUNT(*) AS total_orders_2023
FROM
  `takehomechallenge`.`orders_recrutement`.`orders`
WHERE
  EXTRACT(YEAR FROM order_date) = 2023;


[0m14:52:55.448574 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:3fa80b61-4f57-4e6f-a280-e2bedf95b75b&page=queryresults
[0m14:52:55.448574 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:d6cdb4e2-8e4c-4bbf-8464-0fff715ce609&page=queryresults
[0m14:52:55.449788 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:a151376d-0f2e-474c-9b27-48a874acd9e3&page=queryresults
[0m14:52:55.575319 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: order_date; Did you mean date_date? at [12:21]; reason: invalidQuery, location: query, message: Unrecognized name: order_date; Did you mean date_date? at [12:21]')
[0m14:52:55.590000 [debug] [Thread-3 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: order_date; Did you mean date_date? at [12:21]; reason: invalidQuery, location: query, message: Unrecognized name: order_date; Did you mean date_date? at [12:21]')
[0m14:52:55.594017 [debug] [Thread-2 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: order_date; Did you mean date_date? at [11:21]; reason: invalidQuery, location: query, message: Unrecognized name: order_date; Did you mean date_date? at [11:21]')
[0m14:52:56.479876 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:39a2e65a-199f-44c6-b1a3-12056aadde1f&page=queryresults
[0m14:52:56.603535 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:39a2e65a-199f-44c6-b1a3-12056aadde1f&page=queryresults
[0m14:52:56.619575 [debug] [Thread-3 (]: Database Error in model orders_by_month (models\orders_by_month.sql)
  Unrecognized name: order_date; Did you mean date_date? at [12:21]
  compiled code at target\run\take_home_challenge\models\orders_by_month.sql
[0m14:52:56.620587 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d921b41-de1e-4513-a70e-73144d156534', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD3B7C1670>]}
[0m14:52:56.621619 [error] [Thread-3 (]: 3 of 3 ERROR creating sql view model orders_recrutement.orders_by_month ........ [[31mERROR[0m in 2.25s]
[0m14:52:56.623624 [debug] [Thread-3 (]: Finished running node model.take_home_challenge.orders_by_month
[0m14:52:56.695114 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:71dbae81-c316-43df-bf46-8062c6382caf&page=queryresults
[0m14:52:56.817277 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:71dbae81-c316-43df-bf46-8062c6382caf&page=queryresults
[0m14:52:56.823358 [debug] [Thread-2 (]: Database Error in model orders_2023 (models\orders_2023.sql)
  Unrecognized name: order_date; Did you mean date_date? at [11:21]
  compiled code at target\run\take_home_challenge\models\orders_2023.sql
[0m14:52:56.824382 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d921b41-de1e-4513-a70e-73144d156534', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD3D69AA80>]}
[0m14:52:56.825382 [error] [Thread-2 (]: 2 of 3 ERROR creating sql view model orders_recrutement.orders_2023 ............ [[31mERROR[0m in 2.45s]
[0m14:52:56.826384 [debug] [Thread-2 (]: Finished running node model.take_home_challenge.orders_2023
[0m14:52:57.232560 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:d328ad17-23dd-4353-b967-d0138d412fcf&page=queryresults
[0m14:52:57.338709 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:d328ad17-23dd-4353-b967-d0138d412fcf&page=queryresults
[0m14:52:57.345634 [debug] [Thread-1 (]: Database Error in model avg_products_per_order (models\avg_products_per_order.sql)
  Unrecognized name: order_date; Did you mean date_date? at [12:21]
  compiled code at target\run\take_home_challenge\models\avg_products_per_order.sql
[0m14:52:57.347646 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d921b41-de1e-4513-a70e-73144d156534', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD3D698200>]}
[0m14:52:57.348930 [error] [Thread-1 (]: 1 of 3 ERROR creating sql view model orders_recrutement.avg_products_per_order . [[31mERROR[0m in 2.98s]
[0m14:52:57.351114 [debug] [Thread-1 (]: Finished running node model.take_home_challenge.avg_products_per_order
[0m14:52:57.354124 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:52:57.355123 [debug] [MainThread]: Connection 'list_takehomechallenge' was properly closed.
[0m14:52:57.356586 [debug] [MainThread]: Connection 'list_takehomechallenge_orders_recrutement' was properly closed.
[0m14:52:57.357098 [debug] [MainThread]: Connection 'model.take_home_challenge.avg_products_per_order' was properly closed.
[0m14:52:57.358494 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_2023' was properly closed.
[0m14:52:57.359697 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_by_month' was properly closed.
[0m14:52:57.359697 [info ] [MainThread]: 
[0m14:52:57.360977 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 3.90 seconds (3.90s).
[0m14:52:57.364426 [debug] [MainThread]: Command end result
[0m14:52:57.399532 [info ] [MainThread]: 
[0m14:52:57.399532 [info ] [MainThread]: [31mCompleted with 3 errors and 0 warnings:[0m
[0m14:52:57.400953 [info ] [MainThread]: 
[0m14:52:57.400953 [error] [MainThread]:   Database Error in model orders_by_month (models\orders_by_month.sql)
  Unrecognized name: order_date; Did you mean date_date? at [12:21]
  compiled code at target\run\take_home_challenge\models\orders_by_month.sql
[0m14:52:57.402182 [info ] [MainThread]: 
[0m14:52:57.402182 [error] [MainThread]:   Database Error in model orders_2023 (models\orders_2023.sql)
  Unrecognized name: order_date; Did you mean date_date? at [11:21]
  compiled code at target\run\take_home_challenge\models\orders_2023.sql
[0m14:52:57.403426 [info ] [MainThread]: 
[0m14:52:57.404436 [error] [MainThread]:   Database Error in model avg_products_per_order (models\avg_products_per_order.sql)
  Unrecognized name: order_date; Did you mean date_date? at [12:21]
  compiled code at target\run\take_home_challenge\models\avg_products_per_order.sql
[0m14:52:57.404436 [info ] [MainThread]: 
[0m14:52:57.405437 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=3 SKIP=0 TOTAL=3
[0m14:52:57.406710 [debug] [MainThread]: Command `dbt run` failed at 14:52:57.406710 after 6.86 seconds
[0m14:52:57.407716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD278A9520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD3D6BC860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD3D1C5F70>]}
[0m14:52:57.408312 [debug] [MainThread]: Flushing usage events
[0m15:05:02.380706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023E6E21FD10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023E6E39DEB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023E6E39F5F0>]}


============================== 15:05:02.385193 | b1a9fc66-ec23-4216-989e-823c6a55d5d9 ==============================
[0m15:05:02.385193 [info ] [MainThread]: Running with dbt=1.8.7
[0m15:05:02.386199 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\thoma\\PycharmProjects\\Take-Home challenge\\logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:05:06.945556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b1a9fc66-ec23-4216-989e-823c6a55d5d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023E6E5EF8C0>]}
[0m15:05:06.998865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b1a9fc66-ec23-4216-989e-823c6a55d5d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023E0158AE70>]}
[0m15:05:06.999876 [info ] [MainThread]: Registered adapter: bigquery=1.8.3
[0m15:05:07.407825 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m15:05:08.328027 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 3 files added, 3 files changed.
[0m15:05:08.329024 [debug] [MainThread]: Partial parsing: added file: take_home_challenge://models\orders_2022_2023_with_qty.sql
[0m15:05:08.329024 [debug] [MainThread]: Partial parsing: added file: take_home_challenge://models\orders_2023_with_segmentation.sql
[0m15:05:08.330384 [debug] [MainThread]: Partial parsing: added file: take_home_challenge://models\order_segmentation.sql
[0m15:05:08.330900 [debug] [MainThread]: Partial parsing: deleted file: take_home_challenge://models\sales_analysis.sql
[0m15:05:08.330900 [debug] [MainThread]: Partial parsing: updated file: take_home_challenge://models\orders_2023.sql
[0m15:05:08.330900 [debug] [MainThread]: Partial parsing: updated file: take_home_challenge://models\avg_products_per_order.sql
[0m15:05:08.332007 [debug] [MainThread]: Partial parsing: updated file: take_home_challenge://models\orders_by_month.sql
[0m15:05:08.537763 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b1a9fc66-ec23-4216-989e-823c6a55d5d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023E03166E70>]}
[0m15:05:08.638520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b1a9fc66-ec23-4216-989e-823c6a55d5d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023E0320BDA0>]}
[0m15:05:08.639964 [info ] [MainThread]: Found 6 models, 2 sources, 484 macros
[0m15:05:08.640968 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b1a9fc66-ec23-4216-989e-823c6a55d5d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023E02DE3530>]}
[0m15:05:08.642985 [info ] [MainThread]: 
[0m15:05:08.643982 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m15:05:08.647839 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge'
[0m15:05:08.648968 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:05:09.092481 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge_orders_recrutement'
[0m15:05:09.093502 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:05:09.490165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b1a9fc66-ec23-4216-989e-823c6a55d5d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023E0146D2E0>]}
[0m15:05:09.491229 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:05:09.492236 [info ] [MainThread]: 
[0m15:05:09.499697 [debug] [Thread-1 (]: Began running node model.take_home_challenge.avg_products_per_order
[0m15:05:09.500706 [debug] [Thread-2 (]: Began running node model.take_home_challenge.order_segmentation
[0m15:05:09.500706 [debug] [Thread-3 (]: Began running node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:05:09.501735 [debug] [Thread-4 (]: Began running node model.take_home_challenge.orders_2023
[0m15:05:09.501735 [info ] [Thread-1 (]: 1 of 6 START sql view model orders_recrutement.avg_products_per_order .......... [RUN]
[0m15:05:09.502865 [info ] [Thread-2 (]: 2 of 6 START sql view model orders_recrutement.order_segmentation .............. [RUN]
[0m15:05:09.504341 [info ] [Thread-3 (]: 3 of 6 START sql view model orders_recrutement.orders_2022_2023_with_qty ....... [RUN]
[0m15:05:09.505350 [info ] [Thread-4 (]: 4 of 6 START sql view model orders_recrutement.orders_2023 ..................... [RUN]
[0m15:05:09.506349 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.take_home_challenge.avg_products_per_order'
[0m15:05:09.507349 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.take_home_challenge.order_segmentation'
[0m15:05:09.508351 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_2022_2023_with_qty'
[0m15:05:09.509350 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_2023'
[0m15:05:09.510348 [debug] [Thread-1 (]: Began compiling node model.take_home_challenge.avg_products_per_order
[0m15:05:09.511346 [debug] [Thread-2 (]: Began compiling node model.take_home_challenge.order_segmentation
[0m15:05:09.511346 [debug] [Thread-3 (]: Began compiling node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:05:09.512355 [debug] [Thread-4 (]: Began compiling node model.take_home_challenge.orders_2023
[0m15:05:09.519674 [debug] [Thread-1 (]: Writing injected SQL for node "model.take_home_challenge.avg_products_per_order"
[0m15:05:09.521184 [debug] [Thread-2 (]: Writing injected SQL for node "model.take_home_challenge.order_segmentation"
[0m15:05:09.523426 [debug] [Thread-3 (]: Writing injected SQL for node "model.take_home_challenge.orders_2022_2023_with_qty"
[0m15:05:09.524659 [debug] [Thread-4 (]: Writing injected SQL for node "model.take_home_challenge.orders_2023"
[0m15:05:09.525667 [debug] [Thread-1 (]: Began executing node model.take_home_challenge.avg_products_per_order
[0m15:05:09.526691 [debug] [Thread-2 (]: Began executing node model.take_home_challenge.order_segmentation
[0m15:05:09.527697 [debug] [Thread-3 (]: Began executing node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:05:09.557474 [debug] [Thread-1 (]: Writing runtime sql for node "model.take_home_challenge.avg_products_per_order"
[0m15:05:09.557474 [debug] [Thread-4 (]: Began executing node model.take_home_challenge.orders_2023
[0m15:05:09.560372 [debug] [Thread-2 (]: Writing runtime sql for node "model.take_home_challenge.order_segmentation"
[0m15:05:09.571163 [debug] [Thread-4 (]: Writing runtime sql for node "model.take_home_challenge.orders_2023"
[0m15:05:09.572163 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m15:05:09.573322 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:05:09.574330 [debug] [Thread-1 (]: On model.take_home_challenge.avg_products_per_order: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.avg_products_per_order"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`avg_products_per_order`
  OPTIONS()
  as SELECT
    EXTRACT(MONTH FROM date_date) AS month,
    AVG(qty) AS avg_products_per_order
FROM
    takehomechallenge.sales_recrutement.sales
WHERE
    EXTRACT(YEAR FROM date_date) = 2023
GROUP BY
    month
ORDER BY
    month;


[0m15:05:09.575353 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:05:09.577384 [debug] [Thread-2 (]: On model.take_home_challenge.order_segmentation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.order_segmentation"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`order_segmentation`
  OPTIONS()
  as WITH order_counts AS (
    SELECT
        o.orders_id,
        o.customers_id AS client_id,
        o.date_date AS order_date,
        COUNT(*) OVER (PARTITION BY o.customers_id
                       ORDER BY o.date_date
                       RANGE BETWEEN INTERVAL 12 MONTH PRECEDING AND CURRENT ROW) AS orders_in_last_12_months
    FROM
        takehomechallenge.orders_recrutement.orders o
    WHERE
        EXTRACT(YEAR FROM o.date_date) = 2023
)
SELECT
    o.orders_id,
    o.client_id,
    o.order_date,
    CASE
        WHEN o.orders_in_last_12_months = 1 THEN 'New'
        WHEN o.orders_in_last_12_months BETWEEN 2 AND 4 THEN 'Returning'
        WHEN o.orders_in_last_12_months >= 5 THEN 'VIP'
        ELSE 'Unknown'
    END AS order_segment
FROM
    order_counts o
ORDER BY
    o.order_date, o.client_id;;


[0m15:05:09.627040 [debug] [Thread-4 (]: On model.take_home_challenge.orders_2023: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2023"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2023`
  OPTIONS()
  as SELECT
    COUNT(*) AS total_orders_2023
FROM
    takehomechallenge.orders_recrutement.orders
WHERE
    EXTRACT(YEAR FROM date_date) = 2023;


[0m15:05:09.697554 [debug] [Thread-3 (]: Compilation Error in model orders_2022_2023_with_qty (models\orders_2022_2023_with_qty.sql)
  Trying to create view `takehomechallenge`.`orders_recrutement`.`orders_2022_2023_with_qty`, but it currently exists as a table. Either drop `takehomechallenge`.`orders_recrutement`.`orders_2022_2023_with_qty` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model orders_2022_2023_with_qty (models\orders_2022_2023_with_qty.sql)
[0m15:05:09.700026 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b1a9fc66-ec23-4216-989e-823c6a55d5d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023E6E710C50>]}
[0m15:05:09.700026 [error] [Thread-3 (]: 3 of 6 ERROR creating sql view model orders_recrutement.orders_2022_2023_with_qty  [[31mERROR[0m in 0.19s]
[0m15:05:09.701139 [debug] [Thread-3 (]: Finished running node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:05:09.701139 [debug] [Thread-3 (]: Began running node model.take_home_challenge.orders_2023_with_segmentation
[0m15:05:09.703566 [info ] [Thread-3 (]: 5 of 6 START sql view model orders_recrutement.orders_2023_with_segmentation ... [RUN]
[0m15:05:09.704594 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.take_home_challenge.orders_2022_2023_with_qty, now model.take_home_challenge.orders_2023_with_segmentation)
[0m15:05:09.704594 [debug] [Thread-3 (]: Began compiling node model.take_home_challenge.orders_2023_with_segmentation
[0m15:05:09.708261 [debug] [Thread-3 (]: Writing injected SQL for node "model.take_home_challenge.orders_2023_with_segmentation"
[0m15:05:09.709259 [debug] [Thread-3 (]: Began executing node model.take_home_challenge.orders_2023_with_segmentation
[0m15:05:09.777748 [debug] [Thread-3 (]: Compilation Error in model orders_2023_with_segmentation (models\orders_2023_with_segmentation.sql)
  Trying to create view `takehomechallenge`.`orders_recrutement`.`orders_2023_with_segmentation`, but it currently exists as a table. Either drop `takehomechallenge`.`orders_recrutement`.`orders_2023_with_segmentation` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model orders_2023_with_segmentation (models\orders_2023_with_segmentation.sql)
[0m15:05:09.778747 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b1a9fc66-ec23-4216-989e-823c6a55d5d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023E0331C1A0>]}
[0m15:05:09.779953 [error] [Thread-3 (]: 5 of 6 ERROR creating sql view model orders_recrutement.orders_2023_with_segmentation  [[31mERROR[0m in 0.07s]
[0m15:05:09.780986 [debug] [Thread-3 (]: Finished running node model.take_home_challenge.orders_2023_with_segmentation
[0m15:05:09.780986 [debug] [Thread-3 (]: Began running node model.take_home_challenge.orders_by_month
[0m15:05:09.782190 [info ] [Thread-3 (]: 6 of 6 START sql view model orders_recrutement.orders_by_month ................. [RUN]
[0m15:05:09.782190 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.take_home_challenge.orders_2023_with_segmentation, now model.take_home_challenge.orders_by_month)
[0m15:05:09.783240 [debug] [Thread-3 (]: Began compiling node model.take_home_challenge.orders_by_month
[0m15:05:09.785277 [debug] [Thread-3 (]: Writing injected SQL for node "model.take_home_challenge.orders_by_month"
[0m15:05:09.786320 [debug] [Thread-3 (]: Began executing node model.take_home_challenge.orders_by_month
[0m15:05:09.788830 [debug] [Thread-3 (]: Writing runtime sql for node "model.take_home_challenge.orders_by_month"
[0m15:05:09.789831 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m15:05:09.791831 [debug] [Thread-3 (]: On model.take_home_challenge.orders_by_month: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_by_month"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_by_month`
  OPTIONS()
  as SELECT
    EXTRACT(MONTH FROM date_date) AS month,
    COUNT(*) AS total_orders
FROM
    takehomechallenge.orders_recrutement.orders
WHERE
    EXTRACT(YEAR FROM date_date) = 2023
GROUP BY
    month
ORDER BY
    month;


[0m15:05:10.115067 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:860c3434-e053-49e4-b8e4-9b01ae84b41c&page=queryresults
[0m15:05:10.116084 [debug] [Thread-2 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected ";" at [32:31]; reason: invalidQuery, location: query, message: Syntax error: Unexpected ";" at [32:31]')
[0m15:05:10.414574 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:1557059b-dbdc-484c-b833-d2b3928c8986&page=queryresults
[0m15:05:10.439553 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:c0822edb-0cf8-4eb2-b6cf-7613653c2a09&page=queryresults
[0m15:05:10.501779 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:7e1ccc1f-d6c6-4674-9f37-1410d43fe1b2&page=queryresults
[0m15:05:10.709307 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:0bc9fc43-55af-45ae-8ca6-9d914127996c&page=queryresults
[0m15:05:10.709837 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:0bc9fc43-55af-45ae-8ca6-9d914127996c&page=queryresults
[0m15:05:10.788356 [debug] [Thread-2 (]: Database Error in model order_segmentation (models\order_segmentation.sql)
  Syntax error: Unexpected ";" at [32:31]
  compiled code at target\run\take_home_challenge\models\order_segmentation.sql
[0m15:05:10.789509 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b1a9fc66-ec23-4216-989e-823c6a55d5d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023E02F48440>]}
[0m15:05:10.789509 [error] [Thread-2 (]: 2 of 6 ERROR creating sql view model orders_recrutement.order_segmentation ..... [[31mERROR[0m in 1.28s]
[0m15:05:10.790526 [debug] [Thread-2 (]: Finished running node model.take_home_challenge.order_segmentation
[0m15:05:10.836501 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b1a9fc66-ec23-4216-989e-823c6a55d5d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023E02DE18B0>]}
[0m15:05:10.840061 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b1a9fc66-ec23-4216-989e-823c6a55d5d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023E02F4BBF0>]}
[0m15:05:10.840963 [info ] [Thread-1 (]: 1 of 6 OK created sql view model orders_recrutement.avg_products_per_order ..... [[32mCREATE VIEW (0 processed)[0m in 1.33s]
[0m15:05:10.841959 [info ] [Thread-4 (]: 4 of 6 OK created sql view model orders_recrutement.orders_2023 ................ [[32mCREATE VIEW (0 processed)[0m in 1.33s]
[0m15:05:10.841959 [debug] [Thread-1 (]: Finished running node model.take_home_challenge.avg_products_per_order
[0m15:05:10.843374 [debug] [Thread-4 (]: Finished running node model.take_home_challenge.orders_2023
[0m15:05:10.910030 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b1a9fc66-ec23-4216-989e-823c6a55d5d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023E03074890>]}
[0m15:05:10.911029 [info ] [Thread-3 (]: 6 of 6 OK created sql view model orders_recrutement.orders_by_month ............ [[32mCREATE VIEW (0 processed)[0m in 1.13s]
[0m15:05:10.912132 [debug] [Thread-3 (]: Finished running node model.take_home_challenge.orders_by_month
[0m15:05:10.914776 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:05:10.915862 [debug] [MainThread]: Connection 'list_takehomechallenge' was properly closed.
[0m15:05:10.915862 [debug] [MainThread]: Connection 'list_takehomechallenge_orders_recrutement' was properly closed.
[0m15:05:10.916868 [debug] [MainThread]: Connection 'model.take_home_challenge.avg_products_per_order' was properly closed.
[0m15:05:10.916868 [debug] [MainThread]: Connection 'model.take_home_challenge.order_segmentation' was properly closed.
[0m15:05:10.917869 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_by_month' was properly closed.
[0m15:05:10.918869 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_2023' was properly closed.
[0m15:05:10.918869 [info ] [MainThread]: 
[0m15:05:10.919868 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 2.27 seconds (2.27s).
[0m15:05:10.921879 [debug] [MainThread]: Command end result
[0m15:05:10.953242 [info ] [MainThread]: 
[0m15:05:10.954245 [info ] [MainThread]: [31mCompleted with 3 errors and 0 warnings:[0m
[0m15:05:10.954245 [info ] [MainThread]: 
[0m15:05:10.957651 [error] [MainThread]:   Compilation Error in model orders_2022_2023_with_qty (models\orders_2022_2023_with_qty.sql)
  Trying to create view `takehomechallenge`.`orders_recrutement`.`orders_2022_2023_with_qty`, but it currently exists as a table. Either drop `takehomechallenge`.`orders_recrutement`.`orders_2022_2023_with_qty` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model orders_2022_2023_with_qty (models\orders_2022_2023_with_qty.sql)
[0m15:05:10.957651 [info ] [MainThread]: 
[0m15:05:10.959139 [error] [MainThread]:   Compilation Error in model orders_2023_with_segmentation (models\orders_2023_with_segmentation.sql)
  Trying to create view `takehomechallenge`.`orders_recrutement`.`orders_2023_with_segmentation`, but it currently exists as a table. Either drop `takehomechallenge`.`orders_recrutement`.`orders_2023_with_segmentation` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model orders_2023_with_segmentation (models\orders_2023_with_segmentation.sql)
[0m15:05:10.960143 [info ] [MainThread]: 
[0m15:05:10.961251 [error] [MainThread]:   Database Error in model order_segmentation (models\order_segmentation.sql)
  Syntax error: Unexpected ";" at [32:31]
  compiled code at target\run\take_home_challenge\models\order_segmentation.sql
[0m15:05:10.962530 [info ] [MainThread]: 
[0m15:05:10.962530 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=3 SKIP=0 TOTAL=6
[0m15:05:10.963945 [debug] [MainThread]: Command `dbt run` failed at 15:05:10.963945 after 8.77 seconds
[0m15:05:10.964972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023E6DE7A270>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023E6DB28A70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023E6E21F4D0>]}
[0m15:05:10.964972 [debug] [MainThread]: Flushing usage events
[0m15:05:47.967131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028682A953A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000286803164B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000286828C36E0>]}


============================== 15:05:47.970915 | 1e65061a-40e7-4cab-b167-690d88c5191f ==============================
[0m15:05:47.970915 [info ] [MainThread]: Running with dbt=1.8.7
[0m15:05:47.971990 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\thoma\\PycharmProjects\\Take-Home challenge\\logs', 'debug': 'False', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --full-refresh', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:05:49.299399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1e65061a-40e7-4cab-b167-690d88c5191f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000286829BBE60>]}
[0m15:05:49.350434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1e65061a-40e7-4cab-b167-690d88c5191f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028693EAD970>]}
[0m15:05:49.350434 [info ] [MainThread]: Registered adapter: bigquery=1.8.3
[0m15:05:49.805218 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m15:05:49.963255 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:05:49.963255 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:05:49.992355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1e65061a-40e7-4cab-b167-690d88c5191f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028682DE0A70>]}
[0m15:05:50.097763 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1e65061a-40e7-4cab-b167-690d88c5191f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028695BB7B60>]}
[0m15:05:50.098762 [info ] [MainThread]: Found 6 models, 2 sources, 484 macros
[0m15:05:50.099795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1e65061a-40e7-4cab-b167-690d88c5191f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000286FF1B8530>]}
[0m15:05:50.102444 [info ] [MainThread]: 
[0m15:05:50.103734 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m15:05:50.108761 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge'
[0m15:05:50.108761 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:05:50.490517 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge_orders_recrutement'
[0m15:05:50.491535 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:05:50.916202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1e65061a-40e7-4cab-b167-690d88c5191f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000286808D4860>]}
[0m15:05:50.918311 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:05:50.921029 [info ] [MainThread]: 
[0m15:05:50.934415 [debug] [Thread-1 (]: Began running node model.take_home_challenge.avg_products_per_order
[0m15:05:50.934928 [debug] [Thread-2 (]: Began running node model.take_home_challenge.order_segmentation
[0m15:05:50.936471 [debug] [Thread-3 (]: Began running node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:05:50.937484 [debug] [Thread-4 (]: Began running node model.take_home_challenge.orders_2023
[0m15:05:50.938499 [info ] [Thread-1 (]: 1 of 6 START sql view model orders_recrutement.avg_products_per_order .......... [RUN]
[0m15:05:50.940800 [info ] [Thread-2 (]: 2 of 6 START sql view model orders_recrutement.order_segmentation .............. [RUN]
[0m15:05:50.942336 [info ] [Thread-3 (]: 3 of 6 START sql view model orders_recrutement.orders_2022_2023_with_qty ....... [RUN]
[0m15:05:50.943337 [info ] [Thread-4 (]: 4 of 6 START sql view model orders_recrutement.orders_2023 ..................... [RUN]
[0m15:05:50.944624 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.take_home_challenge.avg_products_per_order'
[0m15:05:50.946911 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.take_home_challenge.order_segmentation'
[0m15:05:50.948238 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_2022_2023_with_qty'
[0m15:05:50.949274 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_2023'
[0m15:05:50.950308 [debug] [Thread-1 (]: Began compiling node model.take_home_challenge.avg_products_per_order
[0m15:05:50.952298 [debug] [Thread-2 (]: Began compiling node model.take_home_challenge.order_segmentation
[0m15:05:50.953338 [debug] [Thread-3 (]: Began compiling node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:05:50.954360 [debug] [Thread-4 (]: Began compiling node model.take_home_challenge.orders_2023
[0m15:05:50.969990 [debug] [Thread-1 (]: Writing injected SQL for node "model.take_home_challenge.avg_products_per_order"
[0m15:05:50.972147 [debug] [Thread-2 (]: Writing injected SQL for node "model.take_home_challenge.order_segmentation"
[0m15:05:50.974601 [debug] [Thread-3 (]: Writing injected SQL for node "model.take_home_challenge.orders_2022_2023_with_qty"
[0m15:05:50.976628 [debug] [Thread-4 (]: Writing injected SQL for node "model.take_home_challenge.orders_2023"
[0m15:05:50.977627 [debug] [Thread-1 (]: Began executing node model.take_home_challenge.avg_products_per_order
[0m15:05:50.987407 [debug] [Thread-2 (]: Began executing node model.take_home_challenge.order_segmentation
[0m15:05:50.988408 [debug] [Thread-3 (]: Began executing node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:05:51.009133 [debug] [Thread-1 (]: Writing runtime sql for node "model.take_home_challenge.avg_products_per_order"
[0m15:05:51.012535 [debug] [Thread-2 (]: Writing runtime sql for node "model.take_home_challenge.order_segmentation"
[0m15:05:51.013535 [debug] [Thread-4 (]: Began executing node model.take_home_challenge.orders_2023
[0m15:05:51.020708 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:05:51.024207 [debug] [Thread-4 (]: Writing runtime sql for node "model.take_home_challenge.orders_2023"
[0m15:05:51.025236 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m15:05:51.025236 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:05:51.051512 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:05:51.053554 [debug] [Thread-1 (]: On model.take_home_challenge.avg_products_per_order: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.avg_products_per_order"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`avg_products_per_order`
  OPTIONS()
  as SELECT
    EXTRACT(MONTH FROM date_date) AS month,
    AVG(qty) AS avg_products_per_order
FROM
    takehomechallenge.sales_recrutement.sales
WHERE
    EXTRACT(YEAR FROM date_date) = 2023
GROUP BY
    month
ORDER BY
    month;


[0m15:05:51.054567 [debug] [Thread-2 (]: On model.take_home_challenge.order_segmentation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.order_segmentation"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`order_segmentation`
  OPTIONS()
  as WITH order_counts AS (
    SELECT
        o.orders_id,
        o.customers_id AS client_id,
        o.date_date AS order_date,
        COUNT(*) OVER (PARTITION BY o.customers_id
                       ORDER BY o.date_date
                       RANGE BETWEEN INTERVAL 12 MONTH PRECEDING AND CURRENT ROW) AS orders_in_last_12_months
    FROM
        takehomechallenge.orders_recrutement.orders o
    WHERE
        EXTRACT(YEAR FROM o.date_date) = 2023
)
SELECT
    o.orders_id,
    o.client_id,
    o.order_date,
    CASE
        WHEN o.orders_in_last_12_months = 1 THEN 'New'
        WHEN o.orders_in_last_12_months BETWEEN 2 AND 4 THEN 'Returning'
        WHEN o.orders_in_last_12_months >= 5 THEN 'VIP'
        ELSE 'Unknown'
    END AS order_segment
FROM
    order_counts o
ORDER BY
    o.order_date, o.client_id;;


[0m15:05:51.057281 [debug] [Thread-4 (]: On model.take_home_challenge.orders_2023: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2023"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2023`
  OPTIONS()
  as SELECT
    COUNT(*) AS total_orders_2023
FROM
    takehomechallenge.orders_recrutement.orders
WHERE
    EXTRACT(YEAR FROM date_date) = 2023;


[0m15:05:51.493809 [debug] [Thread-3 (]: Writing runtime sql for node "model.take_home_challenge.orders_2022_2023_with_qty"
[0m15:05:51.496206 [debug] [Thread-3 (]: On model.take_home_challenge.orders_2022_2023_with_qty: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2022_2023_with_qty"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2022_2023_with_qty`
  OPTIONS()
  as CREATE OR REPLACE TABLE takehomechallenge.orders_recrutement.orders_2022_2023_with_qty AS
SELECT
    o.date_date AS order_date,
    o.customers_id,
    o.orders_id,
    o.CA_ht,
    SUM(s.qty) AS qty_product  -- Calcul de la quantité totale de produits par commande
FROM
    takehomechallenge.orders_recrutement.orders o
JOIN
    takehomechallenge.sales_recrutement.sales s
ON
    o.customers_id = s.client_id
    AND o.orders_id = s.transaction_id  -- Lier chaque commande à ses produits
WHERE
    EXTRACT(YEAR FROM o.date_date) IN (2022, 2023)  -- Filtrer pour 2022 et 2023
GROUP BY
    o.date_date, o.customers_id, o.orders_id, o.CA_ht
ORDER BY
    o.date_date, o.orders_id;;


[0m15:05:51.511847 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:e423b007-af73-4e21-8a3e-d77077851774&page=queryresults
[0m15:05:51.512862 [debug] [Thread-2 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected ";" at [32:31]; reason: invalidQuery, location: query, message: Syntax error: Unexpected ";" at [32:31]')
[0m15:05:51.706069 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:6147d701-45f9-4636-9be1-c8e4d3dccb8a&page=queryresults
[0m15:05:51.706069 [debug] [Thread-3 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected keyword CREATE at [6:6]; reason: invalidQuery, location: query, message: Syntax error: Unexpected keyword CREATE at [6:6]')
[0m15:05:51.844289 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:c18b4b7a-5fa9-4c7c-9e79-86ae105af573&page=queryresults
[0m15:05:51.854875 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:4d118301-5970-425e-96fb-90ae1be5ac55&page=queryresults
[0m15:05:51.855916 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:4d118301-5970-425e-96fb-90ae1be5ac55&page=queryresults
[0m15:05:51.862396 [debug] [Thread-2 (]: Database Error in model order_segmentation (models\order_segmentation.sql)
  Syntax error: Unexpected ";" at [32:31]
  compiled code at target\run\take_home_challenge\models\order_segmentation.sql
[0m15:05:51.863910 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:cbb1a12a-217e-4489-be3c-9915b229fe54&page=queryresults
[0m15:05:51.865170 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e65061a-40e7-4cab-b167-690d88c5191f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028695854B60>]}
[0m15:05:51.868866 [error] [Thread-2 (]: 2 of 6 ERROR creating sql view model orders_recrutement.order_segmentation ..... [[31mERROR[0m in 0.92s]
[0m15:05:51.869918 [debug] [Thread-2 (]: Finished running node model.take_home_challenge.order_segmentation
[0m15:05:51.869918 [debug] [Thread-2 (]: Began running node model.take_home_challenge.orders_2023_with_segmentation
[0m15:05:51.871419 [info ] [Thread-2 (]: 5 of 6 START sql view model orders_recrutement.orders_2023_with_segmentation ... [RUN]
[0m15:05:51.872447 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.take_home_challenge.order_segmentation, now model.take_home_challenge.orders_2023_with_segmentation)
[0m15:05:51.872447 [debug] [Thread-2 (]: Began compiling node model.take_home_challenge.orders_2023_with_segmentation
[0m15:05:51.875933 [debug] [Thread-2 (]: Writing injected SQL for node "model.take_home_challenge.orders_2023_with_segmentation"
[0m15:05:51.876933 [debug] [Thread-2 (]: Began executing node model.take_home_challenge.orders_2023_with_segmentation
[0m15:05:51.882119 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:05:52.011289 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:4d5134c6-3a6a-4dbd-a50b-4b9f5b1887b8&page=queryresults
[0m15:05:52.011831 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:4d5134c6-3a6a-4dbd-a50b-4b9f5b1887b8&page=queryresults
[0m15:05:52.015859 [debug] [Thread-3 (]: Database Error in model orders_2022_2023_with_qty (models\orders_2022_2023_with_qty.sql)
  Syntax error: Unexpected keyword CREATE at [6:6]
  compiled code at target\run\take_home_challenge\models\orders_2022_2023_with_qty.sql
[0m15:05:52.016934 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e65061a-40e7-4cab-b167-690d88c5191f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028695C31610>]}
[0m15:05:52.016934 [error] [Thread-3 (]: 3 of 6 ERROR creating sql view model orders_recrutement.orders_2022_2023_with_qty  [[31mERROR[0m in 1.07s]
[0m15:05:52.018118 [debug] [Thread-3 (]: Finished running node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:05:52.019415 [debug] [Thread-3 (]: Began running node model.take_home_challenge.orders_by_month
[0m15:05:52.019415 [info ] [Thread-3 (]: 6 of 6 START sql view model orders_recrutement.orders_by_month ................. [RUN]
[0m15:05:52.020421 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.take_home_challenge.orders_2022_2023_with_qty, now model.take_home_challenge.orders_by_month)
[0m15:05:52.021427 [debug] [Thread-3 (]: Began compiling node model.take_home_challenge.orders_by_month
[0m15:05:52.023493 [debug] [Thread-3 (]: Writing injected SQL for node "model.take_home_challenge.orders_by_month"
[0m15:05:52.024498 [debug] [Thread-3 (]: Began executing node model.take_home_challenge.orders_by_month
[0m15:05:52.027532 [debug] [Thread-3 (]: Writing runtime sql for node "model.take_home_challenge.orders_by_month"
[0m15:05:52.028534 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m15:05:52.030534 [debug] [Thread-3 (]: On model.take_home_challenge.orders_by_month: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_by_month"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_by_month`
  OPTIONS()
  as SELECT
    EXTRACT(MONTH FROM date_date) AS month,
    COUNT(*) AS total_orders
FROM
    takehomechallenge.orders_recrutement.orders
WHERE
    EXTRACT(YEAR FROM date_date) = 2023
GROUP BY
    month
ORDER BY
    month;


[0m15:05:52.266751 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e65061a-40e7-4cab-b167-690d88c5191f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028696112150>]}
[0m15:05:52.269831 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e65061a-40e7-4cab-b167-690d88c5191f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028695ACCB00>]}
[0m15:05:52.271894 [debug] [Thread-2 (]: Writing runtime sql for node "model.take_home_challenge.orders_2023_with_segmentation"
[0m15:05:52.270859 [info ] [Thread-4 (]: 4 of 6 OK created sql view model orders_recrutement.orders_2023 ................ [[32mCREATE VIEW (0 processed)[0m in 1.32s]
[0m15:05:52.272933 [info ] [Thread-1 (]: 1 of 6 OK created sql view model orders_recrutement.avg_products_per_order ..... [[32mCREATE VIEW (0 processed)[0m in 1.33s]
[0m15:05:52.274008 [debug] [Thread-4 (]: Finished running node model.take_home_challenge.orders_2023
[0m15:05:52.274008 [debug] [Thread-1 (]: Finished running node model.take_home_challenge.avg_products_per_order
[0m15:05:52.275509 [debug] [Thread-2 (]: On model.take_home_challenge.orders_2023_with_segmentation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2023_with_segmentation"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2023_with_segmentation`
  OPTIONS()
  as CREATE OR REPLACE TABLE takehomechallenge.orders_recrutement.orders_2023_with_segmentation AS
WITH order_counts AS (
    SELECT
        o.orders_id,
        o.customers_id AS client_id,
        o.date_date AS order_date,
        o.CA_ht,  -- Assurez-vous de sélectionner CA_ht dans la sous-requête
        COUNT(*) OVER (PARTITION BY o.customers_id
                       ORDER BY o.date_date
                       ROWS BETWEEN 12 PRECEDING AND CURRENT ROW) AS orders_in_last_12_months
    FROM
        takehomechallenge.orders_recrutement.orders o
    WHERE
        EXTRACT(YEAR FROM o.date_date) = 2023
)
SELECT
    o.orders_id,
    o.client_id,
    o.order_date,
    o.CA_ht,
    CASE
        WHEN o.orders_in_last_12_months = 1 THEN 'New'
        WHEN o.orders_in_last_12_months BETWEEN 2 AND 4 THEN 'Returning'
        WHEN o.orders_in_last_12_months >= 5 THEN 'VIP'
        ELSE 'Unknown'
    END AS order_segmentation
FROM
    order_counts o;;


[0m15:05:52.481073 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:8c81f6e7-a532-450d-8526-a558a9f97fe7&page=queryresults
[0m15:05:52.482211 [debug] [Thread-2 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected keyword CREATE at [6:6]; reason: invalidQuery, location: query, message: Syntax error: Unexpected keyword CREATE at [6:6]')
[0m15:05:52.706576 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:5bda53a7-65ba-4571-a9d8-ef614882e838&page=queryresults
[0m15:05:53.131143 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e65061a-40e7-4cab-b167-690d88c5191f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028696151C40>]}
[0m15:05:53.132149 [info ] [Thread-3 (]: 6 of 6 OK created sql view model orders_recrutement.orders_by_month ............ [[32mCREATE VIEW (0 processed)[0m in 1.11s]
[0m15:05:53.134191 [debug] [Thread-3 (]: Finished running node model.take_home_challenge.orders_by_month
[0m15:05:53.578360 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:3205517e-61c7-4437-8098-ab4d09e5c577&page=queryresults
[0m15:05:53.579371 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:3205517e-61c7-4437-8098-ab4d09e5c577&page=queryresults
[0m15:05:53.584655 [debug] [Thread-2 (]: Database Error in model orders_2023_with_segmentation (models\orders_2023_with_segmentation.sql)
  Syntax error: Unexpected keyword CREATE at [6:6]
  compiled code at target\run\take_home_challenge\models\orders_2023_with_segmentation.sql
[0m15:05:53.585178 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e65061a-40e7-4cab-b167-690d88c5191f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028695C9B5F0>]}
[0m15:05:53.586291 [error] [Thread-2 (]: 5 of 6 ERROR creating sql view model orders_recrutement.orders_2023_with_segmentation  [[31mERROR[0m in 1.71s]
[0m15:05:53.587348 [debug] [Thread-2 (]: Finished running node model.take_home_challenge.orders_2023_with_segmentation
[0m15:05:53.589136 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:05:53.589136 [debug] [MainThread]: Connection 'list_takehomechallenge' was properly closed.
[0m15:05:53.590347 [debug] [MainThread]: Connection 'list_takehomechallenge_orders_recrutement' was properly closed.
[0m15:05:53.590347 [debug] [MainThread]: Connection 'model.take_home_challenge.avg_products_per_order' was properly closed.
[0m15:05:53.591354 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_2023_with_segmentation' was properly closed.
[0m15:05:53.591354 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_by_month' was properly closed.
[0m15:05:53.591354 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_2023' was properly closed.
[0m15:05:53.592359 [info ] [MainThread]: 
[0m15:05:53.593389 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.49 seconds (3.49s).
[0m15:05:53.594433 [debug] [MainThread]: Command end result
[0m15:05:53.630822 [info ] [MainThread]: 
[0m15:05:53.631857 [info ] [MainThread]: [31mCompleted with 3 errors and 0 warnings:[0m
[0m15:05:53.632975 [info ] [MainThread]: 
[0m15:05:53.633994 [error] [MainThread]:   Database Error in model order_segmentation (models\order_segmentation.sql)
  Syntax error: Unexpected ";" at [32:31]
  compiled code at target\run\take_home_challenge\models\order_segmentation.sql
[0m15:05:53.635328 [info ] [MainThread]: 
[0m15:05:53.636334 [error] [MainThread]:   Database Error in model orders_2022_2023_with_qty (models\orders_2022_2023_with_qty.sql)
  Syntax error: Unexpected keyword CREATE at [6:6]
  compiled code at target\run\take_home_challenge\models\orders_2022_2023_with_qty.sql
[0m15:05:53.637735 [info ] [MainThread]: 
[0m15:05:53.637735 [error] [MainThread]:   Database Error in model orders_2023_with_segmentation (models\orders_2023_with_segmentation.sql)
  Syntax error: Unexpected keyword CREATE at [6:6]
  compiled code at target\run\take_home_challenge\models\orders_2023_with_segmentation.sql
[0m15:05:53.639228 [info ] [MainThread]: 
[0m15:05:53.640235 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=3 SKIP=0 TOTAL=6
[0m15:05:53.641236 [debug] [MainThread]: Command `dbt run` failed at 15:05:53.641236 after 5.79 seconds
[0m15:05:53.642236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028682C60590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028682C9B9E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028682549940>]}
[0m15:05:53.643246 [debug] [MainThread]: Flushing usage events
[0m15:07:37.190884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023210B03B60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002320E1865A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000232107792B0>]}


============================== 15:07:37.195158 | 91b6294d-5906-429f-97aa-660007cd1947 ==============================
[0m15:07:37.195158 [info ] [MainThread]: Running with dbt=1.8.7
[0m15:07:37.196162 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\thoma\\PycharmProjects\\Take-Home challenge\\logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --full-refresh', 'send_anonymous_usage_stats': 'True'}
[0m15:07:38.649954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '91b6294d-5906-429f-97aa-660007cd1947', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000232234AEB10>]}
[0m15:07:38.698466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '91b6294d-5906-429f-97aa-660007cd1947', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002320E748920>]}
[0m15:07:38.698466 [info ] [MainThread]: Registered adapter: bigquery=1.8.3
[0m15:07:38.998803 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m15:07:39.131466 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m15:07:39.131466 [debug] [MainThread]: Partial parsing: updated file: take_home_challenge://models\orders_2023_with_segmentation.sql
[0m15:07:39.132597 [debug] [MainThread]: Partial parsing: updated file: take_home_challenge://models\order_segmentation.sql
[0m15:07:39.332913 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '91b6294d-5906-429f-97aa-660007cd1947', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023223A5B620>]}
[0m15:07:39.426289 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '91b6294d-5906-429f-97aa-660007cd1947', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023223B56BD0>]}
[0m15:07:39.427288 [info ] [MainThread]: Found 6 models, 2 sources, 484 macros
[0m15:07:39.428290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '91b6294d-5906-429f-97aa-660007cd1947', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023223893530>]}
[0m15:07:39.430361 [info ] [MainThread]: 
[0m15:07:39.431365 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m15:07:39.436374 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge'
[0m15:07:39.437400 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:07:39.897729 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge_orders_recrutement'
[0m15:07:39.898728 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:07:40.336450 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '91b6294d-5906-429f-97aa-660007cd1947', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000232236BB7A0>]}
[0m15:07:40.341456 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:07:40.343455 [info ] [MainThread]: 
[0m15:07:40.357153 [debug] [Thread-1 (]: Began running node model.take_home_challenge.avg_products_per_order
[0m15:07:40.358180 [debug] [Thread-2 (]: Began running node model.take_home_challenge.order_segmentation
[0m15:07:40.360271 [debug] [Thread-3 (]: Began running node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:07:40.360812 [debug] [Thread-4 (]: Began running node model.take_home_challenge.orders_2023
[0m15:07:40.362279 [info ] [Thread-1 (]: 1 of 6 START sql view model orders_recrutement.avg_products_per_order .......... [RUN]
[0m15:07:40.365011 [info ] [Thread-2 (]: 2 of 6 START sql view model orders_recrutement.order_segmentation .............. [RUN]
[0m15:07:40.368746 [info ] [Thread-3 (]: 3 of 6 START sql view model orders_recrutement.orders_2022_2023_with_qty ....... [RUN]
[0m15:07:40.380752 [info ] [Thread-4 (]: 4 of 6 START sql view model orders_recrutement.orders_2023 ..................... [RUN]
[0m15:07:40.381882 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.take_home_challenge.avg_products_per_order'
[0m15:07:40.382887 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.take_home_challenge.order_segmentation'
[0m15:07:40.383894 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_2022_2023_with_qty'
[0m15:07:40.383894 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_2023'
[0m15:07:40.385297 [debug] [Thread-1 (]: Began compiling node model.take_home_challenge.avg_products_per_order
[0m15:07:40.385297 [debug] [Thread-2 (]: Began compiling node model.take_home_challenge.order_segmentation
[0m15:07:40.386812 [debug] [Thread-3 (]: Began compiling node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:07:40.386812 [debug] [Thread-4 (]: Began compiling node model.take_home_challenge.orders_2023
[0m15:07:40.395678 [debug] [Thread-1 (]: Writing injected SQL for node "model.take_home_challenge.avg_products_per_order"
[0m15:07:40.397685 [debug] [Thread-2 (]: Writing injected SQL for node "model.take_home_challenge.order_segmentation"
[0m15:07:40.400211 [debug] [Thread-3 (]: Writing injected SQL for node "model.take_home_challenge.orders_2022_2023_with_qty"
[0m15:07:40.402281 [debug] [Thread-4 (]: Writing injected SQL for node "model.take_home_challenge.orders_2023"
[0m15:07:40.404584 [debug] [Thread-1 (]: Began executing node model.take_home_challenge.avg_products_per_order
[0m15:07:40.404584 [debug] [Thread-2 (]: Began executing node model.take_home_challenge.order_segmentation
[0m15:07:40.428847 [debug] [Thread-3 (]: Began executing node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:07:40.432927 [debug] [Thread-1 (]: Writing runtime sql for node "model.take_home_challenge.avg_products_per_order"
[0m15:07:40.435928 [debug] [Thread-2 (]: Writing runtime sql for node "model.take_home_challenge.order_segmentation"
[0m15:07:40.435928 [debug] [Thread-4 (]: Began executing node model.take_home_challenge.orders_2023
[0m15:07:40.439147 [debug] [Thread-3 (]: Writing runtime sql for node "model.take_home_challenge.orders_2022_2023_with_qty"
[0m15:07:40.441893 [debug] [Thread-4 (]: Writing runtime sql for node "model.take_home_challenge.orders_2023"
[0m15:07:40.442901 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m15:07:40.442901 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:07:40.443977 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:07:40.446594 [debug] [Thread-1 (]: On model.take_home_challenge.avg_products_per_order: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.avg_products_per_order"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`avg_products_per_order`
  OPTIONS()
  as SELECT
    EXTRACT(MONTH FROM date_date) AS month,
    AVG(qty) AS avg_products_per_order
FROM
    takehomechallenge.sales_recrutement.sales
WHERE
    EXTRACT(YEAR FROM date_date) = 2023
GROUP BY
    month
ORDER BY
    month;


[0m15:07:40.446594 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:07:40.448782 [debug] [Thread-2 (]: On model.take_home_challenge.order_segmentation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.order_segmentation"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`order_segmentation`
  OPTIONS()
  as WITH order_counts AS (
    SELECT
        o.orders_id,
        o.customers_id AS client_id,
        o.date_date AS order_date,
        COUNT(*) OVER (PARTITION BY o.customers_id
                       ORDER BY o.date_date
                       ROWS BETWEEN 12 PRECEDING AND CURRENT ROW) AS orders_in_last_12_months  -- Utilisation de ROWS au lieu de RANGE
    FROM
        takehomechallenge.orders_recrutement.orders o
    WHERE
        EXTRACT(YEAR FROM o.date_date) = 2023
)
SELECT
    o.orders_id,
    o.client_id,
    o.order_date,
    CASE
        WHEN o.orders_in_last_12_months = 1 THEN 'New'
        WHEN o.orders_in_last_12_months BETWEEN 2 AND 4 THEN 'Returning'
        WHEN o.orders_in_last_12_months >= 5 THEN 'VIP'
        ELSE 'Unknown'
    END AS order_segment
FROM
    order_counts o
ORDER BY
    o.order_date, o.client_id;;


[0m15:07:40.449957 [debug] [Thread-3 (]: On model.take_home_challenge.orders_2022_2023_with_qty: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2022_2023_with_qty"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2022_2023_with_qty`
  OPTIONS()
  as CREATE OR REPLACE TABLE takehomechallenge.orders_recrutement.orders_2022_2023_with_qty AS
SELECT
    o.date_date AS order_date,
    o.customers_id,
    o.orders_id,
    o.CA_ht,
    SUM(s.qty) AS qty_product  -- Calcul de la quantité totale de produits par commande
FROM
    takehomechallenge.orders_recrutement.orders o
JOIN
    takehomechallenge.sales_recrutement.sales s
ON
    o.customers_id = s.client_id
    AND o.orders_id = s.transaction_id  -- Lier chaque commande à ses produits
WHERE
    EXTRACT(YEAR FROM o.date_date) IN (2022, 2023)  -- Filtrer pour 2022 et 2023
GROUP BY
    o.date_date, o.customers_id, o.orders_id, o.CA_ht
ORDER BY
    o.date_date, o.orders_id;;


[0m15:07:40.474405 [debug] [Thread-4 (]: On model.take_home_challenge.orders_2023: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2023"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2023`
  OPTIONS()
  as SELECT
    COUNT(*) AS total_orders_2023
FROM
    takehomechallenge.orders_recrutement.orders
WHERE
    EXTRACT(YEAR FROM date_date) = 2023;


[0m15:07:40.903214 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:ba5fee9a-a398-461f-b3cc-3745dc26975c&page=queryresults
[0m15:07:40.904767 [debug] [Thread-2 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected ";" at [32:31]; reason: invalidQuery, location: query, message: Syntax error: Unexpected ";" at [32:31]')
[0m15:07:40.963910 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:b88e43f1-8325-4809-8820-e637e936cb6a&page=queryresults
[0m15:07:40.965096 [debug] [Thread-3 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected keyword CREATE at [6:6]; reason: invalidQuery, location: query, message: Syntax error: Unexpected keyword CREATE at [6:6]')
[0m15:07:41.127022 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:48f6192b-1860-4670-9b67-0683d5ab79c2&page=queryresults
[0m15:07:41.239454 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:f313261d-dae6-44bd-9cc7-eb4524f3c2c8&page=queryresults
[0m15:07:41.349988 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:faedac99-8e8e-4354-a7c2-15ef88e30424&page=queryresults
[0m15:07:41.350576 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:faedac99-8e8e-4354-a7c2-15ef88e30424&page=queryresults
[0m15:07:41.359714 [debug] [Thread-2 (]: Database Error in model order_segmentation (models\order_segmentation.sql)
  Syntax error: Unexpected ";" at [32:31]
  compiled code at target\run\take_home_challenge\models\order_segmentation.sql
[0m15:07:41.361660 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '91b6294d-5906-429f-97aa-660007cd1947', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023223C1EE70>]}
[0m15:07:41.362669 [error] [Thread-2 (]: 2 of 6 ERROR creating sql view model orders_recrutement.order_segmentation ..... [[31mERROR[0m in 0.98s]
[0m15:07:41.364165 [debug] [Thread-2 (]: Finished running node model.take_home_challenge.order_segmentation
[0m15:07:41.365290 [debug] [Thread-2 (]: Began running node model.take_home_challenge.orders_2023_with_segmentation
[0m15:07:41.367304 [info ] [Thread-2 (]: 5 of 6 START sql view model orders_recrutement.orders_2023_with_segmentation ... [RUN]
[0m15:07:41.368385 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.take_home_challenge.order_segmentation, now model.take_home_challenge.orders_2023_with_segmentation)
[0m15:07:41.370391 [debug] [Thread-2 (]: Began compiling node model.take_home_challenge.orders_2023_with_segmentation
[0m15:07:41.375950 [debug] [Thread-2 (]: Writing injected SQL for node "model.take_home_challenge.orders_2023_with_segmentation"
[0m15:07:41.376960 [debug] [Thread-2 (]: Began executing node model.take_home_challenge.orders_2023_with_segmentation
[0m15:07:41.442819 [debug] [Thread-2 (]: Writing runtime sql for node "model.take_home_challenge.orders_2023_with_segmentation"
[0m15:07:41.462235 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '91b6294d-5906-429f-97aa-660007cd1947', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023221B246B0>]}
[0m15:07:41.462235 [info ] [Thread-1 (]: 1 of 6 OK created sql view model orders_recrutement.avg_products_per_order ..... [[32mCREATE VIEW (0 processed)[0m in 1.08s]
[0m15:07:41.463627 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:07:41.463627 [debug] [Thread-1 (]: Finished running node model.take_home_challenge.avg_products_per_order
[0m15:07:41.465797 [debug] [Thread-2 (]: On model.take_home_challenge.orders_2023_with_segmentation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2023_with_segmentation"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2023_with_segmentation`
  OPTIONS()
  as WITH order_counts AS (
    SELECT
        o.orders_id,
        o.customers_id AS client_id,
        o.date_date AS order_date,
        o.CA_ht,  -- Assurez-vous de sélectionner CA_ht dans la sous-requête
        COUNT(*) OVER (PARTITION BY o.customers_id
                       ORDER BY o.date_date
                       ROWS BETWEEN 12 PRECEDING AND CURRENT ROW) AS orders_in_last_12_months
    FROM
        takehomechallenge.orders_recrutement.orders o
    WHERE
        EXTRACT(YEAR FROM o.date_date) = 2023
)
SELECT
    o.orders_id,
    o.client_id,
    o.order_date,
    o.CA_ht,
    CASE
        WHEN o.orders_in_last_12_months = 1 THEN 'New'
        WHEN o.orders_in_last_12_months BETWEEN 2 AND 4 THEN 'Returning'
        WHEN o.orders_in_last_12_months >= 5 THEN 'VIP'
        ELSE 'Unknown'
    END AS order_segmentation
FROM
    order_counts o;;


[0m15:07:41.466806 [debug] [Thread-1 (]: Began running node model.take_home_challenge.orders_by_month
[0m15:07:41.492190 [info ] [Thread-1 (]: 6 of 6 START sql view model orders_recrutement.orders_by_month ................. [RUN]
[0m15:07:41.493189 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.take_home_challenge.avg_products_per_order, now model.take_home_challenge.orders_by_month)
[0m15:07:41.494190 [debug] [Thread-1 (]: Began compiling node model.take_home_challenge.orders_by_month
[0m15:07:41.496449 [debug] [Thread-1 (]: Writing injected SQL for node "model.take_home_challenge.orders_by_month"
[0m15:07:41.497458 [debug] [Thread-1 (]: Began executing node model.take_home_challenge.orders_by_month
[0m15:07:41.500085 [debug] [Thread-1 (]: Writing runtime sql for node "model.take_home_challenge.orders_by_month"
[0m15:07:41.501093 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:07:41.502356 [debug] [Thread-1 (]: On model.take_home_challenge.orders_by_month: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_by_month"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_by_month`
  OPTIONS()
  as SELECT
    EXTRACT(MONTH FROM date_date) AS month,
    COUNT(*) AS total_orders
FROM
    takehomechallenge.orders_recrutement.orders
WHERE
    EXTRACT(YEAR FROM date_date) = 2023
GROUP BY
    month
ORDER BY
    month;


[0m15:07:41.897337 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:ea42eed5-1dbb-4a97-ad97-12c8253dc419&page=queryresults
[0m15:07:41.901356 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '91b6294d-5906-429f-97aa-660007cd1947', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002322401D0A0>]}
[0m15:07:41.902377 [debug] [Thread-2 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected ";" at [32:20]; reason: invalidQuery, location: query, message: Syntax error: Unexpected ";" at [32:20]')
[0m15:07:41.903407 [info ] [Thread-4 (]: 4 of 6 OK created sql view model orders_recrutement.orders_2023 ................ [[32mCREATE VIEW (0 processed)[0m in 1.52s]
[0m15:07:41.905414 [debug] [Thread-4 (]: Finished running node model.take_home_challenge.orders_2023
[0m15:07:42.115642 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:0e03fda1-b18f-4812-b057-9d3028993e81&page=queryresults
[0m15:07:42.116663 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:0e03fda1-b18f-4812-b057-9d3028993e81&page=queryresults
[0m15:07:42.120665 [debug] [Thread-3 (]: Database Error in model orders_2022_2023_with_qty (models\orders_2022_2023_with_qty.sql)
  Syntax error: Unexpected keyword CREATE at [6:6]
  compiled code at target\run\take_home_challenge\models\orders_2022_2023_with_qty.sql
[0m15:07:42.120665 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '91b6294d-5906-429f-97aa-660007cd1947', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023223B41D60>]}
[0m15:07:42.121689 [error] [Thread-3 (]: 3 of 6 ERROR creating sql view model orders_recrutement.orders_2022_2023_with_qty  [[31mERROR[0m in 1.74s]
[0m15:07:42.122703 [debug] [Thread-3 (]: Finished running node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:07:42.247898 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:f5e02a40-212c-46ef-b766-09f3246e95b5&page=queryresults
[0m15:07:42.643580 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '91b6294d-5906-429f-97aa-660007cd1947', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002322394FEC0>]}
[0m15:07:42.646579 [info ] [Thread-1 (]: 6 of 6 OK created sql view model orders_recrutement.orders_by_month ............ [[32mCREATE VIEW (0 processed)[0m in 1.15s]
[0m15:07:42.650612 [debug] [Thread-1 (]: Finished running node model.take_home_challenge.orders_by_month
[0m15:07:42.827101 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:72f82351-a260-45f7-a700-1d9b71001101&page=queryresults
[0m15:07:42.829641 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:72f82351-a260-45f7-a700-1d9b71001101&page=queryresults
[0m15:07:42.837008 [debug] [Thread-2 (]: Database Error in model orders_2023_with_segmentation (models\orders_2023_with_segmentation.sql)
  Syntax error: Unexpected ";" at [32:20]
  compiled code at target\run\take_home_challenge\models\orders_2023_with_segmentation.sql
[0m15:07:42.838013 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '91b6294d-5906-429f-97aa-660007cd1947', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023221B24980>]}
[0m15:07:42.838013 [error] [Thread-2 (]: 5 of 6 ERROR creating sql view model orders_recrutement.orders_2023_with_segmentation  [[31mERROR[0m in 1.47s]
[0m15:07:42.839510 [debug] [Thread-2 (]: Finished running node model.take_home_challenge.orders_2023_with_segmentation
[0m15:07:42.840511 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:07:42.841916 [debug] [MainThread]: Connection 'list_takehomechallenge' was properly closed.
[0m15:07:42.841916 [debug] [MainThread]: Connection 'list_takehomechallenge_orders_recrutement' was properly closed.
[0m15:07:42.841916 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_by_month' was properly closed.
[0m15:07:42.843366 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_2023_with_segmentation' was properly closed.
[0m15:07:42.843366 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_2022_2023_with_qty' was properly closed.
[0m15:07:42.843366 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_2023' was properly closed.
[0m15:07:42.844654 [info ] [MainThread]: 
[0m15:07:42.844654 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.41 seconds (3.41s).
[0m15:07:42.845678 [debug] [MainThread]: Command end result
[0m15:07:42.875283 [info ] [MainThread]: 
[0m15:07:42.876296 [info ] [MainThread]: [31mCompleted with 3 errors and 0 warnings:[0m
[0m15:07:42.876296 [info ] [MainThread]: 
[0m15:07:42.877616 [error] [MainThread]:   Database Error in model order_segmentation (models\order_segmentation.sql)
  Syntax error: Unexpected ";" at [32:31]
  compiled code at target\run\take_home_challenge\models\order_segmentation.sql
[0m15:07:42.877616 [info ] [MainThread]: 
[0m15:07:42.878650 [error] [MainThread]:   Database Error in model orders_2022_2023_with_qty (models\orders_2022_2023_with_qty.sql)
  Syntax error: Unexpected keyword CREATE at [6:6]
  compiled code at target\run\take_home_challenge\models\orders_2022_2023_with_qty.sql
[0m15:07:42.879774 [info ] [MainThread]: 
[0m15:07:42.879774 [error] [MainThread]:   Database Error in model orders_2023_with_segmentation (models\orders_2023_with_segmentation.sql)
  Syntax error: Unexpected ";" at [32:20]
  compiled code at target\run\take_home_challenge\models\orders_2023_with_segmentation.sql
[0m15:07:42.880790 [info ] [MainThread]: 
[0m15:07:42.881822 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=3 SKIP=0 TOTAL=6
[0m15:07:42.882927 [debug] [MainThread]: Command `dbt run` failed at 15:07:42.881822 after 5.85 seconds
[0m15:07:42.882927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000232101B8470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000232109585F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023210809A30>]}
[0m15:07:42.883432 [debug] [MainThread]: Flushing usage events
[0m15:09:43.646900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C7F44794C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C7F6F192B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C7F73F0830>]}


============================== 15:09:43.651810 | caf924cf-2814-4aae-83b5-75ec8fa7d5f9 ==============================
[0m15:09:43.651810 [info ] [MainThread]: Running with dbt=1.8.7
[0m15:09:43.652825 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\thoma\\PycharmProjects\\Take-Home challenge\\logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --full-refresh', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m15:09:45.170261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'caf924cf-2814-4aae-83b5-75ec8fa7d5f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C789CF5340>]}
[0m15:09:45.231863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'caf924cf-2814-4aae-83b5-75ec8fa7d5f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C7879C5430>]}
[0m15:09:45.232864 [info ] [MainThread]: Registered adapter: bigquery=1.8.3
[0m15:09:45.577595 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m15:09:45.722336 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m15:09:45.722336 [debug] [MainThread]: Partial parsing: updated file: take_home_challenge://models\orders_2023_with_segmentation.sql
[0m15:09:45.723436 [debug] [MainThread]: Partial parsing: updated file: take_home_challenge://models\order_segmentation.sql
[0m15:09:45.927877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'caf924cf-2814-4aae-83b5-75ec8fa7d5f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C789F61370>]}
[0m15:09:46.015579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'caf924cf-2814-4aae-83b5-75ec8fa7d5f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C78A3D30B0>]}
[0m15:09:46.016578 [info ] [MainThread]: Found 6 models, 2 sources, 484 macros
[0m15:09:46.017578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'caf924cf-2814-4aae-83b5-75ec8fa7d5f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C789E702C0>]}
[0m15:09:46.020968 [info ] [MainThread]: 
[0m15:09:46.022198 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m15:09:46.028836 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge'
[0m15:09:46.029843 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:09:46.512849 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge_orders_recrutement'
[0m15:09:46.514273 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:09:46.985981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'caf924cf-2814-4aae-83b5-75ec8fa7d5f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C7F741CAA0>]}
[0m15:09:46.987600 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:09:46.990129 [info ] [MainThread]: 
[0m15:09:47.002040 [debug] [Thread-1 (]: Began running node model.take_home_challenge.avg_products_per_order
[0m15:09:47.003692 [debug] [Thread-2 (]: Began running node model.take_home_challenge.order_segmentation
[0m15:09:47.004738 [debug] [Thread-3 (]: Began running node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:09:47.006840 [debug] [Thread-4 (]: Began running node model.take_home_challenge.orders_2023
[0m15:09:47.007814 [info ] [Thread-1 (]: 1 of 6 START sql view model orders_recrutement.avg_products_per_order .......... [RUN]
[0m15:09:47.009071 [info ] [Thread-2 (]: 2 of 6 START sql view model orders_recrutement.order_segmentation .............. [RUN]
[0m15:09:47.014981 [info ] [Thread-3 (]: 3 of 6 START sql view model orders_recrutement.orders_2022_2023_with_qty ....... [RUN]
[0m15:09:47.017048 [info ] [Thread-4 (]: 4 of 6 START sql view model orders_recrutement.orders_2023 ..................... [RUN]
[0m15:09:47.019371 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.take_home_challenge.avg_products_per_order'
[0m15:09:47.020277 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.take_home_challenge.order_segmentation'
[0m15:09:47.021705 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_2022_2023_with_qty'
[0m15:09:47.023166 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_2023'
[0m15:09:47.024592 [debug] [Thread-1 (]: Began compiling node model.take_home_challenge.avg_products_per_order
[0m15:09:47.025971 [debug] [Thread-2 (]: Began compiling node model.take_home_challenge.order_segmentation
[0m15:09:47.026984 [debug] [Thread-3 (]: Began compiling node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:09:47.028242 [debug] [Thread-4 (]: Began compiling node model.take_home_challenge.orders_2023
[0m15:09:47.043420 [debug] [Thread-1 (]: Writing injected SQL for node "model.take_home_challenge.avg_products_per_order"
[0m15:09:47.045419 [debug] [Thread-2 (]: Writing injected SQL for node "model.take_home_challenge.order_segmentation"
[0m15:09:47.048941 [debug] [Thread-3 (]: Writing injected SQL for node "model.take_home_challenge.orders_2022_2023_with_qty"
[0m15:09:47.051001 [debug] [Thread-4 (]: Writing injected SQL for node "model.take_home_challenge.orders_2023"
[0m15:09:47.052001 [debug] [Thread-1 (]: Began executing node model.take_home_challenge.avg_products_per_order
[0m15:09:47.053292 [debug] [Thread-2 (]: Began executing node model.take_home_challenge.order_segmentation
[0m15:09:47.079968 [debug] [Thread-1 (]: Writing runtime sql for node "model.take_home_challenge.avg_products_per_order"
[0m15:09:47.081058 [debug] [Thread-3 (]: Began executing node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:09:47.084605 [debug] [Thread-2 (]: Writing runtime sql for node "model.take_home_challenge.order_segmentation"
[0m15:09:47.085509 [debug] [Thread-4 (]: Began executing node model.take_home_challenge.orders_2023
[0m15:09:47.087558 [debug] [Thread-3 (]: Writing runtime sql for node "model.take_home_challenge.orders_2022_2023_with_qty"
[0m15:09:47.088949 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m15:09:47.092253 [debug] [Thread-4 (]: Writing runtime sql for node "model.take_home_challenge.orders_2023"
[0m15:09:47.093253 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:09:47.096447 [debug] [Thread-1 (]: On model.take_home_challenge.avg_products_per_order: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.avg_products_per_order"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`avg_products_per_order`
  OPTIONS()
  as SELECT
    EXTRACT(MONTH FROM date_date) AS month,
    AVG(qty) AS avg_products_per_order
FROM
    takehomechallenge.sales_recrutement.sales
WHERE
    EXTRACT(YEAR FROM date_date) = 2023
GROUP BY
    month
ORDER BY
    month;


[0m15:09:47.096447 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:09:47.098776 [debug] [Thread-2 (]: On model.take_home_challenge.order_segmentation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.order_segmentation"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`order_segmentation`
  OPTIONS()
  as WITH order_counts AS (
    SELECT
        o.orders_id,
        o.customers_id AS client_id,
        o.date_date AS order_date,
        COUNT(*) OVER (
            PARTITION BY o.customers_id
            ORDER BY o.date_date
            ROWS BETWEEN 12 PRECEDING AND CURRENT ROW
        ) AS orders_in_last_12_months
    FROM
        takehomechallenge.orders_recrutement.orders o
    WHERE
        EXTRACT(YEAR FROM o.date_date) = 2023
)
SELECT
    o.orders_id,
    o.client_id,
    o.order_date,
    CASE
        WHEN o.orders_in_last_12_months = 1 THEN 'New'
        WHEN o.orders_in_last_12_months BETWEEN 2 AND 4 THEN 'Returning'
        WHEN o.orders_in_last_12_months >= 5 THEN 'VIP'
        ELSE 'Unknown'
    END AS order_segment
FROM
    order_counts o
ORDER BY
    o.order_date, o.client_id;;


[0m15:09:47.126915 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:09:47.129641 [debug] [Thread-3 (]: On model.take_home_challenge.orders_2022_2023_with_qty: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2022_2023_with_qty"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2022_2023_with_qty`
  OPTIONS()
  as CREATE OR REPLACE TABLE takehomechallenge.orders_recrutement.orders_2022_2023_with_qty AS
SELECT
    o.date_date AS order_date,
    o.customers_id,
    o.orders_id,
    o.CA_ht,
    SUM(s.qty) AS qty_product  -- Calcul de la quantité totale de produits par commande
FROM
    takehomechallenge.orders_recrutement.orders o
JOIN
    takehomechallenge.sales_recrutement.sales s
ON
    o.customers_id = s.client_id
    AND o.orders_id = s.transaction_id  -- Lier chaque commande à ses produits
WHERE
    EXTRACT(YEAR FROM o.date_date) IN (2022, 2023)  -- Filtrer pour 2022 et 2023
GROUP BY
    o.date_date, o.customers_id, o.orders_id, o.CA_ht
ORDER BY
    o.date_date, o.orders_id;;


[0m15:09:47.188671 [debug] [Thread-4 (]: On model.take_home_challenge.orders_2023: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2023"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2023`
  OPTIONS()
  as SELECT
    COUNT(*) AS total_orders_2023
FROM
    takehomechallenge.orders_recrutement.orders
WHERE
    EXTRACT(YEAR FROM date_date) = 2023;


[0m15:09:47.567984 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:4ebfcf88-2b0d-4de2-a42f-8518dede1961&page=queryresults
[0m15:09:47.568994 [debug] [Thread-2 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected ";" at [34:31]; reason: invalidQuery, location: query, message: Syntax error: Unexpected ";" at [34:31]')
[0m15:09:47.635285 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:04ad2dc6-e075-49fb-ac1d-385bf3e52ac7&page=queryresults
[0m15:09:47.636284 [debug] [Thread-3 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected keyword CREATE at [6:6]; reason: invalidQuery, location: query, message: Syntax error: Unexpected keyword CREATE at [6:6]')
[0m15:09:47.776109 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:00794d96-75e1-4f69-a6e9-d477112fc13b&page=queryresults
[0m15:09:47.842012 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:7b89fa8d-2f9f-4fdb-85ae-f1d068b73731&page=queryresults
[0m15:09:47.890041 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:a79c2e47-1991-4592-aa64-22bad2750b97&page=queryresults
[0m15:09:47.891779 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:a79c2e47-1991-4592-aa64-22bad2750b97&page=queryresults
[0m15:09:47.900786 [debug] [Thread-2 (]: Database Error in model order_segmentation (models\order_segmentation.sql)
  Syntax error: Unexpected ";" at [34:31]
  compiled code at target\run\take_home_challenge\models\order_segmentation.sql
[0m15:09:47.903786 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'caf924cf-2814-4aae-83b5-75ec8fa7d5f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C78A391520>]}
[0m15:09:47.904785 [error] [Thread-2 (]: 2 of 6 ERROR creating sql view model orders_recrutement.order_segmentation ..... [[31mERROR[0m in 0.88s]
[0m15:09:47.905786 [debug] [Thread-2 (]: Finished running node model.take_home_challenge.order_segmentation
[0m15:09:47.906785 [debug] [Thread-2 (]: Began running node model.take_home_challenge.orders_2023_with_segmentation
[0m15:09:47.907785 [info ] [Thread-2 (]: 5 of 6 START sql view model orders_recrutement.orders_2023_with_segmentation ... [RUN]
[0m15:09:47.908786 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.take_home_challenge.order_segmentation, now model.take_home_challenge.orders_2023_with_segmentation)
[0m15:09:47.909786 [debug] [Thread-2 (]: Began compiling node model.take_home_challenge.orders_2023_with_segmentation
[0m15:09:47.914786 [debug] [Thread-2 (]: Writing injected SQL for node "model.take_home_challenge.orders_2023_with_segmentation"
[0m15:09:47.916787 [debug] [Thread-2 (]: Began executing node model.take_home_challenge.orders_2023_with_segmentation
[0m15:09:47.982828 [debug] [Thread-2 (]: Writing runtime sql for node "model.take_home_challenge.orders_2023_with_segmentation"
[0m15:09:47.985728 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:09:47.986887 [debug] [Thread-2 (]: On model.take_home_challenge.orders_2023_with_segmentation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2023_with_segmentation"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2023_with_segmentation`
  OPTIONS()
  as WITH order_counts AS (
    SELECT
        o.orders_id,
        o.customers_id AS client_id,
        o.date_date AS order_date,
        o.CA_ht,  -- Assurez-vous de sélectionner CA_ht dans la sous-requête
        COUNT(*) OVER (
            PARTITION BY o.customers_id
            ORDER BY o.date_date
            ROWS BETWEEN 12 PRECEDING AND CURRENT ROW
        ) AS orders_in_last_12_months
    FROM
        takehomechallenge.orders_recrutement.orders o
    WHERE
        EXTRACT(YEAR FROM o.date_date) = 2023
)
SELECT
    o.orders_id,
    o.client_id,
    o.order_date,
    o.CA_ht,
    CASE
        WHEN o.orders_in_last_12_months = 1 THEN 'New'
        WHEN o.orders_in_last_12_months BETWEEN 2 AND 4 THEN 'Returning'
        WHEN o.orders_in_last_12_months >= 5 THEN 'VIP'
        ELSE 'Unknown'
    END AS order_segmentation
FROM
    order_counts o;;


[0m15:09:48.249537 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'caf924cf-2814-4aae-83b5-75ec8fa7d5f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C78A8283E0>]}
[0m15:09:48.250543 [info ] [Thread-4 (]: 4 of 6 OK created sql view model orders_recrutement.orders_2023 ................ [[32mCREATE VIEW (0 processed)[0m in 1.23s]
[0m15:09:48.253281 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'caf924cf-2814-4aae-83b5-75ec8fa7d5f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C78A49DB20>]}
[0m15:09:48.254286 [debug] [Thread-4 (]: Finished running node model.take_home_challenge.orders_2023
[0m15:09:48.257286 [debug] [Thread-4 (]: Began running node model.take_home_challenge.orders_by_month
[0m15:09:48.256288 [info ] [Thread-1 (]: 1 of 6 OK created sql view model orders_recrutement.avg_products_per_order ..... [[32mCREATE VIEW (0 processed)[0m in 1.24s]
[0m15:09:48.263299 [debug] [Thread-1 (]: Finished running node model.take_home_challenge.avg_products_per_order
[0m15:09:48.257286 [info ] [Thread-4 (]: 6 of 6 START sql view model orders_recrutement.orders_by_month ................. [RUN]
[0m15:09:48.265289 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.take_home_challenge.orders_2023, now model.take_home_challenge.orders_by_month)
[0m15:09:48.266288 [debug] [Thread-4 (]: Began compiling node model.take_home_challenge.orders_by_month
[0m15:09:48.268880 [debug] [Thread-4 (]: Writing injected SQL for node "model.take_home_challenge.orders_by_month"
[0m15:09:48.269895 [debug] [Thread-4 (]: Began executing node model.take_home_challenge.orders_by_month
[0m15:09:48.272885 [debug] [Thread-4 (]: Writing runtime sql for node "model.take_home_challenge.orders_by_month"
[0m15:09:48.273885 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:09:48.276886 [debug] [Thread-4 (]: On model.take_home_challenge.orders_by_month: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_by_month"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_by_month`
  OPTIONS()
  as SELECT
    EXTRACT(MONTH FROM date_date) AS month,
    COUNT(*) AS total_orders
FROM
    takehomechallenge.orders_recrutement.orders
WHERE
    EXTRACT(YEAR FROM date_date) = 2023
GROUP BY
    month
ORDER BY
    month;


[0m15:09:48.417222 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:59400d78-c66a-4805-a959-e37f179815d1&page=queryresults
[0m15:09:48.418398 [debug] [Thread-2 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected ";" at [34:20]; reason: invalidQuery, location: query, message: Syntax error: Unexpected ";" at [34:20]')
[0m15:09:48.547437 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:b55c3afd-45fd-48b4-a272-c5c428e34623&page=queryresults
[0m15:09:48.548439 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:b55c3afd-45fd-48b4-a272-c5c428e34623&page=queryresults
[0m15:09:48.552417 [debug] [Thread-3 (]: Database Error in model orders_2022_2023_with_qty (models\orders_2022_2023_with_qty.sql)
  Syntax error: Unexpected keyword CREATE at [6:6]
  compiled code at target\run\take_home_challenge\models\orders_2022_2023_with_qty.sql
[0m15:09:48.553005 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'caf924cf-2814-4aae-83b5-75ec8fa7d5f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C78A8392B0>]}
[0m15:09:48.553005 [error] [Thread-3 (]: 3 of 6 ERROR creating sql view model orders_recrutement.orders_2022_2023_with_qty  [[31mERROR[0m in 1.53s]
[0m15:09:48.554104 [debug] [Thread-3 (]: Finished running node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:09:48.965037 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:47438e1b-d637-44a9-ba0d-6cf71c2d8ed0&page=queryresults
[0m15:09:49.008120 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:438a7e11-20f2-41c3-a51c-e6aa4207689e&page=queryresults
[0m15:09:49.010156 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:438a7e11-20f2-41c3-a51c-e6aa4207689e&page=queryresults
[0m15:09:49.022260 [debug] [Thread-2 (]: Database Error in model orders_2023_with_segmentation (models\orders_2023_with_segmentation.sql)
  Syntax error: Unexpected ";" at [34:20]
  compiled code at target\run\take_home_challenge\models\orders_2023_with_segmentation.sql
[0m15:09:49.024295 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'caf924cf-2814-4aae-83b5-75ec8fa7d5f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C78A32F110>]}
[0m15:09:49.025905 [error] [Thread-2 (]: 5 of 6 ERROR creating sql view model orders_recrutement.orders_2023_with_segmentation  [[31mERROR[0m in 1.11s]
[0m15:09:49.029113 [debug] [Thread-2 (]: Finished running node model.take_home_challenge.orders_2023_with_segmentation
[0m15:09:49.404625 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'caf924cf-2814-4aae-83b5-75ec8fa7d5f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C788455B80>]}
[0m15:09:49.408266 [info ] [Thread-4 (]: 6 of 6 OK created sql view model orders_recrutement.orders_by_month ............ [[32mCREATE VIEW (0 processed)[0m in 1.14s]
[0m15:09:49.412261 [debug] [Thread-4 (]: Finished running node model.take_home_challenge.orders_by_month
[0m15:09:49.416328 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:09:49.417330 [debug] [MainThread]: Connection 'list_takehomechallenge' was properly closed.
[0m15:09:49.419329 [debug] [MainThread]: Connection 'list_takehomechallenge_orders_recrutement' was properly closed.
[0m15:09:49.421330 [debug] [MainThread]: Connection 'model.take_home_challenge.avg_products_per_order' was properly closed.
[0m15:09:49.423331 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_2023_with_segmentation' was properly closed.
[0m15:09:49.425329 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_2022_2023_with_qty' was properly closed.
[0m15:09:49.426330 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_by_month' was properly closed.
[0m15:09:49.428328 [info ] [MainThread]: 
[0m15:09:49.430333 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.41 seconds (3.41s).
[0m15:09:49.437341 [debug] [MainThread]: Command end result
[0m15:09:49.486566 [info ] [MainThread]: 
[0m15:09:49.487567 [info ] [MainThread]: [31mCompleted with 3 errors and 0 warnings:[0m
[0m15:09:49.488693 [info ] [MainThread]: 
[0m15:09:49.488693 [error] [MainThread]:   Database Error in model order_segmentation (models\order_segmentation.sql)
  Syntax error: Unexpected ";" at [34:31]
  compiled code at target\run\take_home_challenge\models\order_segmentation.sql
[0m15:09:49.489698 [info ] [MainThread]: 
[0m15:09:49.489698 [error] [MainThread]:   Database Error in model orders_2022_2023_with_qty (models\orders_2022_2023_with_qty.sql)
  Syntax error: Unexpected keyword CREATE at [6:6]
  compiled code at target\run\take_home_challenge\models\orders_2022_2023_with_qty.sql
[0m15:09:49.490832 [info ] [MainThread]: 
[0m15:09:49.490832 [error] [MainThread]:   Database Error in model orders_2023_with_segmentation (models\orders_2023_with_segmentation.sql)
  Syntax error: Unexpected ";" at [34:20]
  compiled code at target\run\take_home_challenge\models\orders_2023_with_segmentation.sql
[0m15:09:49.492279 [info ] [MainThread]: 
[0m15:09:49.493284 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=3 SKIP=0 TOTAL=6
[0m15:09:49.494324 [debug] [MainThread]: Command `dbt run` failed at 15:09:49.494324 after 6.10 seconds
[0m15:09:49.494324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C7F71E6E70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C7F6FCB560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002C7F6FCB3B0>]}
[0m15:09:49.495328 [debug] [MainThread]: Flushing usage events
[0m15:11:11.751008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025566602150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000255697FC470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002556A062900>]}


============================== 15:11:11.755375 | 6e58b7df-03c6-4d2c-8378-4be9f89b3950 ==============================
[0m15:11:11.755375 [info ] [MainThread]: Running with dbt=1.8.7
[0m15:11:11.756382 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\thoma\\PycharmProjects\\Take-Home challenge\\logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --full-refresh', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:11:13.095793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6e58b7df-03c6-4d2c-8378-4be9f89b3950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002556A2091C0>]}
[0m15:11:13.143981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6e58b7df-03c6-4d2c-8378-4be9f89b3950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002556944EFF0>]}
[0m15:11:13.144980 [info ] [MainThread]: Registered adapter: bigquery=1.8.3
[0m15:11:13.533720 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m15:11:13.674714 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:11:13.675713 [debug] [MainThread]: Partial parsing: updated file: take_home_challenge://models\order_segmentation.sql
[0m15:11:13.877797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6e58b7df-03c6-4d2c-8378-4be9f89b3950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002556A0E61E0>]}
[0m15:11:14.004432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6e58b7df-03c6-4d2c-8378-4be9f89b3950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002557D0B2AB0>]}
[0m15:11:14.005457 [info ] [MainThread]: Found 6 models, 2 sources, 484 macros
[0m15:11:14.006463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6e58b7df-03c6-4d2c-8378-4be9f89b3950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002557D097AA0>]}
[0m15:11:14.008462 [info ] [MainThread]: 
[0m15:11:14.009510 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m15:11:14.014086 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge'
[0m15:11:14.014086 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:11:14.496481 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge_orders_recrutement'
[0m15:11:14.497902 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:11:14.956241 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6e58b7df-03c6-4d2c-8378-4be9f89b3950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002557B0ABFB0>]}
[0m15:11:14.957258 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:11:14.958550 [info ] [MainThread]: 
[0m15:11:14.966076 [debug] [Thread-1 (]: Began running node model.take_home_challenge.avg_products_per_order
[0m15:11:14.966076 [debug] [Thread-2 (]: Began running node model.take_home_challenge.order_segmentation
[0m15:11:14.967076 [debug] [Thread-3 (]: Began running node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:11:14.967076 [debug] [Thread-4 (]: Began running node model.take_home_challenge.orders_2023
[0m15:11:14.969074 [info ] [Thread-1 (]: 1 of 6 START sql view model orders_recrutement.avg_products_per_order .......... [RUN]
[0m15:11:14.969074 [info ] [Thread-2 (]: 2 of 6 START sql view model orders_recrutement.order_segmentation .............. [RUN]
[0m15:11:14.970236 [info ] [Thread-3 (]: 3 of 6 START sql view model orders_recrutement.orders_2022_2023_with_qty ....... [RUN]
[0m15:11:14.971251 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.take_home_challenge.avg_products_per_order'
[0m15:11:14.972691 [debug] [Thread-1 (]: Began compiling node model.take_home_challenge.avg_products_per_order
[0m15:11:14.971251 [info ] [Thread-4 (]: 4 of 6 START sql view model orders_recrutement.orders_2023 ..................... [RUN]
[0m15:11:14.972691 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_2022_2023_with_qty'
[0m15:11:14.971251 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.take_home_challenge.order_segmentation'
[0m15:11:14.982677 [debug] [Thread-1 (]: Writing injected SQL for node "model.take_home_challenge.avg_products_per_order"
[0m15:11:14.984678 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_2023'
[0m15:11:14.985677 [debug] [Thread-3 (]: Began compiling node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:11:14.985677 [debug] [Thread-2 (]: Began compiling node model.take_home_challenge.order_segmentation
[0m15:11:14.988152 [debug] [Thread-1 (]: Began executing node model.take_home_challenge.avg_products_per_order
[0m15:11:14.992155 [debug] [Thread-4 (]: Began compiling node model.take_home_challenge.orders_2023
[0m15:11:14.997289 [debug] [Thread-3 (]: Writing injected SQL for node "model.take_home_challenge.orders_2022_2023_with_qty"
[0m15:11:15.001202 [debug] [Thread-2 (]: Writing injected SQL for node "model.take_home_challenge.order_segmentation"
[0m15:11:15.031844 [debug] [Thread-1 (]: Writing runtime sql for node "model.take_home_challenge.avg_products_per_order"
[0m15:11:15.033901 [debug] [Thread-4 (]: Writing injected SQL for node "model.take_home_challenge.orders_2023"
[0m15:11:15.034966 [debug] [Thread-3 (]: Began executing node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:11:15.036358 [debug] [Thread-2 (]: Began executing node model.take_home_challenge.order_segmentation
[0m15:11:15.036358 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m15:11:15.039435 [debug] [Thread-3 (]: Writing runtime sql for node "model.take_home_challenge.orders_2022_2023_with_qty"
[0m15:11:15.040435 [debug] [Thread-4 (]: Began executing node model.take_home_challenge.orders_2023
[0m15:11:15.043446 [debug] [Thread-2 (]: Writing runtime sql for node "model.take_home_challenge.order_segmentation"
[0m15:11:15.044475 [debug] [Thread-1 (]: On model.take_home_challenge.avg_products_per_order: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.avg_products_per_order"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`avg_products_per_order`
  OPTIONS()
  as SELECT
    EXTRACT(MONTH FROM date_date) AS month,
    AVG(qty) AS avg_products_per_order
FROM
    takehomechallenge.sales_recrutement.sales
WHERE
    EXTRACT(YEAR FROM date_date) = 2023
GROUP BY
    month
ORDER BY
    month;


[0m15:11:15.046538 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:11:15.049040 [debug] [Thread-4 (]: Writing runtime sql for node "model.take_home_challenge.orders_2023"
[0m15:11:15.073538 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:11:15.075877 [debug] [Thread-3 (]: On model.take_home_challenge.orders_2022_2023_with_qty: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2022_2023_with_qty"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2022_2023_with_qty`
  OPTIONS()
  as CREATE OR REPLACE TABLE takehomechallenge.orders_recrutement.orders_2022_2023_with_qty AS
SELECT
    o.date_date AS order_date,
    o.customers_id,
    o.orders_id,
    o.CA_ht,
    SUM(s.qty) AS qty_product  -- Calcul de la quantité totale de produits par commande
FROM
    takehomechallenge.orders_recrutement.orders o
JOIN
    takehomechallenge.sales_recrutement.sales s
ON
    o.customers_id = s.client_id
    AND o.orders_id = s.transaction_id  -- Lier chaque commande à ses produits
WHERE
    EXTRACT(YEAR FROM o.date_date) IN (2022, 2023)  -- Filtrer pour 2022 et 2023
GROUP BY
    o.date_date, o.customers_id, o.orders_id, o.CA_ht
ORDER BY
    o.date_date, o.orders_id;;


[0m15:11:15.077876 [debug] [Thread-2 (]: On model.take_home_challenge.order_segmentation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.order_segmentation"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`order_segmentation`
  OPTIONS()
  as WITH order_counts AS (
    SELECT
        o.orders_id,
        o.customers_id AS client_id,
        o.date_date AS order_date,
        COUNT(*) OVER (
            PARTITION BY o.customers_id
            ORDER BY o.date_date
            ROWS BETWEEN 12 PRECEDING AND CURRENT ROW
        ) AS orders_in_last_12_months
    FROM
        takehomechallenge.orders_recrutement.orders o
    WHERE
        EXTRACT(YEAR FROM o.date_date) = 2023
)
SELECT
    o.orders_id,
    o.client_id,
    o.order_date,
    CASE
        WHEN o.orders_in_last_12_months = 1 THEN 'New'
        WHEN o.orders_in_last_12_months BETWEEN 2 AND 4 THEN 'Returning'
        WHEN o.orders_in_last_12_months >= 5 THEN 'VIP'
        ELSE 'Unknown'
    END AS order_segment
FROM
    order_counts o
ORDER BY
    o.order_date, o.client_id;


[0m15:11:15.101486 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:11:15.128106 [debug] [Thread-4 (]: On model.take_home_challenge.orders_2023: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2023"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2023`
  OPTIONS()
  as SELECT
    COUNT(*) AS total_orders_2023
FROM
    takehomechallenge.orders_recrutement.orders
WHERE
    EXTRACT(YEAR FROM date_date) = 2023;


[0m15:11:15.517074 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:4a3b81da-24db-4993-9620-bb7f6adeb089&page=queryresults
[0m15:11:15.518079 [debug] [Thread-3 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected keyword CREATE at [6:6]; reason: invalidQuery, location: query, message: Syntax error: Unexpected keyword CREATE at [6:6]')
[0m15:11:15.755501 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:2be2d08e-0842-4c96-abb5-f97fedf4cfaa&page=queryresults
[0m15:11:15.757668 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:987d0452-bbc3-4ec1-ab28-98e55f7c5309&page=queryresults
[0m15:11:15.757668 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:987d0452-bbc3-4ec1-ab28-98e55f7c5309&page=queryresults
[0m15:11:15.764002 [debug] [Thread-3 (]: Database Error in model orders_2022_2023_with_qty (models\orders_2022_2023_with_qty.sql)
  Syntax error: Unexpected keyword CREATE at [6:6]
  compiled code at target\run\take_home_challenge\models\orders_2022_2023_with_qty.sql
[0m15:11:15.765112 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:198bae09-857d-48ce-be6e-b166b4c89823&page=queryresults
[0m15:11:15.766237 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e58b7df-03c6-4d2c-8378-4be9f89b3950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002557D150890>]}
[0m15:11:15.768243 [error] [Thread-3 (]: 3 of 6 ERROR creating sql view model orders_recrutement.orders_2022_2023_with_qty  [[31mERROR[0m in 0.79s]
[0m15:11:15.769242 [debug] [Thread-3 (]: Finished running node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:11:15.770241 [debug] [Thread-3 (]: Began running node model.take_home_challenge.orders_2023_with_segmentation
[0m15:11:15.771244 [info ] [Thread-3 (]: 5 of 6 START sql view model orders_recrutement.orders_2023_with_segmentation ... [RUN]
[0m15:11:15.773242 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.take_home_challenge.orders_2022_2023_with_qty, now model.take_home_challenge.orders_2023_with_segmentation)
[0m15:11:15.773242 [debug] [Thread-3 (]: Began compiling node model.take_home_challenge.orders_2023_with_segmentation
[0m15:11:15.777930 [debug] [Thread-3 (]: Writing injected SQL for node "model.take_home_challenge.orders_2023_with_segmentation"
[0m15:11:15.779051 [debug] [Thread-3 (]: Began executing node model.take_home_challenge.orders_2023_with_segmentation
[0m15:11:15.846741 [debug] [Thread-3 (]: Writing runtime sql for node "model.take_home_challenge.orders_2023_with_segmentation"
[0m15:11:15.847354 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:8bfbd1b3-5daf-4205-934c-1951a615b905&page=queryresults
[0m15:11:15.849859 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m15:11:15.852142 [debug] [Thread-3 (]: On model.take_home_challenge.orders_2023_with_segmentation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2023_with_segmentation"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2023_with_segmentation`
  OPTIONS()
  as WITH order_counts AS (
    SELECT
        o.orders_id,
        o.customers_id AS client_id,
        o.date_date AS order_date,
        o.CA_ht,  -- Assurez-vous de sélectionner CA_ht dans la sous-requête
        COUNT(*) OVER (
            PARTITION BY o.customers_id
            ORDER BY o.date_date
            ROWS BETWEEN 12 PRECEDING AND CURRENT ROW
        ) AS orders_in_last_12_months
    FROM
        takehomechallenge.orders_recrutement.orders o
    WHERE
        EXTRACT(YEAR FROM o.date_date) = 2023
)
SELECT
    o.orders_id,
    o.client_id,
    o.order_date,
    o.CA_ht,
    CASE
        WHEN o.orders_in_last_12_months = 1 THEN 'New'
        WHEN o.orders_in_last_12_months BETWEEN 2 AND 4 THEN 'Returning'
        WHEN o.orders_in_last_12_months >= 5 THEN 'VIP'
        ELSE 'Unknown'
    END AS order_segmentation
FROM
    order_counts o;;


[0m15:11:16.061455 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e58b7df-03c6-4d2c-8378-4be9f89b3950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002557CFA2000>]}
[0m15:11:16.063520 [info ] [Thread-2 (]: 2 of 6 OK created sql view model orders_recrutement.order_segmentation ......... [[32mCREATE VIEW (0 processed)[0m in 1.09s]
[0m15:11:16.064584 [debug] [Thread-2 (]: Finished running node model.take_home_challenge.order_segmentation
[0m15:11:16.066077 [debug] [Thread-2 (]: Began running node model.take_home_challenge.orders_by_month
[0m15:11:16.067083 [info ] [Thread-2 (]: 6 of 6 START sql view model orders_recrutement.orders_by_month ................. [RUN]
[0m15:11:16.067083 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.take_home_challenge.order_segmentation, now model.take_home_challenge.orders_by_month)
[0m15:11:16.068540 [debug] [Thread-2 (]: Began compiling node model.take_home_challenge.orders_by_month
[0m15:11:16.070745 [debug] [Thread-2 (]: Writing injected SQL for node "model.take_home_challenge.orders_by_month"
[0m15:11:16.071254 [debug] [Thread-2 (]: Began executing node model.take_home_challenge.orders_by_month
[0m15:11:16.075179 [debug] [Thread-2 (]: Writing runtime sql for node "model.take_home_challenge.orders_by_month"
[0m15:11:16.076512 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:11:16.078411 [debug] [Thread-2 (]: On model.take_home_challenge.orders_by_month: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_by_month"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_by_month`
  OPTIONS()
  as SELECT
    EXTRACT(MONTH FROM date_date) AS month,
    COUNT(*) AS total_orders
FROM
    takehomechallenge.orders_recrutement.orders
WHERE
    EXTRACT(YEAR FROM date_date) = 2023
GROUP BY
    month
ORDER BY
    month;


[0m15:11:16.107975 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e58b7df-03c6-4d2c-8378-4be9f89b3950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002557D579BE0>]}
[0m15:11:16.109926 [info ] [Thread-4 (]: 4 of 6 OK created sql view model orders_recrutement.orders_2023 ................ [[32mCREATE VIEW (0 processed)[0m in 1.12s]
[0m15:11:16.111309 [debug] [Thread-4 (]: Finished running node model.take_home_challenge.orders_2023
[0m15:11:16.125956 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e58b7df-03c6-4d2c-8378-4be9f89b3950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002557D171EE0>]}
[0m15:11:16.126489 [info ] [Thread-1 (]: 1 of 6 OK created sql view model orders_recrutement.avg_products_per_order ..... [[32mCREATE VIEW (0 processed)[0m in 1.15s]
[0m15:11:16.127667 [debug] [Thread-1 (]: Finished running node model.take_home_challenge.avg_products_per_order
[0m15:11:16.287003 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:c572d590-18f1-4741-99bf-429b7e4b92da&page=queryresults
[0m15:11:16.288063 [debug] [Thread-3 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected ";" at [34:20]; reason: invalidQuery, location: query, message: Syntax error: Unexpected ";" at [34:20]')
[0m15:11:16.857657 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:ea6b3d73-c766-445f-b159-7a7d7da92e62&page=queryresults
[0m15:11:17.020537 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:386487ca-4796-4c51-8a52-8c9ee1a809f4&page=queryresults
[0m15:11:17.023907 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:386487ca-4796-4c51-8a52-8c9ee1a809f4&page=queryresults
[0m15:11:17.037901 [debug] [Thread-3 (]: Database Error in model orders_2023_with_segmentation (models\orders_2023_with_segmentation.sql)
  Syntax error: Unexpected ";" at [34:20]
  compiled code at target\run\take_home_challenge\models\orders_2023_with_segmentation.sql
[0m15:11:17.039374 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e58b7df-03c6-4d2c-8378-4be9f89b3950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002557CB842C0>]}
[0m15:11:17.040661 [error] [Thread-3 (]: 5 of 6 ERROR creating sql view model orders_recrutement.orders_2023_with_segmentation  [[31mERROR[0m in 1.27s]
[0m15:11:17.042740 [debug] [Thread-3 (]: Finished running node model.take_home_challenge.orders_2023_with_segmentation
[0m15:11:17.291139 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e58b7df-03c6-4d2c-8378-4be9f89b3950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002557CB87CB0>]}
[0m15:11:17.293325 [info ] [Thread-2 (]: 6 of 6 OK created sql view model orders_recrutement.orders_by_month ............ [[32mCREATE VIEW (0 processed)[0m in 1.22s]
[0m15:11:17.296373 [debug] [Thread-2 (]: Finished running node model.take_home_challenge.orders_by_month
[0m15:11:17.301347 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:11:17.303466 [debug] [MainThread]: Connection 'list_takehomechallenge' was properly closed.
[0m15:11:17.304008 [debug] [MainThread]: Connection 'list_takehomechallenge_orders_recrutement' was properly closed.
[0m15:11:17.306112 [debug] [MainThread]: Connection 'model.take_home_challenge.avg_products_per_order' was properly closed.
[0m15:11:17.308528 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_by_month' was properly closed.
[0m15:11:17.309755 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_2023_with_segmentation' was properly closed.
[0m15:11:17.310803 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_2023' was properly closed.
[0m15:11:17.312029 [info ] [MainThread]: 
[0m15:11:17.314048 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.30 seconds (3.30s).
[0m15:11:17.318645 [debug] [MainThread]: Command end result
[0m15:11:17.376230 [info ] [MainThread]: 
[0m15:11:17.376230 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m15:11:17.378728 [info ] [MainThread]: 
[0m15:11:17.378728 [error] [MainThread]:   Database Error in model orders_2022_2023_with_qty (models\orders_2022_2023_with_qty.sql)
  Syntax error: Unexpected keyword CREATE at [6:6]
  compiled code at target\run\take_home_challenge\models\orders_2022_2023_with_qty.sql
[0m15:11:17.379783 [info ] [MainThread]: 
[0m15:11:17.380733 [error] [MainThread]:   Database Error in model orders_2023_with_segmentation (models\orders_2023_with_segmentation.sql)
  Syntax error: Unexpected ";" at [34:20]
  compiled code at target\run\take_home_challenge\models\orders_2023_with_segmentation.sql
[0m15:11:17.380733 [info ] [MainThread]: 
[0m15:11:17.381740 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=2 SKIP=0 TOTAL=6
[0m15:11:17.382736 [debug] [MainThread]: Command `dbt run` failed at 15:11:17.382736 after 5.76 seconds
[0m15:11:17.383745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025569D0C680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025569D0C380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025567D01190>]}
[0m15:11:17.383745 [debug] [MainThread]: Flushing usage events
[0m15:11:32.901424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021DD4379FA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021DD6E485F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021DD3708B00>]}


============================== 15:11:32.905429 | beb3bf14-fd8e-4924-a7d5-fa23398148a6 ==============================
[0m15:11:32.905429 [info ] [MainThread]: Running with dbt=1.8.7
[0m15:11:32.906439 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\thoma\\PycharmProjects\\Take-Home challenge\\logs', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --full-refresh', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m15:11:34.190142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'beb3bf14-fd8e-4924-a7d5-fa23398148a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021DE98DD850>]}
[0m15:11:34.240546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'beb3bf14-fd8e-4924-a7d5-fa23398148a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021DE99E37D0>]}
[0m15:11:34.241648 [info ] [MainThread]: Registered adapter: bigquery=1.8.3
[0m15:11:34.558015 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m15:11:34.701583 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:11:34.702594 [debug] [MainThread]: Partial parsing: updated file: take_home_challenge://models\orders_2022_2023_with_qty.sql
[0m15:11:34.906337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'beb3bf14-fd8e-4924-a7d5-fa23398148a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021DE9B4FD10>]}
[0m15:11:34.994923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'beb3bf14-fd8e-4924-a7d5-fa23398148a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021DE9DBBB90>]}
[0m15:11:34.996266 [info ] [MainThread]: Found 6 models, 2 sources, 484 macros
[0m15:11:34.997571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'beb3bf14-fd8e-4924-a7d5-fa23398148a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021DD7024860>]}
[0m15:11:34.999277 [info ] [MainThread]: 
[0m15:11:35.000747 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m15:11:35.004627 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge'
[0m15:11:35.004627 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:11:35.453571 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge_orders_recrutement'
[0m15:11:35.455298 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:11:35.869554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'beb3bf14-fd8e-4924-a7d5-fa23398148a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021DD7024860>]}
[0m15:11:35.871022 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:11:35.873007 [info ] [MainThread]: 
[0m15:11:35.883913 [debug] [Thread-1 (]: Began running node model.take_home_challenge.avg_products_per_order
[0m15:11:35.885080 [debug] [Thread-2 (]: Began running node model.take_home_challenge.order_segmentation
[0m15:11:35.885587 [debug] [Thread-3 (]: Began running node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:11:35.886705 [debug] [Thread-4 (]: Began running node model.take_home_challenge.orders_2023
[0m15:11:35.888619 [info ] [Thread-1 (]: 1 of 6 START sql view model orders_recrutement.avg_products_per_order .......... [RUN]
[0m15:11:35.889856 [info ] [Thread-2 (]: 2 of 6 START sql view model orders_recrutement.order_segmentation .............. [RUN]
[0m15:11:35.891983 [info ] [Thread-3 (]: 3 of 6 START sql view model orders_recrutement.orders_2022_2023_with_qty ....... [RUN]
[0m15:11:35.893280 [info ] [Thread-4 (]: 4 of 6 START sql view model orders_recrutement.orders_2023 ..................... [RUN]
[0m15:11:35.895628 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.take_home_challenge.avg_products_per_order'
[0m15:11:35.896740 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.take_home_challenge.order_segmentation'
[0m15:11:35.898760 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_2022_2023_with_qty'
[0m15:11:35.899808 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_2023'
[0m15:11:35.901840 [debug] [Thread-1 (]: Began compiling node model.take_home_challenge.avg_products_per_order
[0m15:11:35.902834 [debug] [Thread-2 (]: Began compiling node model.take_home_challenge.order_segmentation
[0m15:11:35.904821 [debug] [Thread-3 (]: Began compiling node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:11:35.905821 [debug] [Thread-4 (]: Began compiling node model.take_home_challenge.orders_2023
[0m15:11:35.920866 [debug] [Thread-1 (]: Writing injected SQL for node "model.take_home_challenge.avg_products_per_order"
[0m15:11:35.925172 [debug] [Thread-2 (]: Writing injected SQL for node "model.take_home_challenge.order_segmentation"
[0m15:11:35.927867 [debug] [Thread-3 (]: Writing injected SQL for node "model.take_home_challenge.orders_2022_2023_with_qty"
[0m15:11:35.931439 [debug] [Thread-4 (]: Writing injected SQL for node "model.take_home_challenge.orders_2023"
[0m15:11:35.933805 [debug] [Thread-1 (]: Began executing node model.take_home_challenge.avg_products_per_order
[0m15:11:35.934830 [debug] [Thread-2 (]: Began executing node model.take_home_challenge.order_segmentation
[0m15:11:35.935832 [debug] [Thread-3 (]: Began executing node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:11:35.949025 [debug] [Thread-4 (]: Began executing node model.take_home_challenge.orders_2023
[0m15:11:35.967341 [debug] [Thread-2 (]: Writing runtime sql for node "model.take_home_challenge.order_segmentation"
[0m15:11:35.970837 [debug] [Thread-1 (]: Writing runtime sql for node "model.take_home_challenge.avg_products_per_order"
[0m15:11:35.973836 [debug] [Thread-3 (]: Writing runtime sql for node "model.take_home_challenge.orders_2022_2023_with_qty"
[0m15:11:35.976456 [debug] [Thread-4 (]: Writing runtime sql for node "model.take_home_challenge.orders_2023"
[0m15:11:35.977463 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:11:35.978811 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:11:35.978811 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m15:11:35.979928 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:11:35.981935 [debug] [Thread-2 (]: On model.take_home_challenge.order_segmentation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.order_segmentation"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`order_segmentation`
  OPTIONS()
  as WITH order_counts AS (
    SELECT
        o.orders_id,
        o.customers_id AS client_id,
        o.date_date AS order_date,
        COUNT(*) OVER (
            PARTITION BY o.customers_id
            ORDER BY o.date_date
            ROWS BETWEEN 12 PRECEDING AND CURRENT ROW
        ) AS orders_in_last_12_months
    FROM
        takehomechallenge.orders_recrutement.orders o
    WHERE
        EXTRACT(YEAR FROM o.date_date) = 2023
)
SELECT
    o.orders_id,
    o.client_id,
    o.order_date,
    CASE
        WHEN o.orders_in_last_12_months = 1 THEN 'New'
        WHEN o.orders_in_last_12_months BETWEEN 2 AND 4 THEN 'Returning'
        WHEN o.orders_in_last_12_months >= 5 THEN 'VIP'
        ELSE 'Unknown'
    END AS order_segment
FROM
    order_counts o
ORDER BY
    o.order_date, o.client_id;


[0m15:11:35.984032 [debug] [Thread-3 (]: On model.take_home_challenge.orders_2022_2023_with_qty: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2022_2023_with_qty"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2022_2023_with_qty`
  OPTIONS()
  as CREATE OR REPLACE TABLE takehomechallenge.orders_recrutement.orders_2022_2023_with_qty AS
SELECT
    o.date_date AS order_date,
    o.customers_id,
    o.orders_id,
    o.CA_ht,
    SUM(s.qty) AS qty_product  -- Calcul de la quantité totale de produits par commande
FROM
    takehomechallenge.orders_recrutement.orders o
JOIN
    takehomechallenge.sales_recrutement.sales s
ON
    o.customers_id = s.client_id
    AND o.orders_id = s.transaction_id  -- Lier chaque commande à ses produits
WHERE
    EXTRACT(YEAR FROM o.date_date) IN (2022, 2023)  -- Filtrer pour 2022 et 2023
GROUP BY
    o.date_date, o.customers_id, o.orders_id, o.CA_ht
ORDER BY
    o.date_date, o.orders_id;


[0m15:11:35.986065 [debug] [Thread-1 (]: On model.take_home_challenge.avg_products_per_order: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.avg_products_per_order"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`avg_products_per_order`
  OPTIONS()
  as SELECT
    EXTRACT(MONTH FROM date_date) AS month,
    AVG(qty) AS avg_products_per_order
FROM
    takehomechallenge.sales_recrutement.sales
WHERE
    EXTRACT(YEAR FROM date_date) = 2023
GROUP BY
    month
ORDER BY
    month;


[0m15:11:35.987312 [debug] [Thread-4 (]: On model.take_home_challenge.orders_2023: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2023"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2023`
  OPTIONS()
  as SELECT
    COUNT(*) AS total_orders_2023
FROM
    takehomechallenge.orders_recrutement.orders
WHERE
    EXTRACT(YEAR FROM date_date) = 2023;


[0m15:11:36.436029 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:927cff3c-10f8-4848-84b4-4cad5ec23176&page=queryresults
[0m15:11:36.437369 [debug] [Thread-3 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected keyword CREATE at [6:6]; reason: invalidQuery, location: query, message: Syntax error: Unexpected keyword CREATE at [6:6]')
[0m15:11:36.606340 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:6aab0343-3861-438f-b5fd-c2b74cd9151f&page=queryresults
[0m15:11:36.727708 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:7e2decc5-7a8b-41e3-8f59-c4e2cd0f7859&page=queryresults
[0m15:11:36.755931 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:40d9ac9d-ccbb-4543-b5a1-4494319c0118&page=queryresults
[0m15:11:37.062901 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'beb3bf14-fd8e-4924-a7d5-fa23398148a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021DD682CD70>]}
[0m15:11:37.065328 [info ] [Thread-2 (]: 2 of 6 OK created sql view model orders_recrutement.order_segmentation ......... [[32mCREATE VIEW (0 processed)[0m in 1.17s]
[0m15:11:37.066343 [debug] [Thread-2 (]: Finished running node model.take_home_challenge.order_segmentation
[0m15:11:37.066856 [debug] [Thread-2 (]: Began running node model.take_home_challenge.orders_2023_with_segmentation
[0m15:11:37.066856 [info ] [Thread-2 (]: 5 of 6 START sql view model orders_recrutement.orders_2023_with_segmentation ... [RUN]
[0m15:11:37.068002 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.take_home_challenge.order_segmentation, now model.take_home_challenge.orders_2023_with_segmentation)
[0m15:11:37.068002 [debug] [Thread-2 (]: Began compiling node model.take_home_challenge.orders_2023_with_segmentation
[0m15:11:37.071197 [debug] [Thread-2 (]: Writing injected SQL for node "model.take_home_challenge.orders_2023_with_segmentation"
[0m15:11:37.072212 [debug] [Thread-2 (]: Began executing node model.take_home_challenge.orders_2023_with_segmentation
[0m15:11:37.142707 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'beb3bf14-fd8e-4924-a7d5-fa23398148a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021DEA0AD580>]}
[0m15:11:37.146538 [debug] [Thread-2 (]: Writing runtime sql for node "model.take_home_challenge.orders_2023_with_segmentation"
[0m15:11:37.148011 [info ] [Thread-1 (]: 1 of 6 OK created sql view model orders_recrutement.avg_products_per_order ..... [[32mCREATE VIEW (0 processed)[0m in 1.25s]
[0m15:11:37.149044 [debug] [Thread-1 (]: Finished running node model.take_home_challenge.avg_products_per_order
[0m15:11:37.150528 [debug] [Thread-1 (]: Began running node model.take_home_challenge.orders_by_month
[0m15:11:37.150528 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:11:37.151931 [info ] [Thread-1 (]: 6 of 6 START sql view model orders_recrutement.orders_by_month ................. [RUN]
[0m15:11:37.154022 [debug] [Thread-2 (]: On model.take_home_challenge.orders_2023_with_segmentation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2023_with_segmentation"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2023_with_segmentation`
  OPTIONS()
  as WITH order_counts AS (
    SELECT
        o.orders_id,
        o.customers_id AS client_id,
        o.date_date AS order_date,
        o.CA_ht,  -- Assurez-vous de sélectionner CA_ht dans la sous-requête
        COUNT(*) OVER (
            PARTITION BY o.customers_id
            ORDER BY o.date_date
            ROWS BETWEEN 12 PRECEDING AND CURRENT ROW
        ) AS orders_in_last_12_months
    FROM
        takehomechallenge.orders_recrutement.orders o
    WHERE
        EXTRACT(YEAR FROM o.date_date) = 2023
)
SELECT
    o.orders_id,
    o.client_id,
    o.order_date,
    o.CA_ht,
    CASE
        WHEN o.orders_in_last_12_months = 1 THEN 'New'
        WHEN o.orders_in_last_12_months BETWEEN 2 AND 4 THEN 'Returning'
        WHEN o.orders_in_last_12_months >= 5 THEN 'VIP'
        ELSE 'Unknown'
    END AS order_segmentation
FROM
    order_counts o;;


[0m15:11:37.154374 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.take_home_challenge.avg_products_per_order, now model.take_home_challenge.orders_by_month)
[0m15:11:37.180130 [debug] [Thread-1 (]: Began compiling node model.take_home_challenge.orders_by_month
[0m15:11:37.184130 [debug] [Thread-1 (]: Writing injected SQL for node "model.take_home_challenge.orders_by_month"
[0m15:11:37.185128 [debug] [Thread-1 (]: Began executing node model.take_home_challenge.orders_by_month
[0m15:11:37.189627 [debug] [Thread-1 (]: Writing runtime sql for node "model.take_home_challenge.orders_by_month"
[0m15:11:37.191134 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:11:37.193626 [debug] [Thread-1 (]: On model.take_home_challenge.orders_by_month: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_by_month"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_by_month`
  OPTIONS()
  as SELECT
    EXTRACT(MONTH FROM date_date) AS month,
    COUNT(*) AS total_orders
FROM
    takehomechallenge.orders_recrutement.orders
WHERE
    EXTRACT(YEAR FROM date_date) = 2023
GROUP BY
    month
ORDER BY
    month;


[0m15:11:37.270147 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'beb3bf14-fd8e-4924-a7d5-fa23398148a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021DE9E8B9E0>]}
[0m15:11:37.271145 [info ] [Thread-4 (]: 4 of 6 OK created sql view model orders_recrutement.orders_2023 ................ [[32mCREATE VIEW (0 processed)[0m in 1.37s]
[0m15:11:37.272154 [debug] [Thread-4 (]: Finished running node model.take_home_challenge.orders_2023
[0m15:11:37.498371 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:83e00b01-e5e4-42fa-8a6b-b4d560e7241b&page=queryresults
[0m15:11:37.499887 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:83e00b01-e5e4-42fa-8a6b-b4d560e7241b&page=queryresults
[0m15:11:37.506700 [debug] [Thread-3 (]: Database Error in model orders_2022_2023_with_qty (models\orders_2022_2023_with_qty.sql)
  Syntax error: Unexpected keyword CREATE at [6:6]
  compiled code at target\run\take_home_challenge\models\orders_2022_2023_with_qty.sql
[0m15:11:37.507928 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'beb3bf14-fd8e-4924-a7d5-fa23398148a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021DE9E8AF30>]}
[0m15:11:37.508556 [error] [Thread-3 (]: 3 of 6 ERROR creating sql view model orders_recrutement.orders_2022_2023_with_qty  [[31mERROR[0m in 1.61s]
[0m15:11:37.510005 [debug] [Thread-3 (]: Finished running node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:11:37.637235 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:4305c35a-a1c3-43f9-96f8-7e44ae17e166&page=queryresults
[0m15:11:37.638463 [debug] [Thread-2 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected ";" at [34:20]; reason: invalidQuery, location: query, message: Syntax error: Unexpected ";" at [34:20]')
[0m15:11:37.958853 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:ddde59ab-14fb-439a-a787-0d7baccd85ec&page=queryresults
[0m15:11:38.274318 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'beb3bf14-fd8e-4924-a7d5-fa23398148a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021DD4C89DF0>]}
[0m15:11:38.276800 [info ] [Thread-1 (]: 6 of 6 OK created sql view model orders_recrutement.orders_by_month ............ [[32mCREATE VIEW (0 processed)[0m in 1.12s]
[0m15:11:38.279782 [debug] [Thread-1 (]: Finished running node model.take_home_challenge.orders_by_month
[0m15:11:38.469128 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:64958c41-303b-4e0f-8157-23f9a910ec2a&page=queryresults
[0m15:11:38.470357 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:64958c41-303b-4e0f-8157-23f9a910ec2a&page=queryresults
[0m15:11:38.475809 [debug] [Thread-2 (]: Database Error in model orders_2023_with_segmentation (models\orders_2023_with_segmentation.sql)
  Syntax error: Unexpected ";" at [34:20]
  compiled code at target\run\take_home_challenge\models\orders_2023_with_segmentation.sql
[0m15:11:38.476808 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'beb3bf14-fd8e-4924-a7d5-fa23398148a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021DEA090920>]}
[0m15:11:38.477814 [error] [Thread-2 (]: 5 of 6 ERROR creating sql view model orders_recrutement.orders_2023_with_segmentation  [[31mERROR[0m in 1.41s]
[0m15:11:38.479945 [debug] [Thread-2 (]: Finished running node model.take_home_challenge.orders_2023_with_segmentation
[0m15:11:38.482941 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:11:38.483950 [debug] [MainThread]: Connection 'list_takehomechallenge' was properly closed.
[0m15:11:38.483950 [debug] [MainThread]: Connection 'list_takehomechallenge_orders_recrutement' was properly closed.
[0m15:11:38.485034 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_by_month' was properly closed.
[0m15:11:38.485034 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_2023_with_segmentation' was properly closed.
[0m15:11:38.486211 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_2022_2023_with_qty' was properly closed.
[0m15:11:38.486211 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_2023' was properly closed.
[0m15:11:38.487364 [info ] [MainThread]: 
[0m15:11:38.488638 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.49 seconds (3.49s).
[0m15:11:38.491453 [debug] [MainThread]: Command end result
[0m15:11:38.532506 [info ] [MainThread]: 
[0m15:11:38.533506 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m15:11:38.534888 [info ] [MainThread]: 
[0m15:11:38.535906 [error] [MainThread]:   Database Error in model orders_2022_2023_with_qty (models\orders_2022_2023_with_qty.sql)
  Syntax error: Unexpected keyword CREATE at [6:6]
  compiled code at target\run\take_home_challenge\models\orders_2022_2023_with_qty.sql
[0m15:11:38.535906 [info ] [MainThread]: 
[0m15:11:38.536944 [error] [MainThread]:   Database Error in model orders_2023_with_segmentation (models\orders_2023_with_segmentation.sql)
  Syntax error: Unexpected ";" at [34:20]
  compiled code at target\run\take_home_challenge\models\orders_2023_with_segmentation.sql
[0m15:11:38.538242 [info ] [MainThread]: 
[0m15:11:38.539342 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=2 SKIP=0 TOTAL=6
[0m15:11:38.540388 [debug] [MainThread]: Command `dbt run` failed at 15:11:38.540388 after 5.75 seconds
[0m15:11:38.540903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021DD61154C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021DD6D783B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021DD4379FA0>]}
[0m15:11:38.540903 [debug] [MainThread]: Flushing usage events
[0m15:12:00.011750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5DCCF8D10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5DC58BBC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5DC58B3B0>]}


============================== 15:12:00.015246 | 564714fc-1e4c-4c87-bbf4-f1406ff608f3 ==============================
[0m15:12:00.015246 [info ] [MainThread]: Running with dbt=1.8.7
[0m15:12:00.016254 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': 'C:\\Users\\thoma\\PycharmProjects\\Take-Home challenge\\logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --full-refresh', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:12:01.317606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '564714fc-1e4c-4c87-bbf4-f1406ff608f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5EE66B530>]}
[0m15:12:01.366366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '564714fc-1e4c-4c87-bbf4-f1406ff608f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5EE503770>]}
[0m15:12:01.366366 [info ] [MainThread]: Registered adapter: bigquery=1.8.3
[0m15:12:01.666716 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m15:12:01.817916 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:12:01.818920 [debug] [MainThread]: Partial parsing: updated file: take_home_challenge://models\orders_2023_with_segmentation.sql
[0m15:12:02.028322 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '564714fc-1e4c-4c87-bbf4-f1406ff608f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5EFFFA060>]}
[0m15:12:02.118848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '564714fc-1e4c-4c87-bbf4-f1406ff608f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5F048AF00>]}
[0m15:12:02.120040 [info ] [MainThread]: Found 6 models, 2 sources, 484 macros
[0m15:12:02.120040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '564714fc-1e4c-4c87-bbf4-f1406ff608f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5F0367A10>]}
[0m15:12:02.122237 [info ] [MainThread]: 
[0m15:12:02.123796 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m15:12:02.127801 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge'
[0m15:12:02.127801 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:12:02.528942 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge_orders_recrutement'
[0m15:12:02.529965 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:12:02.902221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '564714fc-1e4c-4c87-bbf4-f1406ff608f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5DB084C20>]}
[0m15:12:02.905277 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:12:02.907932 [info ] [MainThread]: 
[0m15:12:02.932489 [debug] [Thread-1 (]: Began running node model.take_home_challenge.avg_products_per_order
[0m15:12:02.940480 [debug] [Thread-2 (]: Began running node model.take_home_challenge.order_segmentation
[0m15:12:02.941480 [debug] [Thread-3 (]: Began running node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:12:02.941480 [debug] [Thread-4 (]: Began running node model.take_home_challenge.orders_2023
[0m15:12:02.939480 [info ] [Thread-1 (]: 1 of 6 START sql view model orders_recrutement.avg_products_per_order .......... [RUN]
[0m15:12:02.942478 [info ] [Thread-2 (]: 2 of 6 START sql view model orders_recrutement.order_segmentation .............. [RUN]
[0m15:12:02.943479 [info ] [Thread-3 (]: 3 of 6 START sql view model orders_recrutement.orders_2022_2023_with_qty ....... [RUN]
[0m15:12:02.945478 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.take_home_challenge.avg_products_per_order'
[0m15:12:02.944478 [info ] [Thread-4 (]: 4 of 6 START sql view model orders_recrutement.orders_2023 ..................... [RUN]
[0m15:12:02.945478 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.take_home_challenge.order_segmentation'
[0m15:12:02.945478 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_2022_2023_with_qty'
[0m15:12:02.946886 [debug] [Thread-1 (]: Began compiling node model.take_home_challenge.avg_products_per_order
[0m15:12:02.946886 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_2023'
[0m15:12:02.948312 [debug] [Thread-2 (]: Began compiling node model.take_home_challenge.order_segmentation
[0m15:12:02.948312 [debug] [Thread-3 (]: Began compiling node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:12:02.962011 [debug] [Thread-1 (]: Writing injected SQL for node "model.take_home_challenge.avg_products_per_order"
[0m15:12:02.962011 [debug] [Thread-4 (]: Began compiling node model.take_home_challenge.orders_2023
[0m15:12:02.964825 [debug] [Thread-2 (]: Writing injected SQL for node "model.take_home_challenge.order_segmentation"
[0m15:12:02.967831 [debug] [Thread-3 (]: Writing injected SQL for node "model.take_home_challenge.orders_2022_2023_with_qty"
[0m15:12:02.971173 [debug] [Thread-4 (]: Writing injected SQL for node "model.take_home_challenge.orders_2023"
[0m15:12:02.972654 [debug] [Thread-1 (]: Began executing node model.take_home_challenge.avg_products_per_order
[0m15:12:02.973660 [debug] [Thread-2 (]: Began executing node model.take_home_challenge.order_segmentation
[0m15:12:02.979712 [debug] [Thread-3 (]: Began executing node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:12:03.006934 [debug] [Thread-1 (]: Writing runtime sql for node "model.take_home_challenge.avg_products_per_order"
[0m15:12:03.010193 [debug] [Thread-2 (]: Writing runtime sql for node "model.take_home_challenge.order_segmentation"
[0m15:12:03.010193 [debug] [Thread-4 (]: Began executing node model.take_home_challenge.orders_2023
[0m15:12:03.012725 [debug] [Thread-3 (]: Writing runtime sql for node "model.take_home_challenge.orders_2022_2023_with_qty"
[0m15:12:03.016241 [debug] [Thread-4 (]: Writing runtime sql for node "model.take_home_challenge.orders_2023"
[0m15:12:03.017239 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m15:12:03.017239 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:12:03.019708 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:12:03.019708 [debug] [Thread-1 (]: On model.take_home_challenge.avg_products_per_order: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.avg_products_per_order"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`avg_products_per_order`
  OPTIONS()
  as SELECT
    EXTRACT(MONTH FROM date_date) AS month,
    AVG(qty) AS avg_products_per_order
FROM
    takehomechallenge.sales_recrutement.sales
WHERE
    EXTRACT(YEAR FROM date_date) = 2023
GROUP BY
    month
ORDER BY
    month;


[0m15:12:03.020708 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:12:03.021995 [debug] [Thread-2 (]: On model.take_home_challenge.order_segmentation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.order_segmentation"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`order_segmentation`
  OPTIONS()
  as WITH order_counts AS (
    SELECT
        o.orders_id,
        o.customers_id AS client_id,
        o.date_date AS order_date,
        COUNT(*) OVER (
            PARTITION BY o.customers_id
            ORDER BY o.date_date
            ROWS BETWEEN 12 PRECEDING AND CURRENT ROW
        ) AS orders_in_last_12_months
    FROM
        takehomechallenge.orders_recrutement.orders o
    WHERE
        EXTRACT(YEAR FROM o.date_date) = 2023
)
SELECT
    o.orders_id,
    o.client_id,
    o.order_date,
    CASE
        WHEN o.orders_in_last_12_months = 1 THEN 'New'
        WHEN o.orders_in_last_12_months BETWEEN 2 AND 4 THEN 'Returning'
        WHEN o.orders_in_last_12_months >= 5 THEN 'VIP'
        ELSE 'Unknown'
    END AS order_segment
FROM
    order_counts o
ORDER BY
    o.order_date, o.client_id;


[0m15:12:03.023360 [debug] [Thread-3 (]: On model.take_home_challenge.orders_2022_2023_with_qty: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2022_2023_with_qty"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2022_2023_with_qty`
  OPTIONS()
  as CREATE OR REPLACE TABLE takehomechallenge.orders_recrutement.orders_2022_2023_with_qty AS
SELECT
    o.date_date AS order_date,
    o.customers_id,
    o.orders_id,
    o.CA_ht,
    SUM(s.qty) AS qty_product  -- Calcul de la quantité totale de produits par commande
FROM
    takehomechallenge.orders_recrutement.orders o
JOIN
    takehomechallenge.sales_recrutement.sales s
ON
    o.customers_id = s.client_id
    AND o.orders_id = s.transaction_id  -- Lier chaque commande à ses produits
WHERE
    EXTRACT(YEAR FROM o.date_date) IN (2022, 2023)  -- Filtrer pour 2022 et 2023
GROUP BY
    o.date_date, o.customers_id, o.orders_id, o.CA_ht
ORDER BY
    o.date_date, o.orders_id;


[0m15:12:03.049212 [debug] [Thread-4 (]: On model.take_home_challenge.orders_2023: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2023"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2023`
  OPTIONS()
  as SELECT
    COUNT(*) AS total_orders_2023
FROM
    takehomechallenge.orders_recrutement.orders
WHERE
    EXTRACT(YEAR FROM date_date) = 2023;


[0m15:12:03.503733 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:3c1010c8-ac89-4017-8c4a-11e4c3225b82&page=queryresults
[0m15:12:03.505731 [debug] [Thread-3 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected keyword CREATE at [6:6]; reason: invalidQuery, location: query, message: Syntax error: Unexpected keyword CREATE at [6:6]')
[0m15:12:03.554115 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:a1b26dce-1c7e-4f66-9abb-d996a8fae5d9&page=queryresults
[0m15:12:03.688388 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:c145c480-197f-469c-a1d7-c01b8da46572&page=queryresults
[0m15:12:03.783413 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:9dc21ffe-68ad-49f7-ab55-8a7e49ec8991&page=queryresults
[0m15:12:03.784400 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:9dc21ffe-68ad-49f7-ab55-8a7e49ec8991&page=queryresults
[0m15:12:03.792507 [debug] [Thread-3 (]: Database Error in model orders_2022_2023_with_qty (models\orders_2022_2023_with_qty.sql)
  Syntax error: Unexpected keyword CREATE at [6:6]
  compiled code at target\run\take_home_challenge\models\orders_2022_2023_with_qty.sql
[0m15:12:03.794839 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '564714fc-1e4c-4c87-bbf4-f1406ff608f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5F0974F50>]}
[0m15:12:03.794839 [error] [Thread-3 (]: 3 of 6 ERROR creating sql view model orders_recrutement.orders_2022_2023_with_qty  [[31mERROR[0m in 0.85s]
[0m15:12:03.796284 [debug] [Thread-3 (]: Finished running node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:12:03.796284 [debug] [Thread-3 (]: Began running node model.take_home_challenge.orders_2023_with_segmentation
[0m15:12:03.797299 [info ] [Thread-3 (]: 5 of 6 START sql view model orders_recrutement.orders_2023_with_segmentation ... [RUN]
[0m15:12:03.798487 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.take_home_challenge.orders_2022_2023_with_qty, now model.take_home_challenge.orders_2023_with_segmentation)
[0m15:12:03.799576 [debug] [Thread-3 (]: Began compiling node model.take_home_challenge.orders_2023_with_segmentation
[0m15:12:03.804039 [debug] [Thread-3 (]: Writing injected SQL for node "model.take_home_challenge.orders_2023_with_segmentation"
[0m15:12:03.806265 [debug] [Thread-3 (]: Began executing node model.take_home_challenge.orders_2023_with_segmentation
[0m15:12:03.874001 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:671dc7b4-42c8-4bc0-995c-079c0cca0fc0&page=queryresults
[0m15:12:03.877083 [debug] [Thread-3 (]: Writing runtime sql for node "model.take_home_challenge.orders_2023_with_segmentation"
[0m15:12:03.881220 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m15:12:03.883440 [debug] [Thread-3 (]: On model.take_home_challenge.orders_2023_with_segmentation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2023_with_segmentation"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2023_with_segmentation`
  OPTIONS()
  as WITH order_counts AS (
    SELECT
        o.orders_id,
        o.customers_id AS client_id,
        o.date_date AS order_date,
        o.CA_ht,  -- Assurez-vous de sélectionner CA_ht dans la sous-requête
        COUNT(*) OVER (
            PARTITION BY o.customers_id
            ORDER BY o.date_date
            ROWS BETWEEN 12 PRECEDING AND CURRENT ROW
        ) AS orders_in_last_12_months
    FROM
        takehomechallenge.orders_recrutement.orders o
    WHERE
        EXTRACT(YEAR FROM o.date_date) = 2023
)
SELECT
    o.orders_id,
    o.client_id,
    o.order_date,
    o.CA_ht,
    CASE
        WHEN o.orders_in_last_12_months = 1 THEN 'New'
        WHEN o.orders_in_last_12_months BETWEEN 2 AND 4 THEN 'Returning'
        WHEN o.orders_in_last_12_months >= 5 THEN 'VIP'
        ELSE 'Unknown'
    END AS order_segmentation
FROM
    order_counts o;


[0m15:12:04.014902 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '564714fc-1e4c-4c87-bbf4-f1406ff608f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5F03F1C10>]}
[0m15:12:04.015902 [info ] [Thread-4 (]: 4 of 6 OK created sql view model orders_recrutement.orders_2023 ................ [[32mCREATE VIEW (0 processed)[0m in 1.07s]
[0m15:12:04.016902 [debug] [Thread-4 (]: Finished running node model.take_home_challenge.orders_2023
[0m15:12:04.017903 [debug] [Thread-4 (]: Began running node model.take_home_challenge.orders_by_month
[0m15:12:04.017903 [info ] [Thread-4 (]: 6 of 6 START sql view model orders_recrutement.orders_by_month ................. [RUN]
[0m15:12:04.018948 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.take_home_challenge.orders_2023, now model.take_home_challenge.orders_by_month)
[0m15:12:04.018948 [debug] [Thread-4 (]: Began compiling node model.take_home_challenge.orders_by_month
[0m15:12:04.021953 [debug] [Thread-4 (]: Writing injected SQL for node "model.take_home_challenge.orders_by_month"
[0m15:12:04.022954 [debug] [Thread-4 (]: Began executing node model.take_home_challenge.orders_by_month
[0m15:12:04.025599 [debug] [Thread-4 (]: Writing runtime sql for node "model.take_home_challenge.orders_by_month"
[0m15:12:04.027608 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:12:04.028937 [debug] [Thread-4 (]: On model.take_home_challenge.orders_by_month: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_by_month"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_by_month`
  OPTIONS()
  as SELECT
    EXTRACT(MONTH FROM date_date) AS month,
    COUNT(*) AS total_orders
FROM
    takehomechallenge.orders_recrutement.orders
WHERE
    EXTRACT(YEAR FROM date_date) = 2023
GROUP BY
    month
ORDER BY
    month;


[0m15:12:04.056779 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '564714fc-1e4c-4c87-bbf4-f1406ff608f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5F03B3D70>]}
[0m15:12:04.058153 [info ] [Thread-1 (]: 1 of 6 OK created sql view model orders_recrutement.avg_products_per_order ..... [[32mCREATE VIEW (0 processed)[0m in 1.11s]
[0m15:12:04.059224 [debug] [Thread-1 (]: Finished running node model.take_home_challenge.avg_products_per_order
[0m15:12:04.240110 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '564714fc-1e4c-4c87-bbf4-f1406ff608f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5F093FA70>]}
[0m15:12:04.241111 [info ] [Thread-2 (]: 2 of 6 OK created sql view model orders_recrutement.order_segmentation ......... [[32mCREATE VIEW (0 processed)[0m in 1.29s]
[0m15:12:04.242559 [debug] [Thread-2 (]: Finished running node model.take_home_challenge.order_segmentation
[0m15:12:04.578815 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:c4ba0ac5-e8ce-4d8e-8149-a2568654fde1&page=queryresults
[0m15:12:04.702047 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:5fe0aed3-5f9d-4dd1-970f-988163fafd79&page=queryresults
[0m15:12:04.874171 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '564714fc-1e4c-4c87-bbf4-f1406ff608f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5F055D6D0>]}
[0m15:12:04.875180 [info ] [Thread-3 (]: 5 of 6 OK created sql view model orders_recrutement.orders_2023_with_segmentation  [[32mCREATE VIEW (0 processed)[0m in 1.08s]
[0m15:12:04.876179 [debug] [Thread-3 (]: Finished running node model.take_home_challenge.orders_2023_with_segmentation
[0m15:12:05.069171 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '564714fc-1e4c-4c87-bbf4-f1406ff608f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5F035BE60>]}
[0m15:12:05.072090 [info ] [Thread-4 (]: 6 of 6 OK created sql view model orders_recrutement.orders_by_month ............ [[32mCREATE VIEW (0 processed)[0m in 1.05s]
[0m15:12:05.075403 [debug] [Thread-4 (]: Finished running node model.take_home_challenge.orders_by_month
[0m15:12:05.079457 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:12:05.081439 [debug] [MainThread]: Connection 'list_takehomechallenge' was properly closed.
[0m15:12:05.082885 [debug] [MainThread]: Connection 'list_takehomechallenge_orders_recrutement' was properly closed.
[0m15:12:05.084450 [debug] [MainThread]: Connection 'model.take_home_challenge.avg_products_per_order' was properly closed.
[0m15:12:05.085558 [debug] [MainThread]: Connection 'model.take_home_challenge.order_segmentation' was properly closed.
[0m15:12:05.086721 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_2023_with_segmentation' was properly closed.
[0m15:12:05.087847 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_by_month' was properly closed.
[0m15:12:05.089586 [info ] [MainThread]: 
[0m15:12:05.090674 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 2.97 seconds (2.97s).
[0m15:12:05.096055 [debug] [MainThread]: Command end result
[0m15:12:05.161644 [info ] [MainThread]: 
[0m15:12:05.162851 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:12:05.162851 [info ] [MainThread]: 
[0m15:12:05.164146 [error] [MainThread]:   Database Error in model orders_2022_2023_with_qty (models\orders_2022_2023_with_qty.sql)
  Syntax error: Unexpected keyword CREATE at [6:6]
  compiled code at target\run\take_home_challenge\models\orders_2022_2023_with_qty.sql
[0m15:12:05.164146 [info ] [MainThread]: 
[0m15:12:05.165200 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m15:12:05.166242 [debug] [MainThread]: Command `dbt run` failed at 15:12:05.166242 after 5.27 seconds
[0m15:12:05.167246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5DD411E20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5DD09C680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A5DD245280>]}
[0m15:12:05.167246 [debug] [MainThread]: Flushing usage events
[0m15:13:04.846326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002369E350E00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000236A1344110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000236A1240170>]}


============================== 15:13:04.850999 | b06a869b-8a2d-4eee-8ee1-a9985fc24436 ==============================
[0m15:13:04.850999 [info ] [MainThread]: Running with dbt=1.8.7
[0m15:13:04.852013 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'log_path': 'C:\\Users\\thoma\\PycharmProjects\\Take-Home challenge\\logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --full-refresh', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:13:06.219637 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b06a869b-8a2d-4eee-8ee1-a9985fc24436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000236B18B9A60>]}
[0m15:13:06.270551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b06a869b-8a2d-4eee-8ee1-a9985fc24436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000236A0458440>]}
[0m15:13:06.271546 [info ] [MainThread]: Registered adapter: bigquery=1.8.3
[0m15:13:06.663450 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m15:13:06.800635 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:13:06.801737 [debug] [MainThread]: Partial parsing: updated file: take_home_challenge://models\orders_2022_2023_with_qty.sql
[0m15:13:07.016713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b06a869b-8a2d-4eee-8ee1-a9985fc24436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000236B42B0C50>]}
[0m15:13:07.175982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b06a869b-8a2d-4eee-8ee1-a9985fc24436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000236B42B3B90>]}
[0m15:13:07.176981 [info ] [MainThread]: Found 6 models, 2 sources, 484 macros
[0m15:13:07.179982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b06a869b-8a2d-4eee-8ee1-a9985fc24436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000236B3EA0290>]}
[0m15:13:07.182980 [info ] [MainThread]: 
[0m15:13:07.184980 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m15:13:07.190979 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge'
[0m15:13:07.191980 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:13:07.715548 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge_orders_recrutement'
[0m15:13:07.716552 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:13:08.121974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b06a869b-8a2d-4eee-8ee1-a9985fc24436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000236B3DE76E0>]}
[0m15:13:08.123034 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:13:08.124385 [info ] [MainThread]: 
[0m15:13:08.128698 [debug] [Thread-1 (]: Began running node model.take_home_challenge.avg_products_per_order
[0m15:13:08.129802 [debug] [Thread-2 (]: Began running node model.take_home_challenge.order_segmentation
[0m15:13:08.129802 [debug] [Thread-3 (]: Began running node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:13:08.131088 [debug] [Thread-4 (]: Began running node model.take_home_challenge.orders_2023
[0m15:13:08.131088 [info ] [Thread-1 (]: 1 of 6 START sql view model orders_recrutement.avg_products_per_order .......... [RUN]
[0m15:13:08.132188 [info ] [Thread-2 (]: 2 of 6 START sql view model orders_recrutement.order_segmentation .............. [RUN]
[0m15:13:08.132188 [info ] [Thread-3 (]: 3 of 6 START sql view model orders_recrutement.orders_2022_2023_with_qty ....... [RUN]
[0m15:13:08.133246 [info ] [Thread-4 (]: 4 of 6 START sql view model orders_recrutement.orders_2023 ..................... [RUN]
[0m15:13:08.134485 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.take_home_challenge.avg_products_per_order'
[0m15:13:08.135491 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.take_home_challenge.order_segmentation'
[0m15:13:08.135491 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_2022_2023_with_qty'
[0m15:13:08.135491 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_2023'
[0m15:13:08.136944 [debug] [Thread-1 (]: Began compiling node model.take_home_challenge.avg_products_per_order
[0m15:13:08.136944 [debug] [Thread-2 (]: Began compiling node model.take_home_challenge.order_segmentation
[0m15:13:08.138430 [debug] [Thread-3 (]: Began compiling node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:13:08.138430 [debug] [Thread-4 (]: Began compiling node model.take_home_challenge.orders_2023
[0m15:13:08.145482 [debug] [Thread-1 (]: Writing injected SQL for node "model.take_home_challenge.avg_products_per_order"
[0m15:13:08.146489 [debug] [Thread-2 (]: Writing injected SQL for node "model.take_home_challenge.order_segmentation"
[0m15:13:08.149350 [debug] [Thread-3 (]: Writing injected SQL for node "model.take_home_challenge.orders_2022_2023_with_qty"
[0m15:13:08.151950 [debug] [Thread-4 (]: Writing injected SQL for node "model.take_home_challenge.orders_2023"
[0m15:13:08.153951 [debug] [Thread-1 (]: Began executing node model.take_home_challenge.avg_products_per_order
[0m15:13:08.154950 [debug] [Thread-2 (]: Began executing node model.take_home_challenge.order_segmentation
[0m15:13:08.155950 [debug] [Thread-3 (]: Began executing node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:13:08.181396 [debug] [Thread-4 (]: Began executing node model.take_home_challenge.orders_2023
[0m15:13:08.185199 [debug] [Thread-1 (]: Writing runtime sql for node "model.take_home_challenge.avg_products_per_order"
[0m15:13:08.188343 [debug] [Thread-2 (]: Writing runtime sql for node "model.take_home_challenge.order_segmentation"
[0m15:13:08.190430 [debug] [Thread-3 (]: Writing runtime sql for node "model.take_home_challenge.orders_2022_2023_with_qty"
[0m15:13:08.193026 [debug] [Thread-4 (]: Writing runtime sql for node "model.take_home_challenge.orders_2023"
[0m15:13:08.193026 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m15:13:08.194510 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:13:08.195514 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:13:08.195514 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:13:08.197513 [debug] [Thread-2 (]: On model.take_home_challenge.order_segmentation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.order_segmentation"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`order_segmentation`
  OPTIONS()
  as WITH order_counts AS (
    SELECT
        o.orders_id,
        o.customers_id AS client_id,
        o.date_date AS order_date,
        COUNT(*) OVER (
            PARTITION BY o.customers_id
            ORDER BY o.date_date
            ROWS BETWEEN 12 PRECEDING AND CURRENT ROW
        ) AS orders_in_last_12_months
    FROM
        takehomechallenge.orders_recrutement.orders o
    WHERE
        EXTRACT(YEAR FROM o.date_date) = 2023
)
SELECT
    o.orders_id,
    o.client_id,
    o.order_date,
    CASE
        WHEN o.orders_in_last_12_months = 1 THEN 'New'
        WHEN o.orders_in_last_12_months BETWEEN 2 AND 4 THEN 'Returning'
        WHEN o.orders_in_last_12_months >= 5 THEN 'VIP'
        ELSE 'Unknown'
    END AS order_segment
FROM
    order_counts o
ORDER BY
    o.order_date, o.client_id;


[0m15:13:08.199046 [debug] [Thread-1 (]: On model.take_home_challenge.avg_products_per_order: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.avg_products_per_order"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`avg_products_per_order`
  OPTIONS()
  as SELECT
    EXTRACT(MONTH FROM date_date) AS month,
    AVG(qty) AS avg_products_per_order
FROM
    takehomechallenge.sales_recrutement.sales
WHERE
    EXTRACT(YEAR FROM date_date) = 2023
GROUP BY
    month
ORDER BY
    month;


[0m15:13:08.201129 [debug] [Thread-3 (]: On model.take_home_challenge.orders_2022_2023_with_qty: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2022_2023_with_qty"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2022_2023_with_qty`
  OPTIONS()
  as SELECT
    o.date_date AS order_date,
    o.customers_id,
    o.orders_id,
    o.CA_ht,
    SUM(s.qty) AS qty_product  -- Calcul de la quantité totale de produits par commande
FROM
    takehomechallenge.orders_recrutement.orders o
JOIN
    takehomechallenge.sales_recrutement.sales s
ON
    o.customers_id = s.client_id
    AND o.orders_id = s.transaction_id  -- Lier chaque commande à ses produits
WHERE
    EXTRACT(YEAR FROM o.date_date) IN (2022, 2023)  -- Filtrer pour 2022 et 2023
GROUP BY
    o.date_date, o.customers_id, o.orders_id, o.CA_ht
ORDER BY
    o.date_date, o.orders_id;


[0m15:13:08.201129 [debug] [Thread-4 (]: On model.take_home_challenge.orders_2023: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2023"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2023`
  OPTIONS()
  as SELECT
    COUNT(*) AS total_orders_2023
FROM
    takehomechallenge.orders_recrutement.orders
WHERE
    EXTRACT(YEAR FROM date_date) = 2023;


[0m15:13:08.818874 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:1cc01543-1fc2-45d3-9b1a-79b5b9fc3d18&page=queryresults
[0m15:13:08.843381 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:b7241e87-cd92-4f29-a9d9-70d3f6588ad5&page=queryresults
[0m15:13:08.930458 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:45630af5-074b-4c74-b894-e2241480bdec&page=queryresults
[0m15:13:08.955088 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:646c5d65-1efd-4e74-9b81-e7205f658aaa&page=queryresults
[0m15:13:09.217287 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b06a869b-8a2d-4eee-8ee1-a9985fc24436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000236B22E4710>]}
[0m15:13:09.218302 [info ] [Thread-2 (]: 2 of 6 OK created sql view model orders_recrutement.order_segmentation ......... [[32mCREATE VIEW (0 processed)[0m in 1.08s]
[0m15:13:09.220292 [debug] [Thread-2 (]: Finished running node model.take_home_challenge.order_segmentation
[0m15:13:09.220292 [debug] [Thread-2 (]: Began running node model.take_home_challenge.orders_2023_with_segmentation
[0m15:13:09.221292 [info ] [Thread-2 (]: 5 of 6 START sql view model orders_recrutement.orders_2023_with_segmentation ... [RUN]
[0m15:13:09.221292 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.take_home_challenge.order_segmentation, now model.take_home_challenge.orders_2023_with_segmentation)
[0m15:13:09.222302 [debug] [Thread-2 (]: Began compiling node model.take_home_challenge.orders_2023_with_segmentation
[0m15:13:09.223644 [debug] [Thread-2 (]: Writing injected SQL for node "model.take_home_challenge.orders_2023_with_segmentation"
[0m15:13:09.224677 [debug] [Thread-2 (]: Began executing node model.take_home_challenge.orders_2023_with_segmentation
[0m15:13:09.297126 [debug] [Thread-2 (]: Writing runtime sql for node "model.take_home_challenge.orders_2023_with_segmentation"
[0m15:13:09.299234 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b06a869b-8a2d-4eee-8ee1-a9985fc24436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000236B43DEC90>]}
[0m15:13:09.300323 [info ] [Thread-4 (]: 4 of 6 OK created sql view model orders_recrutement.orders_2023 ................ [[32mCREATE VIEW (0 processed)[0m in 1.16s]
[0m15:13:09.300323 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:13:09.301334 [debug] [Thread-4 (]: Finished running node model.take_home_challenge.orders_2023
[0m15:13:09.302352 [debug] [Thread-2 (]: On model.take_home_challenge.orders_2023_with_segmentation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2023_with_segmentation"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2023_with_segmentation`
  OPTIONS()
  as WITH order_counts AS (
    SELECT
        o.orders_id,
        o.customers_id AS client_id,
        o.date_date AS order_date,
        o.CA_ht,  -- Assurez-vous de sélectionner CA_ht dans la sous-requête
        COUNT(*) OVER (
            PARTITION BY o.customers_id
            ORDER BY o.date_date
            ROWS BETWEEN 12 PRECEDING AND CURRENT ROW
        ) AS orders_in_last_12_months
    FROM
        takehomechallenge.orders_recrutement.orders o
    WHERE
        EXTRACT(YEAR FROM o.date_date) = 2023
)
SELECT
    o.orders_id,
    o.client_id,
    o.order_date,
    o.CA_ht,
    CASE
        WHEN o.orders_in_last_12_months = 1 THEN 'New'
        WHEN o.orders_in_last_12_months BETWEEN 2 AND 4 THEN 'Returning'
        WHEN o.orders_in_last_12_months >= 5 THEN 'VIP'
        ELSE 'Unknown'
    END AS order_segmentation
FROM
    order_counts o;


[0m15:13:09.303423 [debug] [Thread-4 (]: Began running node model.take_home_challenge.orders_by_month
[0m15:13:09.331836 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b06a869b-8a2d-4eee-8ee1-a9985fc24436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000236B43DDC70>]}
[0m15:13:09.333847 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b06a869b-8a2d-4eee-8ee1-a9985fc24436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000236B41EA630>]}
[0m15:13:09.334865 [info ] [Thread-4 (]: 6 of 6 START sql view model orders_recrutement.orders_by_month ................. [RUN]
[0m15:13:09.335848 [info ] [Thread-1 (]: 1 of 6 OK created sql view model orders_recrutement.avg_products_per_order ..... [[32mCREATE VIEW (0 processed)[0m in 1.20s]
[0m15:13:09.336843 [info ] [Thread-3 (]: 3 of 6 OK created sql view model orders_recrutement.orders_2022_2023_with_qty .. [[32mCREATE VIEW (0 processed)[0m in 1.20s]
[0m15:13:09.336843 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.take_home_challenge.orders_2023, now model.take_home_challenge.orders_by_month)
[0m15:13:09.338311 [debug] [Thread-1 (]: Finished running node model.take_home_challenge.avg_products_per_order
[0m15:13:09.339429 [debug] [Thread-3 (]: Finished running node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:13:09.339429 [debug] [Thread-4 (]: Began compiling node model.take_home_challenge.orders_by_month
[0m15:13:09.343456 [debug] [Thread-4 (]: Writing injected SQL for node "model.take_home_challenge.orders_by_month"
[0m15:13:09.344544 [debug] [Thread-4 (]: Began executing node model.take_home_challenge.orders_by_month
[0m15:13:09.348223 [debug] [Thread-4 (]: Writing runtime sql for node "model.take_home_challenge.orders_by_month"
[0m15:13:09.349229 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:13:09.351397 [debug] [Thread-4 (]: On model.take_home_challenge.orders_by_month: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_by_month"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_by_month`
  OPTIONS()
  as SELECT
    EXTRACT(MONTH FROM date_date) AS month,
    COUNT(*) AS total_orders
FROM
    takehomechallenge.orders_recrutement.orders
WHERE
    EXTRACT(YEAR FROM date_date) = 2023
GROUP BY
    month
ORDER BY
    month;


[0m15:13:09.979238 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:cca62c54-8c26-41ea-96db-aeb7229b49cc&page=queryresults
[0m15:13:09.988165 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:f8d0749f-dad4-4194-9480-0b347533511a&page=queryresults
[0m15:13:10.325973 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b06a869b-8a2d-4eee-8ee1-a9985fc24436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000236B3E7ACC0>]}
[0m15:13:10.327950 [info ] [Thread-4 (]: 6 of 6 OK created sql view model orders_recrutement.orders_by_month ............ [[32mCREATE VIEW (0 processed)[0m in 0.99s]
[0m15:13:10.335995 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b06a869b-8a2d-4eee-8ee1-a9985fc24436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000236B47C5D30>]}
[0m15:13:10.338015 [debug] [Thread-4 (]: Finished running node model.take_home_challenge.orders_by_month
[0m15:13:10.341015 [info ] [Thread-2 (]: 5 of 6 OK created sql view model orders_recrutement.orders_2023_with_segmentation  [[32mCREATE VIEW (0 processed)[0m in 1.11s]
[0m15:13:10.344009 [debug] [Thread-2 (]: Finished running node model.take_home_challenge.orders_2023_with_segmentation
[0m15:13:10.348316 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:13:10.349342 [debug] [MainThread]: Connection 'list_takehomechallenge' was properly closed.
[0m15:13:10.349342 [debug] [MainThread]: Connection 'list_takehomechallenge_orders_recrutement' was properly closed.
[0m15:13:10.350634 [debug] [MainThread]: Connection 'model.take_home_challenge.avg_products_per_order' was properly closed.
[0m15:13:10.350634 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_2023_with_segmentation' was properly closed.
[0m15:13:10.351819 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_2022_2023_with_qty' was properly closed.
[0m15:13:10.351819 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_by_month' was properly closed.
[0m15:13:10.351819 [info ] [MainThread]: 
[0m15:13:10.353243 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.17 seconds (3.17s).
[0m15:13:10.355404 [debug] [MainThread]: Command end result
[0m15:13:10.387346 [info ] [MainThread]: 
[0m15:13:10.388576 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:13:10.388576 [info ] [MainThread]: 
[0m15:13:10.389801 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m15:13:10.391167 [debug] [MainThread]: Command `dbt run` succeeded at 15:13:10.391167 after 5.68 seconds
[0m15:13:10.391167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000236A12EC380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000236A11485F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000236A0FEF6E0>]}
[0m15:13:10.392323 [debug] [MainThread]: Flushing usage events
[0m14:59:37.682885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000235C142C530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000235C0D877D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000235C0D86A80>]}


============================== 14:59:37.690798 | 10a14549-9757-4dfc-b477-33621e5f5ee0 ==============================
[0m14:59:37.690798 [info ] [MainThread]: Running with dbt=1.8.7
[0m14:59:37.691776 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'log_path': 'C:\\Users\\thoma\\PycharmProjects\\Take-Home challenge\\logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --full-refresh', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:59:43.373039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '10a14549-9757-4dfc-b477-33621e5f5ee0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000235D20DBFB0>]}
[0m14:59:43.432051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '10a14549-9757-4dfc-b477-33621e5f5ee0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000235D28FF8F0>]}
[0m14:59:43.433052 [info ] [MainThread]: Registered adapter: bigquery=1.8.3
[0m14:59:43.867196 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m14:59:45.376593 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:59:45.377601 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:59:45.422014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '10a14549-9757-4dfc-b477-33621e5f5ee0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000235D3FD4EC0>]}
[0m14:59:45.581895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '10a14549-9757-4dfc-b477-33621e5f5ee0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000235D44878C0>]}
[0m14:59:45.581895 [info ] [MainThread]: Found 6 models, 2 sources, 484 macros
[0m14:59:45.582895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '10a14549-9757-4dfc-b477-33621e5f5ee0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000235D4130C50>]}
[0m14:59:45.584896 [info ] [MainThread]: 
[0m14:59:45.585895 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:59:45.592000 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge'
[0m14:59:45.592000 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:59:45.593473 [debug] [ThreadPool]: BigQuery adapter: Got an error when attempting to create a bigquery client: '[Errno 2] No such file or directory: 'takehomechallenge-3334bc5c3555.json''
[0m14:59:45.593473 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:59:45.593473 [debug] [MainThread]: Connection 'list_takehomechallenge' was properly closed.
[0m14:59:45.594957 [info ] [MainThread]: 
[0m14:59:45.595973 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.01 seconds (0.01s).
[0m14:59:45.598323 [error] [MainThread]: Encountered an error:
Database Error
  [Errno 2] No such file or directory: 'takehomechallenge-3334bc5c3555.json'
[0m14:59:45.599939 [debug] [MainThread]: Command `dbt run` failed at 14:59:45.599939 after 8.13 seconds
[0m14:59:45.601144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000235C142C530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000235C128F6E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000235D3FD6180>]}
[0m14:59:45.602152 [debug] [MainThread]: Flushing usage events
[0m15:00:37.253113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C9DBF8BC20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C9DBBF92B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C9DBDDC350>]}


============================== 15:00:37.258197 | 22287306-c7aa-44e7-ac70-754c972a2344 ==============================
[0m15:00:37.258197 [info ] [MainThread]: Running with dbt=1.8.7
[0m15:00:37.258781 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\thoma\\PycharmProjects\\Take-Home challenge\\logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --full-refresh', 'send_anonymous_usage_stats': 'True'}
[0m15:00:38.846980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '22287306-c7aa-44e7-ac70-754c972a2344', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C9D9B60E30>]}
[0m15:00:38.896652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '22287306-c7aa-44e7-ac70-754c972a2344', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C9ED161940>]}
[0m15:00:38.897657 [info ] [MainThread]: Registered adapter: bigquery=1.8.3
[0m15:00:39.222906 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m15:00:39.376945 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:00:39.377958 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:00:39.404673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '22287306-c7aa-44e7-ac70-754c972a2344', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C9EEA99EB0>]}
[0m15:00:39.505305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '22287306-c7aa-44e7-ac70-754c972a2344', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C9EEEA7380>]}
[0m15:00:39.506588 [info ] [MainThread]: Found 6 models, 2 sources, 484 macros
[0m15:00:39.507592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '22287306-c7aa-44e7-ac70-754c972a2344', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C9EEB50800>]}
[0m15:00:39.508607 [info ] [MainThread]: 
[0m15:00:39.509712 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m15:00:39.513466 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge'
[0m15:00:39.513466 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:00:40.051880 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge_orders_recrutement'
[0m15:00:40.053886 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:00:40.504450 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '22287306-c7aa-44e7-ac70-754c972a2344', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C9EEB1D520>]}
[0m15:00:40.504450 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:00:40.505456 [info ] [MainThread]: 
[0m15:00:40.512153 [debug] [Thread-1 (]: Began running node model.take_home_challenge.avg_products_per_order
[0m15:00:40.512153 [debug] [Thread-2 (]: Began running node model.take_home_challenge.order_segmentation
[0m15:00:40.513190 [debug] [Thread-3 (]: Began running node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:00:40.513190 [debug] [Thread-4 (]: Began running node model.take_home_challenge.orders_2023
[0m15:00:40.513190 [info ] [Thread-1 (]: 1 of 6 START sql view model orders_recrutement.avg_products_per_order .......... [RUN]
[0m15:00:40.514523 [info ] [Thread-2 (]: 2 of 6 START sql view model orders_recrutement.order_segmentation .............. [RUN]
[0m15:00:40.515740 [info ] [Thread-3 (]: 3 of 6 START sql view model orders_recrutement.orders_2022_2023_with_qty ....... [RUN]
[0m15:00:40.516746 [info ] [Thread-4 (]: 4 of 6 START sql view model orders_recrutement.orders_2023 ..................... [RUN]
[0m15:00:40.518763 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.take_home_challenge.avg_products_per_order'
[0m15:00:40.520808 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.take_home_challenge.order_segmentation'
[0m15:00:40.521809 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_2022_2023_with_qty'
[0m15:00:40.522808 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_2023'
[0m15:00:40.523808 [debug] [Thread-1 (]: Began compiling node model.take_home_challenge.avg_products_per_order
[0m15:00:40.523808 [debug] [Thread-2 (]: Began compiling node model.take_home_challenge.order_segmentation
[0m15:00:40.524808 [debug] [Thread-3 (]: Began compiling node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:00:40.525810 [debug] [Thread-4 (]: Began compiling node model.take_home_challenge.orders_2023
[0m15:00:40.536150 [debug] [Thread-1 (]: Writing injected SQL for node "model.take_home_challenge.avg_products_per_order"
[0m15:00:40.537751 [debug] [Thread-2 (]: Writing injected SQL for node "model.take_home_challenge.order_segmentation"
[0m15:00:40.539969 [debug] [Thread-3 (]: Writing injected SQL for node "model.take_home_challenge.orders_2022_2023_with_qty"
[0m15:00:40.541059 [debug] [Thread-4 (]: Writing injected SQL for node "model.take_home_challenge.orders_2023"
[0m15:00:40.543570 [debug] [Thread-1 (]: Began executing node model.take_home_challenge.avg_products_per_order
[0m15:00:40.543570 [debug] [Thread-2 (]: Began executing node model.take_home_challenge.order_segmentation
[0m15:00:40.577610 [debug] [Thread-3 (]: Began executing node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:00:40.582608 [debug] [Thread-1 (]: Writing runtime sql for node "model.take_home_challenge.avg_products_per_order"
[0m15:00:40.582608 [debug] [Thread-4 (]: Began executing node model.take_home_challenge.orders_2023
[0m15:00:40.588077 [debug] [Thread-2 (]: Writing runtime sql for node "model.take_home_challenge.order_segmentation"
[0m15:00:40.590367 [debug] [Thread-3 (]: Writing runtime sql for node "model.take_home_challenge.orders_2022_2023_with_qty"
[0m15:00:40.593675 [debug] [Thread-4 (]: Writing runtime sql for node "model.take_home_challenge.orders_2023"
[0m15:00:40.594853 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m15:00:40.596410 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:00:40.596410 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:00:40.597415 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:00:40.598560 [debug] [Thread-1 (]: On model.take_home_challenge.avg_products_per_order: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.avg_products_per_order"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`avg_products_per_order`
  OPTIONS()
  as SELECT
    EXTRACT(MONTH FROM date_date) AS month,
    AVG(qty) AS avg_products_per_order
FROM
    takehomechallenge.sales_recrutement.sales
WHERE
    EXTRACT(YEAR FROM date_date) = 2023
GROUP BY
    month
ORDER BY
    month;


[0m15:00:40.601080 [debug] [Thread-2 (]: On model.take_home_challenge.order_segmentation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.order_segmentation"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`order_segmentation`
  OPTIONS()
  as WITH order_counts AS (
    SELECT
        o.orders_id,
        o.customers_id AS client_id,
        o.date_date AS order_date,
        COUNT(*) OVER (
            PARTITION BY o.customers_id
            ORDER BY o.date_date
            ROWS BETWEEN 12 PRECEDING AND CURRENT ROW
        ) AS orders_in_last_12_months
    FROM
        takehomechallenge.orders_recrutement.orders o
    WHERE
        EXTRACT(YEAR FROM o.date_date) = 2023
)
SELECT
    o.orders_id,
    o.client_id,
    o.order_date,
    CASE
        WHEN o.orders_in_last_12_months = 1 THEN 'New'
        WHEN o.orders_in_last_12_months BETWEEN 2 AND 4 THEN 'Returning'
        WHEN o.orders_in_last_12_months >= 5 THEN 'VIP'
        ELSE 'Unknown'
    END AS order_segment
FROM
    order_counts o
ORDER BY
    o.order_date, o.client_id;


[0m15:00:40.602570 [debug] [Thread-3 (]: On model.take_home_challenge.orders_2022_2023_with_qty: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2022_2023_with_qty"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2022_2023_with_qty`
  OPTIONS()
  as SELECT
    o.date_date AS order_date,
    o.customers_id,
    o.orders_id,
    o.CA_ht,
    SUM(s.qty) AS qty_product  -- Calcul de la quantité totale de produits par commande
FROM
    takehomechallenge.orders_recrutement.orders o
JOIN
    takehomechallenge.sales_recrutement.sales s
ON
    o.customers_id = s.client_id
    AND o.orders_id = s.transaction_id  -- Lier chaque commande à ses produits
WHERE
    EXTRACT(YEAR FROM o.date_date) IN (2022, 2023)  -- Filtrer pour 2022 et 2023
GROUP BY
    o.date_date, o.customers_id, o.orders_id, o.CA_ht
ORDER BY
    o.date_date, o.orders_id;


[0m15:00:40.603603 [debug] [Thread-4 (]: On model.take_home_challenge.orders_2023: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2023"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2023`
  OPTIONS()
  as SELECT
    COUNT(*) AS total_orders_2023
FROM
    takehomechallenge.orders_recrutement.orders
WHERE
    EXTRACT(YEAR FROM date_date) = 2023;


[0m15:00:41.470166 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:b3843e27-7651-4ece-9a46-6997f93c81fb&page=queryresults
[0m15:00:41.476735 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:c8e51fda-53dc-4c03-b716-e4dfe1e2af5d&page=queryresults
[0m15:00:41.477956 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:cd0e786a-1b69-490e-9635-5de04cc99c1e&page=queryresults
[0m15:00:41.498327 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:7f011596-3674-4e1e-9f9d-737b484f6f9d&page=queryresults
[0m15:00:42.006330 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '22287306-c7aa-44e7-ac70-754c972a2344', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C9DB80D010>]}
[0m15:00:42.009698 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '22287306-c7aa-44e7-ac70-754c972a2344', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C9ECF94D40>]}
[0m15:00:42.013667 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '22287306-c7aa-44e7-ac70-754c972a2344', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C9EEF8A420>]}
[0m15:00:42.017279 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '22287306-c7aa-44e7-ac70-754c972a2344', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C9EEF8AED0>]}
[0m15:00:42.019434 [info ] [Thread-3 (]: 3 of 6 OK created sql view model orders_recrutement.orders_2022_2023_with_qty .. [[32mCREATE VIEW (0 processed)[0m in 1.48s]
[0m15:00:42.021826 [info ] [Thread-1 (]: 1 of 6 OK created sql view model orders_recrutement.avg_products_per_order ..... [[32mCREATE VIEW (0 processed)[0m in 1.49s]
[0m15:00:42.022834 [info ] [Thread-2 (]: 2 of 6 OK created sql view model orders_recrutement.order_segmentation ......... [[32mCREATE VIEW (0 processed)[0m in 1.49s]
[0m15:00:42.024856 [info ] [Thread-4 (]: 4 of 6 OK created sql view model orders_recrutement.orders_2023 ................ [[32mCREATE VIEW (0 processed)[0m in 1.50s]
[0m15:00:42.025363 [debug] [Thread-3 (]: Finished running node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:00:42.027505 [debug] [Thread-1 (]: Finished running node model.take_home_challenge.avg_products_per_order
[0m15:00:42.028513 [debug] [Thread-2 (]: Finished running node model.take_home_challenge.order_segmentation
[0m15:00:42.029831 [debug] [Thread-4 (]: Finished running node model.take_home_challenge.orders_2023
[0m15:00:42.031301 [debug] [Thread-3 (]: Began running node model.take_home_challenge.orders_2023_with_segmentation
[0m15:00:42.033914 [debug] [Thread-1 (]: Began running node model.take_home_challenge.orders_by_month
[0m15:00:42.036021 [info ] [Thread-3 (]: 5 of 6 START sql view model orders_recrutement.orders_2023_with_segmentation ... [RUN]
[0m15:00:42.037522 [info ] [Thread-1 (]: 6 of 6 START sql view model orders_recrutement.orders_by_month ................. [RUN]
[0m15:00:42.038680 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.take_home_challenge.orders_2022_2023_with_qty, now model.take_home_challenge.orders_2023_with_segmentation)
[0m15:00:42.039970 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.take_home_challenge.avg_products_per_order, now model.take_home_challenge.orders_by_month)
[0m15:00:42.041341 [debug] [Thread-3 (]: Began compiling node model.take_home_challenge.orders_2023_with_segmentation
[0m15:00:42.042365 [debug] [Thread-1 (]: Began compiling node model.take_home_challenge.orders_by_month
[0m15:00:42.045449 [debug] [Thread-3 (]: Writing injected SQL for node "model.take_home_challenge.orders_2023_with_segmentation"
[0m15:00:42.049540 [debug] [Thread-1 (]: Writing injected SQL for node "model.take_home_challenge.orders_by_month"
[0m15:00:42.052628 [debug] [Thread-3 (]: Began executing node model.take_home_challenge.orders_2023_with_segmentation
[0m15:00:42.057024 [debug] [Thread-3 (]: Writing runtime sql for node "model.take_home_challenge.orders_2023_with_segmentation"
[0m15:00:42.057024 [debug] [Thread-1 (]: Began executing node model.take_home_challenge.orders_by_month
[0m15:00:42.061024 [debug] [Thread-1 (]: Writing runtime sql for node "model.take_home_challenge.orders_by_month"
[0m15:00:42.062026 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m15:00:42.064025 [debug] [Thread-3 (]: On model.take_home_challenge.orders_2023_with_segmentation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2023_with_segmentation"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2023_with_segmentation`
  OPTIONS()
  as WITH order_counts AS (
    SELECT
        o.orders_id,
        o.customers_id AS client_id,
        o.date_date AS order_date,
        o.CA_ht,  -- Assurez-vous de sélectionner CA_ht dans la sous-requête
        COUNT(*) OVER (
            PARTITION BY o.customers_id
            ORDER BY o.date_date
            ROWS BETWEEN 12 PRECEDING AND CURRENT ROW
        ) AS orders_in_last_12_months
    FROM
        takehomechallenge.orders_recrutement.orders o
    WHERE
        EXTRACT(YEAR FROM o.date_date) = 2023
)
SELECT
    o.orders_id,
    o.client_id,
    o.order_date,
    o.CA_ht,
    CASE
        WHEN o.orders_in_last_12_months = 1 THEN 'New'
        WHEN o.orders_in_last_12_months BETWEEN 2 AND 4 THEN 'Returning'
        WHEN o.orders_in_last_12_months >= 5 THEN 'VIP'
        ELSE 'Unknown'
    END AS order_segmentation
FROM
    order_counts o;


[0m15:00:42.065030 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:00:42.091673 [debug] [Thread-1 (]: On model.take_home_challenge.orders_by_month: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_by_month"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_by_month`
  OPTIONS()
  as SELECT
    EXTRACT(MONTH FROM date_date) AS month,
    COUNT(*) AS total_orders
FROM
    takehomechallenge.orders_recrutement.orders
WHERE
    EXTRACT(YEAR FROM date_date) = 2023
GROUP BY
    month
ORDER BY
    month;


[0m15:00:42.904101 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:224019fb-cf0b-4ade-a8e1-6b7a1baebfce&page=queryresults
[0m15:00:42.913189 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:cedddf98-ae80-46c4-8569-2e072904e73c&page=queryresults
[0m15:00:43.365286 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '22287306-c7aa-44e7-ac70-754c972a2344', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C9EF3A3EF0>]}
[0m15:00:43.367594 [info ] [Thread-3 (]: 5 of 6 OK created sql view model orders_recrutement.orders_2023_with_segmentation  [[32mCREATE VIEW (0 processed)[0m in 1.33s]
[0m15:00:43.369792 [debug] [Thread-3 (]: Finished running node model.take_home_challenge.orders_2023_with_segmentation
[0m15:00:43.426046 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '22287306-c7aa-44e7-ac70-754c972a2344', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C9EF3A3A10>]}
[0m15:00:43.428325 [info ] [Thread-1 (]: 6 of 6 OK created sql view model orders_recrutement.orders_by_month ............ [[32mCREATE VIEW (0 processed)[0m in 1.39s]
[0m15:00:43.430328 [debug] [Thread-1 (]: Finished running node model.take_home_challenge.orders_by_month
[0m15:00:43.433412 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:00:43.434421 [debug] [MainThread]: Connection 'list_takehomechallenge' was properly closed.
[0m15:00:43.434421 [debug] [MainThread]: Connection 'list_takehomechallenge_orders_recrutement' was properly closed.
[0m15:00:43.434421 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_by_month' was properly closed.
[0m15:00:43.435805 [debug] [MainThread]: Connection 'model.take_home_challenge.order_segmentation' was properly closed.
[0m15:00:43.435805 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_2023_with_segmentation' was properly closed.
[0m15:00:43.435805 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_2023' was properly closed.
[0m15:00:43.437038 [info ] [MainThread]: 
[0m15:00:43.437038 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.93 seconds (3.93s).
[0m15:00:43.439044 [debug] [MainThread]: Command end result
[0m15:00:43.467360 [info ] [MainThread]: 
[0m15:00:43.468405 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:00:43.469396 [info ] [MainThread]: 
[0m15:00:43.469396 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m15:00:43.471008 [debug] [MainThread]: Command `dbt run` succeeded at 15:00:43.471008 after 6.33 seconds
[0m15:00:43.472018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C9DB685F70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C9DBE2B7D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C9DBE29A60>]}
[0m15:00:43.472018 [debug] [MainThread]: Flushing usage events
[0m15:11:37.283884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAB4D46210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAB6837D10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAB6836F30>]}


============================== 15:11:37.287652 | dace8485-0968-4765-8e70-9f8b13900660 ==============================
[0m15:11:37.287652 [info ] [MainThread]: Running with dbt=1.8.7
[0m15:11:37.288667 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\thoma\\.dbt', 'log_path': 'C:\\Users\\thoma\\PycharmProjects\\Take-Home challenge\\logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --full-refresh', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:11:41.225212 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dace8485-0968-4765-8e70-9f8b13900660', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAB67DA9C0>]}
[0m15:11:41.274687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dace8485-0968-4765-8e70-9f8b13900660', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAB6858500>]}
[0m15:11:41.274687 [info ] [MainThread]: Registered adapter: bigquery=1.8.3
[0m15:11:41.673406 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m15:11:42.292814 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 6 files changed.
[0m15:11:42.293815 [debug] [MainThread]: Partial parsing: updated file: take_home_challenge://models\orders_2023_with_segmentation.sql
[0m15:11:42.293815 [debug] [MainThread]: Partial parsing: updated file: take_home_challenge://models\orders_2022_2023_with_qty.sql
[0m15:11:42.294815 [debug] [MainThread]: Partial parsing: updated file: take_home_challenge://models\orders_by_month.sql
[0m15:11:42.294815 [debug] [MainThread]: Partial parsing: updated file: take_home_challenge://models\orders_2023.sql
[0m15:11:42.295824 [debug] [MainThread]: Partial parsing: updated file: take_home_challenge://models\order_segmentation.sql
[0m15:11:42.295824 [debug] [MainThread]: Partial parsing: updated file: take_home_challenge://models\avg_products_per_order.sql
[0m15:11:42.535273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dace8485-0968-4765-8e70-9f8b13900660', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FACA5D69C0>]}
[0m15:11:42.642704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dace8485-0968-4765-8e70-9f8b13900660', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FACA70BD70>]}
[0m15:11:42.642704 [info ] [MainThread]: Found 6 models, 2 sources, 484 macros
[0m15:11:42.643894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dace8485-0968-4765-8e70-9f8b13900660', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FACA452240>]}
[0m15:11:42.645058 [info ] [MainThread]: 
[0m15:11:42.646112 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m15:11:42.650070 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge'
[0m15:11:42.651318 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:11:43.199868 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_takehomechallenge_orders_recrutement'
[0m15:11:43.202842 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:11:43.623171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dace8485-0968-4765-8e70-9f8b13900660', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAB5304D10>]}
[0m15:11:43.624803 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:11:43.627312 [info ] [MainThread]: 
[0m15:11:43.639557 [debug] [Thread-1 (]: Began running node model.take_home_challenge.avg_products_per_order
[0m15:11:43.641855 [debug] [Thread-2 (]: Began running node model.take_home_challenge.order_segmentation
[0m15:11:43.642845 [debug] [Thread-3 (]: Began running node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:11:43.642845 [debug] [Thread-4 (]: Began running node model.take_home_challenge.orders_2023
[0m15:11:43.644080 [info ] [Thread-1 (]: 1 of 6 START sql view model orders_recrutement.avg_products_per_order .......... [RUN]
[0m15:11:43.645284 [info ] [Thread-2 (]: 2 of 6 START sql view model orders_recrutement.order_segmentation .............. [RUN]
[0m15:11:43.647415 [info ] [Thread-3 (]: 3 of 6 START sql view model orders_recrutement.orders_2022_2023_with_qty ....... [RUN]
[0m15:11:43.649416 [info ] [Thread-4 (]: 4 of 6 START sql view model orders_recrutement.orders_2023 ..................... [RUN]
[0m15:11:43.651415 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.take_home_challenge.avg_products_per_order'
[0m15:11:43.652432 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.take_home_challenge.order_segmentation'
[0m15:11:43.653922 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_2022_2023_with_qty'
[0m15:11:43.655321 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.take_home_challenge.orders_2023'
[0m15:11:43.656734 [debug] [Thread-1 (]: Began compiling node model.take_home_challenge.avg_products_per_order
[0m15:11:43.657743 [debug] [Thread-2 (]: Began compiling node model.take_home_challenge.order_segmentation
[0m15:11:43.658863 [debug] [Thread-3 (]: Began compiling node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:11:43.658863 [debug] [Thread-4 (]: Began compiling node model.take_home_challenge.orders_2023
[0m15:11:43.671747 [debug] [Thread-1 (]: Writing injected SQL for node "model.take_home_challenge.avg_products_per_order"
[0m15:11:43.674027 [debug] [Thread-2 (]: Writing injected SQL for node "model.take_home_challenge.order_segmentation"
[0m15:11:43.675892 [debug] [Thread-3 (]: Writing injected SQL for node "model.take_home_challenge.orders_2022_2023_with_qty"
[0m15:11:43.678166 [debug] [Thread-4 (]: Writing injected SQL for node "model.take_home_challenge.orders_2023"
[0m15:11:43.680312 [debug] [Thread-1 (]: Began executing node model.take_home_challenge.avg_products_per_order
[0m15:11:43.680312 [debug] [Thread-2 (]: Began executing node model.take_home_challenge.order_segmentation
[0m15:11:43.693146 [debug] [Thread-4 (]: Began executing node model.take_home_challenge.orders_2023
[0m15:11:43.710266 [debug] [Thread-1 (]: Writing runtime sql for node "model.take_home_challenge.avg_products_per_order"
[0m15:11:43.710266 [debug] [Thread-3 (]: Began executing node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:11:43.712270 [debug] [Thread-2 (]: Writing runtime sql for node "model.take_home_challenge.order_segmentation"
[0m15:11:43.714909 [debug] [Thread-4 (]: Writing runtime sql for node "model.take_home_challenge.orders_2023"
[0m15:11:43.718387 [debug] [Thread-3 (]: Writing runtime sql for node "model.take_home_challenge.orders_2022_2023_with_qty"
[0m15:11:43.718891 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m15:11:43.719986 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:11:43.719986 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:11:43.721991 [debug] [Thread-1 (]: On model.take_home_challenge.avg_products_per_order: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.avg_products_per_order"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`avg_products_per_order`
  OPTIONS()
  as -- Exercice 3 : Calculer le nombre moyen de produits par commande pour chaque mois de l'année 2023.

SELECT
    EXTRACT(MONTH FROM date_date) AS month, -- Extraire le mois à partir de la date et renommer la colonne en "month".
    AVG(qty) AS avg_products_per_order -- Calculer la moyenne des quantités de produits par commande pour chaque mois.
FROM
    takehomechallenge.sales_recrutement.sales -- Table contenant les lignes de vente par produit.
WHERE
    EXTRACT(YEAR FROM date_date) = 2023 -- Filtrer uniquement les données pour l'année 2023.
GROUP BY
    month -- Grouper les résultats par mois pour calculer une moyenne distincte pour chaque mois.
ORDER BY
    month -- Trier les résultats dans l'ordre croissant des mois.;


[0m15:11:43.722991 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:11:43.723991 [debug] [Thread-2 (]: On model.take_home_challenge.order_segmentation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.order_segmentation"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`order_segmentation`
  OPTIONS()
  as -- Exercice 5 : Segmentation des commandes
-- Les commandes de 2023 sont classées en 3 segments :
-- - 'New' : Première commande du client dans les 12 derniers mois.
-- - 'Returning' : Entre la 2ᵉ et la 4ᵉ commande du client dans les 12 derniers mois.
-- - 'VIP' : 5ᵉ commande ou plus du client dans les 12 derniers mois.

WITH order_counts AS (
    SELECT
        o.orders_id, -- Identifiant unique de la commande.
        o.customers_id AS client_id, -- Identifiant du client ayant passé la commande.
        o.date_date AS order_date, -- Date de la commande.
        COUNT(*) OVER (
            PARTITION BY o.customers_id -- Segmenter par client.
            ORDER BY o.date_date -- Trier les commandes par date.
            ROWS BETWEEN 12 PRECEDING AND CURRENT ROW -- Inclure les commandes des 12 derniers mois.
        ) AS orders_in_last_12_months -- Compte le nombre total de commandes passées par le client dans les 12 derniers mois.
    FROM
        takehomechallenge.orders_recrutement.orders o -- Table des commandes.
    WHERE
        EXTRACT(YEAR FROM o.date_date) = 2023 -- Filtrer pour les commandes passées uniquement en 2023.
)
SELECT
    o.orders_id, -- Identifiant de la commande.
    o.client_id, -- Identifiant du client.
    o.order_date, -- Date de la commande.
    CASE
        WHEN o.orders_in_last_12_months = 1 THEN 'New' -- Si c'est la première commande dans les 12 derniers mois.
        WHEN o.orders_in_last_12_months BETWEEN 2 AND 4 THEN 'Returning' -- Si c'est entre la 2ᵉ et la 4ᵉ commande.
        WHEN o.orders_in_last_12_months >= 5 THEN 'VIP' -- Si c'est la 5ᵉ commande ou plus.
        ELSE 'Unknown' -- Par défaut, si aucune des conditions ci-dessus n'est remplie.
    END AS order_segment -- Segment de la commande (New, Returning, VIP, ou Unknown).
FROM
    order_counts o -- Sous-requête contenant le comptage des commandes.
ORDER BY
    o.order_date, -- Trier les résultats par date de commande pour une chronologie claire.
    o.client_id; -- Trier également par identifiant de client pour regrouper les commandes par client.;


[0m15:11:43.726002 [debug] [Thread-4 (]: On model.take_home_challenge.orders_2023: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2023"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2023`
  OPTIONS()
  as -- Exercice 1 : Calculer le nombre total de commandes passées en 2023.

-- Utilisation de la fonction COUNT(*) pour compter toutes les lignes dans la table "orders".
-- Chaque ligne représente une commande unique.

SELECT
    COUNT(*) AS total_orders_2023 -- Renommer le résultat sous le nom "total_orders_2023" pour indiquer le nombre total de commandes.
FROM
    takehomechallenge.orders_recrutement.orders -- Table contenant les données des commandes.
WHERE
    EXTRACT(YEAR FROM date_date) = 2023 -- Filtrer uniquement les commandes dont la date se situe en 2023.;


[0m15:11:43.751131 [debug] [Thread-3 (]: On model.take_home_challenge.orders_2022_2023_with_qty: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2022_2023_with_qty"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2022_2023_with_qty`
  OPTIONS()
  as -- Exercice 4 : Créer une table avec une ligne par commande pour les années 2022 et 2023,
-- en ajoutant une colonne `qty_product` qui donne la quantité totale de produits par commande.

SELECT
    o.date_date AS order_date, -- Renommer la colonne `date_date` en `order_date` pour plus de clarté.
    o.customers_id, -- Inclure l'identifiant du client associé à la commande.
    o.orders_id, -- Inclure l'identifiant unique de la commande.
    o.CA_ht, -- Inclure le chiffre d'affaires hors taxes associé à la commande.
    SUM(s.qty) AS qty_product -- Calculer la quantité totale de produits pour chaque commande.
FROM
    takehomechallenge.orders_recrutement.orders o -- Table contenant les informations sur les commandes.
JOIN
    takehomechallenge.sales_recrutement.sales s -- Table contenant les détails des ventes par produit.
ON
    o.customers_id = s.client_id -- Faire correspondre les clients entre les tables `orders` et `sales`.
    AND o.orders_id = s.transaction_id -- Associer chaque commande à ses produits via `orders_id` et `transaction_id`.
WHERE
    EXTRACT(YEAR FROM o.date_date) IN (2022, 2023) -- Filtrer les commandes des années 2022 et 2023 uniquement.
GROUP BY
    o.date_date, -- Grouper par la date de commande.
    o.customers_id, -- Grouper par l'identifiant du client.
    o.orders_id, -- Grouper par l'identifiant de la commande.
    o.CA_ht -- Grouper par le chiffre d'affaires hors taxes.
ORDER BY
    o.date_date, -- Trier les résultats par date de commande pour un affichage chronologique.
    o.orders_id; -- Trier également par l'identifiant de la commande pour un ordre cohérent.;


[0m15:11:44.398142 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:a3f23f35-291e-437a-962b-2daa936f0209&page=queryresults
[0m15:11:44.504992 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:6581dbb5-1acd-4b5c-9749-97329960d17d&page=queryresults
[0m15:11:44.529380 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:362770ab-5812-46b5-90b3-43d9a190fd33&page=queryresults
[0m15:11:44.554680 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:c588505f-91b8-4ae2-9175-75cecd1e69ca&page=queryresults
[0m15:11:44.964703 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dace8485-0968-4765-8e70-9f8b13900660', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FACA656990>]}
[0m15:11:44.969994 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dace8485-0968-4765-8e70-9f8b13900660', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FACABD9490>]}
[0m15:11:44.972025 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dace8485-0968-4765-8e70-9f8b13900660', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FACABC3CB0>]}
[0m15:11:44.972025 [info ] [Thread-1 (]: 1 of 6 OK created sql view model orders_recrutement.avg_products_per_order ..... [[32mCREATE VIEW (0 processed)[0m in 1.23s]
[0m15:11:44.973014 [info ] [Thread-4 (]: 4 of 6 OK created sql view model orders_recrutement.orders_2023 ................ [[32mCREATE VIEW (0 processed)[0m in 1.31s]
[0m15:11:44.974306 [info ] [Thread-2 (]: 2 of 6 OK created sql view model orders_recrutement.order_segmentation ......... [[32mCREATE VIEW (0 processed)[0m in 1.32s]
[0m15:11:44.974306 [debug] [Thread-1 (]: Finished running node model.take_home_challenge.avg_products_per_order
[0m15:11:44.975358 [debug] [Thread-4 (]: Finished running node model.take_home_challenge.orders_2023
[0m15:11:44.975358 [debug] [Thread-2 (]: Finished running node model.take_home_challenge.order_segmentation
[0m15:11:44.976778 [debug] [Thread-1 (]: Began running node model.take_home_challenge.orders_2023_with_segmentation
[0m15:11:44.976778 [debug] [Thread-4 (]: Began running node model.take_home_challenge.orders_by_month
[0m15:11:44.977781 [info ] [Thread-1 (]: 5 of 6 START sql view model orders_recrutement.orders_2023_with_segmentation ... [RUN]
[0m15:11:44.979293 [info ] [Thread-4 (]: 6 of 6 START sql view model orders_recrutement.orders_by_month ................. [RUN]
[0m15:11:44.979293 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.take_home_challenge.avg_products_per_order, now model.take_home_challenge.orders_2023_with_segmentation)
[0m15:11:44.980325 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.take_home_challenge.orders_2023, now model.take_home_challenge.orders_by_month)
[0m15:11:44.980325 [debug] [Thread-1 (]: Began compiling node model.take_home_challenge.orders_2023_with_segmentation
[0m15:11:44.981435 [debug] [Thread-4 (]: Began compiling node model.take_home_challenge.orders_by_month
[0m15:11:44.983404 [debug] [Thread-1 (]: Writing injected SQL for node "model.take_home_challenge.orders_2023_with_segmentation"
[0m15:11:44.984460 [debug] [Thread-4 (]: Writing injected SQL for node "model.take_home_challenge.orders_by_month"
[0m15:11:44.986753 [debug] [Thread-4 (]: Began executing node model.take_home_challenge.orders_by_month
[0m15:11:44.986753 [debug] [Thread-1 (]: Began executing node model.take_home_challenge.orders_2023_with_segmentation
[0m15:11:44.989790 [debug] [Thread-4 (]: Writing runtime sql for node "model.take_home_challenge.orders_by_month"
[0m15:11:44.993791 [debug] [Thread-1 (]: Writing runtime sql for node "model.take_home_challenge.orders_2023_with_segmentation"
[0m15:11:44.994792 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:11:44.995792 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:11:44.997791 [debug] [Thread-4 (]: On model.take_home_challenge.orders_by_month: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_by_month"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_by_month`
  OPTIONS()
  as -- Exercice 2 : Calculer le nombre de commandes par mois en 2023.

-- La fonction EXTRACT permet d'extraire le mois à partir de la colonne date_date.
-- La fonction COUNT(*) compte le nombre total de commandes pour chaque mois.

SELECT
    EXTRACT(MONTH FROM date_date) AS month, -- Extraire le mois à partir de la date de chaque commande et renommer la colonne en "month".
    COUNT(*) AS total_orders -- Compter le nombre total de commandes pour chaque mois et renommer la colonne en "total_orders".
FROM
    takehomechallenge.orders_recrutement.orders -- Table contenant les données des commandes.
WHERE
    EXTRACT(YEAR FROM date_date) = 2023 -- Filtrer les commandes pour l'année 2023 uniquement.
GROUP BY
    month -- Grouper les résultats par mois pour obtenir un total distinct de commandes pour chaque mois.
ORDER BY
    month -- Trier les résultats dans l'ordre croissant des mois.;


[0m15:11:45.026807 [debug] [Thread-1 (]: On model.take_home_challenge.orders_2023_with_segmentation: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "take_home_challenge", "target_name": "dev", "node_id": "model.take_home_challenge.orders_2023_with_segmentation"} */


  create or replace view `takehomechallenge`.`orders_recrutement`.`orders_2023_with_segmentation`
  OPTIONS()
  as -- Exercice 6 : Création d'une table pour les commandes de 2023 avec segmentation
-- Cette requête crée une table contenant toutes les commandes de l'année 2023,
-- avec une colonne supplémentaire : `order_segmentation` qui attribue un segment à chaque commande.

WITH order_counts AS (
    SELECT
        o.orders_id, -- Identifiant unique de la commande.
        o.customers_id AS client_id, -- Identifiant du client ayant passé la commande.
        o.date_date AS order_date, -- Date de la commande.
        o.CA_ht, -- Montant total hors taxes de la commande.
        COUNT(*) OVER (
            PARTITION BY o.customers_id -- Comptage des commandes par client.
            ORDER BY o.date_date -- Trier les commandes par date.
            ROWS BETWEEN 12 PRECEDING AND CURRENT ROW -- Inclure les commandes des 12 derniers mois.
        ) AS orders_in_last_12_months -- Nombre total de commandes passées par le client dans les 12 derniers mois.
    FROM
        takehomechallenge.orders_recrutement.orders o -- Table des commandes.
    WHERE
        EXTRACT(YEAR FROM o.date_date) = 2023 -- Filtrer pour inclure uniquement les commandes passées en 2023.
)
SELECT
    o.orders_id, -- Identifiant de la commande.
    o.client_id, -- Identifiant du client.
    o.order_date, -- Date de la commande.
    o.CA_ht, -- Montant total hors taxes de la commande.
    CASE
        WHEN o.orders_in_last_12_months = 1 THEN 'New' -- Si c'est la première commande dans les 12 derniers mois.
        WHEN o.orders_in_last_12_months BETWEEN 2 AND 4 THEN 'Returning' -- Si c'est entre la 2ᵉ et la 4ᵉ commande.
        WHEN o.orders_in_last_12_months >= 5 THEN 'VIP' -- Si c'est la 5ᵉ commande ou plus.
        ELSE 'Unknown' -- Par défaut, si aucune des conditions ci-dessus n'est remplie.
    END AS order_segmentation -- Segment de la commande (New, Returning, VIP, ou Unknown).
FROM
    order_counts o; -- Sous-requête contenant les informations nécessaires.;


[0m15:11:45.089545 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dace8485-0968-4765-8e70-9f8b13900660', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FACABD9E80>]}
[0m15:11:45.090543 [info ] [Thread-3 (]: 3 of 6 OK created sql view model orders_recrutement.orders_2022_2023_with_qty .. [[32mCREATE VIEW (0 processed)[0m in 1.44s]
[0m15:11:45.093051 [debug] [Thread-3 (]: Finished running node model.take_home_challenge.orders_2022_2023_with_qty
[0m15:11:45.920581 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:a7ae7881-a28b-4455-a1b5-eae5bee1ee84&page=queryresults
[0m15:11:45.922581 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=takehomechallenge&j=bq:EU:903748f4-48ac-4780-a9a5-391581ff2ffe&page=queryresults
[0m15:11:46.222979 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dace8485-0968-4765-8e70-9f8b13900660', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FACA1E8590>]}
[0m15:11:46.224979 [info ] [Thread-1 (]: 5 of 6 OK created sql view model orders_recrutement.orders_2023_with_segmentation  [[32mCREATE VIEW (0 processed)[0m in 1.24s]
[0m15:11:46.227033 [debug] [Thread-1 (]: Finished running node model.take_home_challenge.orders_2023_with_segmentation
[0m15:11:46.238304 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dace8485-0968-4765-8e70-9f8b13900660', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FACABC89B0>]}
[0m15:11:46.239916 [info ] [Thread-4 (]: 6 of 6 OK created sql view model orders_recrutement.orders_by_month ............ [[32mCREATE VIEW (0 processed)[0m in 1.26s]
[0m15:11:46.243255 [debug] [Thread-4 (]: Finished running node model.take_home_challenge.orders_by_month
[0m15:11:46.247462 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:11:46.250808 [debug] [MainThread]: Connection 'list_takehomechallenge' was properly closed.
[0m15:11:46.251804 [debug] [MainThread]: Connection 'list_takehomechallenge_orders_recrutement' was properly closed.
[0m15:11:46.251804 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_2023_with_segmentation' was properly closed.
[0m15:11:46.253219 [debug] [MainThread]: Connection 'model.take_home_challenge.order_segmentation' was properly closed.
[0m15:11:46.253219 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_2022_2023_with_qty' was properly closed.
[0m15:11:46.254327 [debug] [MainThread]: Connection 'model.take_home_challenge.orders_by_month' was properly closed.
[0m15:11:46.254327 [info ] [MainThread]: 
[0m15:11:46.255494 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.61 seconds (3.61s).
[0m15:11:46.258285 [debug] [MainThread]: Command end result
[0m15:11:46.297692 [info ] [MainThread]: 
[0m15:11:46.298684 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:11:46.298684 [info ] [MainThread]: 
[0m15:11:46.300004 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m15:11:46.302023 [debug] [MainThread]: Command `dbt run` succeeded at 15:11:46.302023 after 9.17 seconds
[0m15:11:46.303312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAB6FA57C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAB7568380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAB73565A0>]}
[0m15:11:46.303312 [debug] [MainThread]: Flushing usage events
